/**@license
* Solpeo Engine
* v1.6.0-beta1
* Copyright (c) 2009-2014 Solpeo Global sp. z o.o.
* http://www.solpeo.com
* 
* The following description of key terms of the License Agreement is for
* information only and shall not be understood to replace the full version of the
* license which is available at:
* http://cdn.solpeo.com/engine/solpeo-engine-license-v2.0.txt
* Prior to commencing use of a licensed work, please read all the terms of the
* License Agreement carefully.
* 
* 
* The License is granted by Solpeo Global Sp. z o.o. with registered office in
* Kraków, Poland, for use of a computer game engine under the name
* Solpeo Engine in accordance with its intended purpose, and for
* modifications, in each case for own use only and provided that Solpeo’s sign is
* placed in a prominent place.
* 
* This License is non-exclusive, and no limits apply to its term and territorial
* coverage.
* 
* The License is granted free of charge, and it takes effect as soon as the
* Software is copied for the first time (downloaded from Solpeo’s website).
* 
* The License does not authorise its holder to use the game engine in
* contravention of its intended purpose or the terms of the License, including by
* making it available to third parties whether in the original or adapted version
* (regardless of the extent of modifications).
* 
* Solpeo Global Sp. z o.o. with registered office in Kraków shall not accept any
* liability for lack of fitness of the game engine for a particular purpose, or
* for the consequences of using the Software or using any modified versions
* thereof.
* 
**/
/* This product includes certain free/open source software.
Terms of the licenses, disclaimers acknowledgements and
notices are reproduced in comments below */

/*!{id:msgpack.codec.js,ver:1.05,license:"MIT",author:"uupaa.js@gmail.com"}*/

/* Domain Public by Eric Wendelin http://eriwen.com/ (2008)
 *                  Luke Smith http://lucassmith.name/ (2008)
 *                  Loic Dachary <loic@dachary.org> (2008)
 *                  Johan Euphrosine <proppy@aminche.com> (2008)
 *                  Oyvind Sean Kinsey http://kinsey.no/blog (2010)
 *                  Victor Homyakov <victor-homyakov@users.sourceforge.net> (2010)
 */
/* SockJS client, version 0.3.1, http://sockjs.org, MIT License

Copyright (c) 2011-2012 VMware, Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/

// JSON2 by Douglas Crockford (minified).
var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}()

var SockJS;SockJS=function(){var a=document,b=window,c={},d=function(){};d.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={}),a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];c.arrIndexOf(d,b)===-1&&d.push(b);return},d.prototype.removeEventListener=function(a,b){if(!(this._listeners&&a in this._listeners))return;var d=this._listeners[a],e=c.arrIndexOf(d,b);if(e!==-1){d.length>1?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a];return}return},d.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);this["on"+b]&&this["on"+b].apply(this,c);if(this._listeners&&b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)};var e=function(a,b){this.type=a;if(typeof b!="undefined")for(var c in b){if(!b.hasOwnProperty(c))continue;this[c]=b[c]}};e.prototype.toString=function(){var a=[];for(var b in this){if(!this.hasOwnProperty(b))continue;var c=this[b];typeof c=="function"&&(c="[function]"),a.push(b+"="+c)}return"SimpleEvent("+a.join(", ")+")"};var f=function(a){this.events=a||[]};f.prototype.emit=function(a){var b=this,d=Array.prototype.slice.call(arguments,1);!b.nuked&&b["on"+a]&&b["on"+a].apply(b,d),c.arrIndexOf(b.events,a)===-1&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(b.events)+" in "+b)},f.prototype.nuke=function(a){var b=this;b.nuked=!0;for(var c=0;c<b.events.length;c++)delete b[b.events[c]]};var g="abcdefghijklmnopqrstuvwxyz0123456789_";c.random_string=function(a,b){b=b||g.length;var c,d=[];for(c=0;c<a;c++)d.push(g.substr(Math.floor(Math.random()*b),1));return d.join("")},c.random_number=function(a){return Math.floor(Math.random()*a)},c.random_number_string=function(a){var b=(""+(a-1)).length,d=Array(b+1).join("0");return(d+c.random_number(a)).slice(-b)},c.getOrigin=function(a){a+="/";var b=a.split("/").slice(0,3);return b.join("/")},c.isSameOriginUrl=function(a,c){return c||(c=b.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")},c.getParentDomain=function(a){if(/^[0-9.]*$/.test(a))return a;if(/^\[/.test(a))return a;if(!/[.]/.test(a))return a;var b=a.split(".").slice(1);return b.join(".")},c.objectExtend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var h="_jp";c.polluteGlobalNamespace=function(){h in b||(b[h]={})},c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])},c.userSetCode=function(a){return a===1e3||a>=3e3&&a<=4999},c.countRTO=function(a){var b;return a>100?b=3*a:b=a+200,b},c.log=function(){b.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},c.flatUrl=function(a){return a.indexOf("?")===-1&&a.indexOf("#")===-1},c.amendUrl=function(b){var d=a.location;if(!b)throw new Error("Wrong url for SockJS");if(!c.flatUrl(b))throw new Error("Only basic urls are supported in SockJS");return b.indexOf("//")===0&&(b=d.protocol+b),b.indexOf("/")===0&&(b=d.protocol+"//"+d.host+b),b=b.replace(/[/]+$/,""),b},c.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);if(d===-1)return a.slice();var e=a.slice(0,d);return e.concat(a.slice(d+1))},c.isArray=Array.isArray||function(a){return{}.toString.call(a).indexOf("Array")>=0},c.delay=function(a,b){return typeof a=="function"&&(b=a,a=0),setTimeout(b,a)};var i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j={"\0":"\\u0000","\x01":"\\u0001","\x02":"\\u0002","\x03":"\\u0003","\x04":"\\u0004","\x05":"\\u0005","\x06":"\\u0006","\x07":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\x0b":"\\u000b","\f":"\\f","\r":"\\r","\x0e":"\\u000e","\x0f":"\\u000f","\x10":"\\u0010","\x11":"\\u0011","\x12":"\\u0012","\x13":"\\u0013","\x14":"\\u0014","\x15":"\\u0015","\x16":"\\u0016","\x17":"\\u0017","\x18":"\\u0018","\x19":"\\u0019","\x1a":"\\u001a","\x1b":"\\u001b","\x1c":"\\u001c","\x1d":"\\u001d","\x1e":"\\u001e","\x1f":"\\u001f",'"':'\\"',"\\":"\\\\","\x7f":"\\u007f","\x80":"\\u0080","\x81":"\\u0081","\x82":"\\u0082","\x83":"\\u0083","\x84":"\\u0084","\x85":"\\u0085","\x86":"\\u0086","\x87":"\\u0087","\x88":"\\u0088","\x89":"\\u0089","\x8a":"\\u008a","\x8b":"\\u008b","\x8c":"\\u008c","\x8d":"\\u008d","\x8e":"\\u008e","\x8f":"\\u008f","\x90":"\\u0090","\x91":"\\u0091","\x92":"\\u0092","\x93":"\\u0093","\x94":"\\u0094","\x95":"\\u0095","\x96":"\\u0096","\x97":"\\u0097","\x98":"\\u0098","\x99":"\\u0099","\x9a":"\\u009a","\x9b":"\\u009b","\x9c":"\\u009c","\x9d":"\\u009d","\x9e":"\\u009e","\x9f":"\\u009f","\xad":"\\u00ad","\u0600":"\\u0600","\u0601":"\\u0601","\u0602":"\\u0602","\u0603":"\\u0603","\u0604":"\\u0604","\u070f":"\\u070f","\u17b4":"\\u17b4","\u17b5":"\\u17b5","\u200c":"\\u200c","\u200d":"\\u200d","\u200e":"\\u200e","\u200f":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","\u202a":"\\u202a","\u202b":"\\u202b","\u202c":"\\u202c","\u202d":"\\u202d","\u202e":"\\u202e","\u202f":"\\u202f","\u2060":"\\u2060","\u2061":"\\u2061","\u2062":"\\u2062","\u2063":"\\u2063","\u2064":"\\u2064","\u2065":"\\u2065","\u2066":"\\u2066","\u2067":"\\u2067","\u2068":"\\u2068","\u2069":"\\u2069","\u206a":"\\u206a","\u206b":"\\u206b","\u206c":"\\u206c","\u206d":"\\u206d","\u206e":"\\u206e","\u206f":"\\u206f","\ufeff":"\\ufeff","\ufff0":"\\ufff0","\ufff1":"\\ufff1","\ufff2":"\\ufff2","\ufff3":"\\ufff3","\ufff4":"\\ufff4","\ufff5":"\\ufff5","\ufff6":"\\ufff6","\ufff7":"\\ufff7","\ufff8":"\\ufff8","\ufff9":"\\ufff9","\ufffa":"\\ufffa","\ufffb":"\\ufffb","\ufffc":"\\ufffc","\ufffd":"\\ufffd","\ufffe":"\\ufffe","\uffff":"\\uffff"},k=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,l,m=JSON&&JSON.stringify||function(a){return i.lastIndex=0,i.test(a)&&(a=a.replace(i,function(a){return j[a]})),'"'+a+'"'},n=function(a){var b,c={},d=[];for(b=0;b<65536;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};c.quote=function(a){var b=m(a);return k.lastIndex=0,k.test(b)?(l||(l=n(k)),b.replace(k,function(a){return l[a]})):b};var o=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];c.probeProtocols=function(){var a={};for(var b=0;b<o.length;b++){var c=o[b];a[c]=y[c]&&y[c].enabled()}return a},c.detectProtocols=function(a,b,c){var d={},e=[];b||(b=o);for(var f=0;f<b.length;f++){var g=b[f];d[g]=a[g]}var h=function(a){var b=a.shift();d[b]?e.push(b):a.length>0&&h(a)};return c.websocket!==!1&&h(["websocket"]),d["xhr-streaming"]&&!c.null_origin?e.push("xhr-streaming"):d["xdr-streaming"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-streaming"):h(["iframe-eventsource","iframe-htmlfile"]),d["xhr-polling"]&&!c.null_origin?e.push("xhr-polling"):d["xdr-polling"]&&!c.cookie_needed&&!c.null_origin?e.push("xdr-polling"):h(["iframe-xhr-polling","jsonp-polling"]),e};var p="_sockjs_global";c.createHook=function(){var a="a"+c.random_string(8);if(!(p in b)){var d={};b[p]=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return b[p](a)},c.attachMessage=function(a){c.attachEvent("message",a)},c.attachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.addEventListener(c,d,!1):(a.attachEvent("on"+c,d),b.attachEvent("on"+c,d))},c.detachMessage=function(a){c.detachEvent("message",a)},c.detachEvent=function(c,d){typeof b.addEventListener!="undefined"?b.removeEventListener(c,d,!1):(a.detachEvent("on"+c,d),b.detachEvent("on"+c,d))};var q={},r=!1,s=function(){for(var a in q)q[a](),delete q[a]},t=function(){if(r)return;r=!0,s()};c.attachEvent("beforeunload",t),c.attachEvent("unload",t),c.unload_add=function(a){var b=c.random_string(8);return q[b]=a,r&&c.delay(s),b},c.unload_del=function(a){a in q&&delete q[a]},c.createIframe=function(b,d){var e=a.createElement("iframe"),f,g,h=function(){clearTimeout(f);try{e.onload=null}catch(a){}e.onerror=null},i=function(){e&&(h(),setTimeout(function(){e&&e.parentNode.removeChild(e),e=null},0),c.unload_del(g))},j=function(a){e&&(i(),d(a))},k=function(a,b){try{e&&e.contentWindow&&e.contentWindow.postMessage(a,b)}catch(c){}};return e.src=b,e.style.display="none",e.style.position="absolute",e.onerror=function(){j("onerror")},e.onload=function(){clearTimeout(f),f=setTimeout(function(){j("onload timeout")},2e3)},a.body.appendChild(e),f=setTimeout(function(){j("timeout")},15e3),g=c.unload_add(i),{post:k,cleanup:i,loaded:h}},c.createHtmlfile=function(a,d){var e=new ActiveXObject("htmlfile"),f,g,i,j=function(){clearTimeout(f)},k=function(){e&&(j(),c.unload_del(g),i.parentNode.removeChild(i),i=e=null,CollectGarbage())},l=function(a){e&&(k(),d(a))},m=function(a,b){try{i&&i.contentWindow&&i.contentWindow.postMessage(a,b)}catch(c){}};e.open(),e.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),e.close(),e.parentWindow[h]=b[h];var n=e.createElement("div");return e.body.appendChild(n),i=e.createElement("iframe"),n.appendChild(i),i.src=a,f=setTimeout(function(){l("timeout")},15e3),g=c.unload_add(k),{post:m,cleanup:k,loaded:j}};var u=function(){};u.prototype=new f(["chunk","finish"]),u.prototype._start=function(a,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}if(b.ActiveXObject||b.XDomainRequest)d+=(d.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);g.unload_ref=c.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(a,d,!0)}catch(i){g.emit("finish",0,""),g._cleanup();return}if(!f||!f.no_credentials)g.xhr.withCredentials="true";if(f&&f.headers)for(var j in f.headers)g.xhr.setRequestHeader(j,f.headers[j]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(a){}c&&c.length>0&&g.emit("chunk",b,c);break;case 4:g.emit("finish",a.status,a.responseText),g._cleanup(!1)}}},g.xhr.send(e)},u.prototype._cleanup=function(a){var b=this;if(!b.xhr)return;c.unload_del(b.unload_ref),b.xhr.onreadystatechange=function(){};if(a)try{b.xhr.abort()}catch(d){}b.unload_ref=b.xhr=null},u.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)};var v=c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,b)})};v.prototype=new u;var w=c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})};w.prototype=new u;var x=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};x.prototype=new f(["chunk","finish"]),x.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(b.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);var g=f.ontimeout=f.onerror=function(){e.emit("finish",0,""),e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},e.xdr=f,e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(h){g()}},x.prototype._cleanup=function(a){var b=this;if(!b.xdr)return;c.unload_del(b.unload_ref),b.xdr.ontimeout=b.xdr.onerror=b.xdr.onprogress=b.xdr.onload=null;if(a)try{b.xdr.abort()}catch(d){}b.unload_ref=b.xdr=null},x.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)},c.isXHRCorsCapable=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:b.XDomainRequest&&a.domain?2:L.enabled()?3:4};var y=function(a,b,d){var e=this,f;e._options={devel:!1,debug:!1,protocols_whitelist:[],info:undefined,rtt:undefined},d&&c.objectExtend(e._options,d),e._base_url=c.amendUrl(a),e._server=e._options.server||c.random_number_string(1e3),e._options.protocols_whitelist&&e._options.protocols_whitelist.length?f=e._options.protocols_whitelist:(typeof b=="string"&&b.length>0?f=[b]:c.isArray(b)?f=b:f=null,f&&e._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),e._protocols=[],e.protocol=null,e.readyState=y.CONNECTING,e._ir=S(e._base_url),e._ir.onfinish=function(a,b){e._ir=null,a?(e._options.info&&(a=c.objectExtend(a,e._options.info)),e._options.rtt&&(b=e._options.rtt),e._applyInfo(a,b,f),e._didClose()):e._didClose(1002,"Can't connect to server",!0)}};y.prototype=new d,y.version="0.3.1",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},y.prototype._dispatchOpen=function(){var a=this;a.readyState===y.CONNECTING?(a._transport_tref&&(clearTimeout(a._transport_tref),a._transport_tref=null),a.readyState=y.OPEN,a.dispatchEvent(new e("open"))):a._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("message",{data:a}))},y.prototype._dispatchHeartbeat=function(a){var b=this;if(b.readyState!==y.OPEN)return;b.dispatchEvent(new e("heartbeat",{}))},y.prototype._didClose=function(a,b,d){var f=this;if(f.readyState!==y.CONNECTING&&f.readyState!==y.OPEN&&f.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null),f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new e("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===y.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new e("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:g})}f.readyState=y.CLOSED,c.delay(function(){f.dispatchEvent(g)})},y.prototype._didMessage=function(a){var b=this,c=a.slice(0,1);switch(c){case"o":b._dispatchOpen();break;case"a":var d=JSON.parse(a.slice(1)||"[]");for(var e=0;e<d.length;e++)b._dispatchMessage(d[e]);break;case"m":var d=JSON.parse(a.slice(1)||"null");b._dispatchMessage(d);break;case"c":var d=JSON.parse(a.slice(1)||"[]");b._didClose(d[0],d[1]);break;case"h":b._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(b){var d=this;d.protocol&&(d._debug("Closed transport:",d.protocol,""+b),d.protocol=null),d._transport_tref&&(clearTimeout(d._transport_tref),d._transport_tref=null);for(;;){var e=d.protocol=d._protocols.shift();if(!e)return!1;if(y[e]&&y[e].need_body===!0&&(!a.body||typeof a.readyState!="undefined"&&a.readyState!=="complete"))return d._protocols.unshift(e),d.protocol="waiting-for-load",c.attachEvent("load",function(){d._try_next_protocol()}),!0;if(!!y[e]&&!!y[e].enabled(d._options)){var f=y[e].roundTrips||1,g=(d._options.rto||0)*f||5e3;d._transport_tref=c.delay(g,function(){d.readyState===y.CONNECTING&&d._didClose(2007,"Transport timeouted")});var h=c.random_string(8),i=d._base_url+"/"+d._server+"/"+h;return d._debug("Opening transport:",e," url:"+i," RTO:"+d._options.rto),d._transport=new y[e](d,i,d._base_url),!0}d._debug("Skipping transport:",e)}},y.prototype.close=function(a,b){var d=this;if(a&&!c.userSetCode(a))throw new Error("INVALID_ACCESS_ERR");return d.readyState!==y.CONNECTING&&d.readyState!==y.OPEN?!1:(d.readyState=y.CLOSING,d._didClose(a||1e3,b||"Normal closure"),!0)},y.prototype.send=function(a){var b=this;if(b.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return b.readyState===y.OPEN&&b._transport.doSend(c.quote(""+a)),!0},y.prototype._applyInfo=function(b,d,e){var f=this;f._options.info=b,f._options.rtt=d,f._options.rto=c.countRTO(d),f._options.info.null_origin=!a.domain;var g=c.probeProtocols();f._protocols=c.detectProtocols(g,e,b)};var z=y.websocket=function(a,d){var e=this,f=d+"/websocket";f.slice(0,5)==="https"?f="wss"+f.slice(5):f="ws"+f.slice(4),e.ri=a,e.url=f;var g=b.WebSocket||b.MozWebSocket;e.ws=new g(e.url),e.ws.onmessage=function(a){e.ri._didMessage(a.data)},e.unload_ref=c.unload_add(function(){e.ws.close()}),e.ws.onclose=function(){e.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(a){this.ws.send("["+a+"]")},z.prototype.doCleanup=function(){var a=this,b=a.ws;b&&(b.onmessage=b.onclose=null,b.close(),c.unload_del(a.unload_ref),a.unload_ref=a.ri=a.ws=null)},z.enabled=function(){return!!b.WebSocket||!!b.MozWebSocket},z.roundTrips=2;var A=function(){};A.prototype.send_constructor=function(a){var b=this;b.send_buffer=[],b.sender=a},A.prototype.doSend=function(a){var b=this;b.send_buffer.push(a),b.send_stop||b.send_schedule()},A.prototype.send_schedule_wait=function(){var a=this,b;a.send_stop=function(){a.send_stop=null,clearTimeout(b)},b=c.delay(25,function(){a.send_stop=null,a.send_schedule()})},A.prototype.send_schedule=function(){var a=this;if(a.send_buffer.length>0){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(){a.send_stop=null,a.send_schedule_wait()}),a.send_buffer=[]}},A.prototype.send_destructor=function(){var a=this;a._send_stop&&a._send_stop(),a._send_stop=null};var B=function(b,d,e){var f=this;if(!("_send_form"in f)){var g=f._send_form=a.createElement("form"),h=f._send_area=a.createElement("textarea");h.name="d",g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",g.appendChild(h),a.body.appendChild(g)}var g=f._send_form,h=f._send_area,i="a"+c.random_string(8);g.target=i,g.action=b+"/jsonp_send?i="+i;var j;try{j=a.createElement('<iframe name="'+i+'">')}catch(k){j=a.createElement("iframe"),j.name=i}j.id=i,g.appendChild(j),j.style.display="none";try{h.value=d}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}g.submit();var m=function(a){if(!j.onerror)return;j.onreadystatechange=j.onerror=j.onload=null,c.delay(500,function(){j.parentNode.removeChild(j),j=null}),h.value="",e()};return j.onerror=j.onload=m,j.onreadystatechange=function(a){j.readyState=="complete"&&m()},m},C=function(a){return function(b,c,d){var e=new a("POST",b+"/xhr_send",c);return e.onfinish=function(a,b){d(a)},function(a){d(0,a)}}},D=function(b,d){var e,f=a.createElement("script"),g,h=function(a){g&&(g.parentNode.removeChild(g),g=null),f&&(clearTimeout(e),f.parentNode.removeChild(f),f.onreadystatechange=f.onerror=f.onload=f.onclick=null,f=null,d(a),d=null)},i=!1,j=null;f.id="a"+c.random_string(8),f.src=b,f.type="text/javascript",f.charset="UTF-8",f.onerror=function(a){j||(j=setTimeout(function(){i||h(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},f.onload=function(a){h(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},f.onreadystatechange=function(a){if(/loaded|closed/.test(f.readyState)){if(f&&f.htmlFor&&f.onclick){i=!0;try{f.onclick()}catch(b){}}f&&h(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if(typeof f.async=="undefined"&&a.attachEvent)if(!/opera/i.test(navigator.userAgent)){try{f.htmlFor=f.id,f.event="onclick"}catch(k){}f.async=!0}else g=a.createElement("script"),g.text="try{var a = document.getElementById('"+f.id+"'); if(a)a.onerror();}catch(x){};",f.async=g.async=!1;typeof f.async!="undefined"&&(f.async=!0),e=setTimeout(function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=a.getElementsByTagName("head")[0];return l.insertBefore(f,l.firstChild),g&&l.insertBefore(g,l.firstChild),h},E=y["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();var d=this;d.ri=a,d.trans_url=b,d.send_constructor(B),d._schedule_recv()};E.prototype=new A,E.prototype._schedule_recv=function(){var a=this,b=function(b){a._recv_stop=null,b&&(a._is_closing||a.ri._didMessage(b)),a._is_closing||a._schedule_recv()};a._recv_stop=F(a.trans_url+"/jsonp",D,b)},E.enabled=function(){return!0},E.need_body=!0,E.prototype.doCleanup=function(){var a=this;a._is_closing=!0,a._recv_stop&&a._recv_stop(),a.ri=a._recv_stop=null,a.send_destructor()};var F=function(a,d,e){var f="a"+c.random_string(6),g=a+"?c="+escape(h+"."+f),i=function(a){delete b[h][f],e(a)},j=d(g,i);b[h][f]=j;var k=function(){b[h][f]&&b[h][f](c.closeFrame(1e3,"JSONP user aborted read"))};return k},G=function(){};G.prototype=new A,G.prototype.run=function(a,b,c,d,e){var f=this;f.ri=a,f.trans_url=b,f.send_constructor(C(e)),f.poll=new $(a,d,b+c,e)},G.prototype.doCleanup=function(){var a=this;a.poll&&(a.poll.abort(),a.poll=null)};var H=y["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XHRCorsObject)};H.prototype=new G,H.enabled=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},H.roundTrips=2,H.need_body=!0;var I=y["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",bd,c.XDRObject)};I.prototype=new G,I.enabled=function(){return!!b.XDomainRequest},I.roundTrips=2;var J=y["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRCorsObject)};J.prototype=new G,J.enabled=H.enabled,J.roundTrips=2;var K=y["xdr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XDRObject)};K.prototype=new G,K.enabled=I.enabled,K.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a,e.origin=c.getOrigin(d),e.base_url=d,e.trans_url=b;var f=d+"/iframe.html";e.ri._options.devel&&(f+="?t="+ +(new Date)),e.window_id=c.random_string(8),f+="#"+e.window_id,e.iframeObj=c.createIframe(f,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")}),e.onmessage_cb=c.bind(e.onmessage,e),c.attachMessage(e.onmessage_cb)},L.prototype.doCleanup=function(){var a=this;if(a.iframeObj){c.detachMessage(a.onmessage_cb);try{a.iframeObj.iframe.contentWindow&&a.postMessage("c")}catch(b){}a.iframeObj.cleanup(),a.iframeObj=null,a.onmessage_cb=a.iframeObj=null}},L.prototype.onmessage=function(a){var b=this;if(a.origin!==b.origin)return;var c=a.data.slice(0,8),d=a.data.slice(8,9),e=a.data.slice(9);if(c!==b.window_id)return;switch(d){case"s":b.iframeObj.loaded(),b.postMessage("s",JSON.stringify([y.version,b.protocol,b.trans_url,b.base_url]));break;case"t":b.ri._didMessage(e)}},L.prototype.postMessage=function(a,b){var c=this;c.iframeObj.post(c.window_id+a+(b||""),c.origin)},L.prototype.doSend=function(a){this.postMessage("m",a)},L.enabled=function(){var a=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof b.postMessage=="function"||typeof b.postMessage=="object")&&!a};var M,N=function(a,d){parent!==b?parent.postMessage(M+a+(d||""),"*"):c.log("Can't postMessage, no parent window.",a,d)},O=function(){};O.prototype._didClose=function(a,b){N("t",c.closeFrame(a,b))},O.prototype._didMessage=function(a){N("t",a)},O.prototype._doSend=function(a){this._transport.doSend(a)},O.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=undefined,y.bootstrap_iframe=function(){var d;M=a.location.hash.slice(1);var e=function(a){if(a.source!==parent)return;typeof c.parent_origin=="undefined"&&(c.parent_origin=a.origin);if(a.origin!==c.parent_origin)return;var e=a.data.slice(0,8),f=a.data.slice(8,9),g=a.data.slice(9);if(e!==M)return;switch(f){case"s":var h=JSON.parse(g),i=h[0],j=h[1],k=h[2],l=h[3];i!==y.version&&c.log('Incompatibile SockJS! Main site uses: "'+i+'", the iframe:'+' "'+y.version+'".');if(!c.flatUrl(k)||!c.flatUrl(l)){c.log("Only basic urls are supported in SockJS");return}if(!c.isSameOriginUrl(k)||!c.isSameOriginUrl(l)){c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([b.location.href,k,l])+")");return}d=new O,d._transport=new O[j](d,k,l);break;case"m":d._doSend(g);break;case"c":d&&d._doCleanup(),d=null}};c.attachMessage(e),N("s")};var P=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};P.prototype=new f(["finish"]),P.prototype.doXhr=function(a,b){var d=this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8e3,function(){f.ontimeout()});f.onfinish=function(a,b){clearTimeout(g),g=null;if(a===200){var c=(new Date).getTime()-e,f=JSON.parse(b);typeof f!="object"&&(f={}),d.emit("finish",f,c)}else d.emit("finish")},f.ontimeout=function(){f.close(),d.emit("finish")}};var Q=function(b){var d=this,e=function(){var a=new L;a.protocol="w-iframe-info-receiver";var c=function(b){if(typeof b=="string"&&b.substr(0,1)==="m"){var c=JSON.parse(b.substr(1)),e=c[0],f=c[1];d.emit("finish",e,f)}else d.emit("finish");a.doCleanup(),a=null},e={_options:{},_didClose:c,_didMessage:c};a.i_constructor(e,b,b)};a.body?e():c.attachEvent("load",e)};Q.prototype=new f(["finish"]);var R=function(){var a=this;c.delay(function(){a.emit("finish",{},2e3)})};R.prototype=new f(["finish"]);var S=function(a){if(c.isSameOriginUrl(a))return new P(a,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new P(a,c.XHRCorsObject);case 2:return new P(a,c.XDRObject);case 3:return new Q(a);default:return new R}},T=O["w-iframe-info-receiver"]=function(a,b,d){var e=new P(d,c.XHRLocalObject);e.onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c])),a._didClose()}};T.prototype.doCleanup=function(){};var U=y["iframe-eventsource"]=function(){var a=this;a.protocol="w-iframe-eventsource",a.i_constructor.apply(a,arguments)};U.prototype=new L,U.enabled=function(){return"EventSource"in b&&L.enabled()},U.need_body=!0,U.roundTrips=3;var V=O["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",_,c.XHRLocalObject)};V.prototype=new G;var W=y["iframe-xhr-polling"]=function(){var a=this;a.protocol="w-iframe-xhr-polling",a.i_constructor.apply(a,arguments)};W.prototype=new L,W.enabled=function(){return b.XMLHttpRequest&&L.enabled()},W.need_body=!0,W.roundTrips=3;var X=O["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",bd,c.XHRLocalObject)};X.prototype=new G;var Y=y["iframe-htmlfile"]=function(){var a=this;a.protocol="w-iframe-htmlfile",a.i_constructor.apply(a,arguments)};Y.prototype=new L,Y.enabled=function(){return L.enabled()},Y.need_body=!0,Y.roundTrips=3;var Z=O["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",bc,c.XHRLocalObject)};Z.prototype=new G;var $=function(a,b,c,d){var e=this;e.ri=a,e.Receiver=b,e.recv_url=c,e.AjaxObject=d,e._scheduleRecv()};$.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1,a.ri._didMessage(b.data)},b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null,a.poll_is_closing||(c.reason==="permanent"?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}},$.prototype.abort=function(){var a=this;a.poll_is_closing=!0,a.poll&&a.poll.abort()};var _=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new e("message",{data:unescape(a.data)}))},b.es_close=d.onerror=function(a,f){var g=f?"user":d.readyState!==2?"network":"permanent";b.es_close=d.onmessage=d.onerror=null,d.close(),d=null,c.delay(200,function(){b.dispatchEvent(new e("close",{reason:g}))})}};_.prototype=new d,_.prototype.abort=function(){var a=this;a.es_close&&a.es_close({},!0)};var ba,bb=function(){if(ba===undefined)if("ActiveXObject"in b)try{ba=!!(new ActiveXObject("htmlfile"))}catch(a){}else ba=!1;return ba},bc=function(a){var d=this;c.polluteGlobalNamespace(),d.id="a"+c.random_string(6,26),a+=(a.indexOf("?")===-1?"?":"&")+"c="+escape(h+"."+d.id);var f=bb()?c.createHtmlfile:c.createIframe,g;b[h][d.id]={start:function(){g.loaded()},message:function(a){d.dispatchEvent(new e("message",{data:a}))},stop:function(){d.iframe_close({},"network")}},d.iframe_close=function(a,c){g.cleanup(),d.iframe_close=g=null,delete b[h][d.id],d.dispatchEvent(new e("close",{reason:c}))},g=f(a,function(a){d.iframe_close({},"permanent")})};bc.prototype=new d,bc.prototype.abort=function(){var a=this;a.iframe_close&&a.iframe_close({},"user")};var bd=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null),c.xo.onchunk=function(a,b){if(a!==200)return;for(;;){var f=b.slice(d),g=f.indexOf("\n");if(g===-1)break;d+=g+1;var h=f.slice(0,g);c.dispatchEvent(new e("message",{data:h}))}},c.xo.onfinish=function(a,b){c.xo.onchunk(a,b),c.xo=null;var d=a===200?"network":"permanent";c.dispatchEvent(new e("close",{reason:d}))}};return bd.prototype=new d,bd.prototype.abort=function(){var a=this;a.xo&&(a.xo.close(),a.dispatchEvent(new e("close",{reason:"user"})),a.xo=null)},y.getUtils=function(){return c},y.getIframeTransport=function(){return L},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),typeof define=="function"&&define.amd&&define("sockjs",[],function(){return SockJS})
;
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.opentype=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";exports.argument=function(r,t){if(!r)throw new Error(t)},exports.assert=exports.argument;
},{}],2:[function(require,module,exports){
"use strict";function line(e,i,n,o,t){e.beginPath(),e.moveTo(i,n),e.lineTo(o,t),e.stroke()}exports.line=line;
},{}],3:[function(require,module,exports){
"use strict";function DefaultEncoding(e){this.font=e}function CmapEncoding(e){this.cmap=e}function CffEncoding(e,l){this.encoding=e,this.charset=l}function GlyphNames(e){var l;switch(e.version){case 1:this.names=exports.standardNames.slice();break;case 2:for(this.names=new Array(e.numberOfGlyphs),l=0;l<e.numberOfGlyphs;l++)this.names[l]=e.glyphNameIndex[l]<exports.standardNames.length?exports.standardNames[e.glyphNameIndex[l]]:e.names[e.glyphNameIndex[l]-exports.standardNames.length];break;case 2.5:for(this.names=new Array(e.numberOfGlyphs),l=0;l<e.numberOfGlyphs;l++)this.names[l]=exports.standardNames[l+e.glyphNameIndex[l]];break;case 3:this.names=[]}}function addGlyphNames(e){var l,r,s,a,i,o;for(l=e.tables.cmap.glyphIndexMap,r=Object.keys(l),s=0;s<r.length;s+=1)a=r[s],i=l[a],o=e.glyphs[i],o.addUnicode(parseInt(a));for(s=0;s<e.glyphs.length;s+=1)o=e.glyphs[s],o.name=e.cffEncoding?e.cffEncoding.charset[s]:e.glyphNames.glyphIndexToName(s)}var cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];DefaultEncoding.prototype.charToGlyphIndex=function(e){var l,r,s,a,i;if(l=e.charCodeAt(0),r=this.font.glyphs,!r)return null;for(s=0;s<r.length;s+=1)for(a=r[s],i=0;i<a.unicodes.length;i+=1)if(a.unicodes[i]===l)return s},CmapEncoding.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.charCodeAt(0)]||0},CffEncoding.prototype.charToGlyphIndex=function(e){var l,r;return l=e.charCodeAt(0),r=this.encoding[l],this.charset.indexOf(r)},GlyphNames.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},GlyphNames.prototype.glyphIndexToName=function(e){return this.names[e]},exports.cffStandardStrings=cffStandardStrings,exports.cffStandardEncoding=cffStandardEncoding,exports.cffExpertEncoding=cffExpertEncoding,exports.standardNames=standardNames,exports.DefaultEncoding=DefaultEncoding,exports.CmapEncoding=CmapEncoding,exports.CffEncoding=CffEncoding,exports.GlyphNames=GlyphNames,exports.addGlyphNames=addGlyphNames;
},{}],4:[function(require,module,exports){
"use strict";function Font(t){t=t||{},this.familyName=t.familyName||" ",this.styleName=t.styleName||" ",this.designer=t.designer||" ",this.designerURL=t.designerURL||" ",this.manufacturer=t.manufacturer||" ",this.manufacturerURL=t.manufacturerURL||" ",this.license=t.license||" ",this.licenseURL=t.licenseURL||" ",this.version=t.version||"Version 0.1",this.description=t.description||" ",this.copyright=t.copyright||" ",this.trademark=t.trademark||" ",this.unitsPerEm=t.unitsPerEm||1e3,this.supported=!0,this.glyphs=t.glyphs||[],this.encoding=new encoding.DefaultEncoding(this),this.tables={}}var path=require("./path"),sfnt=require("./tables/sfnt"),encoding=require("./encoding");Font.prototype.hasChar=function(t){return null!==this.encoding.charToGlyphIndex(t)},Font.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},Font.prototype.charToGlyph=function(t){var e,n;return e=this.charToGlyphIndex(t),n=this.glyphs[e],n||(n=this.glyphs[0]),n},Font.prototype.stringToGlyphs=function(t){var e,n,i;for(i=[],e=0;e<t.length;e+=1)n=t[e],i.push(this.charToGlyph(n));return i},Font.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},Font.prototype.nameToGlyph=function(t){var e,n;return e=this.nametoGlyphIndex(t),n=this.glyphs[e],n||(n=this.glyphs[0]),n},Font.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},Font.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var n=this.getGposKerningValue;return n?n(t,e):this.kerningPairs[t+","+e]||0},Font.prototype.forEachGlyph=function(t,e,n,i,o,r){var s,h,a,p,u,c;if(this.supported)for(e=void 0!==e?e:0,n=void 0!==n?n:0,i=void 0!==i?i:72,o=o||{},s=void 0===o.kerning?!0:o.kerning,h=1/this.unitsPerEm*i,a=this.stringToGlyphs(t),p=0;p<a.length;p+=1)u=a[p],r(u,e,n,i,o),u.advanceWidth&&(e+=u.advanceWidth*h),s&&p<a.length-1&&(c=this.getKerningValue(u,a[p+1]),e+=c*h)},Font.prototype.getPath=function(t,e,n,i,o){var r=new path.Path;return this.forEachGlyph(t,e,n,i,o,function(t,e,n,i){var o=t.getPath(e,n,i);r.extend(o)}),r},Font.prototype.draw=function(t,e,n,i,o,r){this.getPath(e,n,i,o,r).draw(t)},Font.prototype.drawPoints=function(t,e,n,i,o,r){this.forEachGlyph(e,n,i,o,r,function(e,n,i,o){e.drawPoints(t,n,i,o)})},Font.prototype.drawMetrics=function(t,e,n,i,o,r){this.forEachGlyph(e,n,i,o,r,function(e,n,i,o){e.drawMetrics(t,n,i,o)})},Font.prototype.validate=function(){function t(t,e){t||n.push(e)}function e(e){t(i[e]&&i[e].trim().length>0,"No "+e+" specified.")}var n=[],i=this;e("familyName"),e("weightName"),e("manufacturer"),e("copyright"),e("version"),t(this.unitsPerEm>0,"No unitsPerEm specified.")},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){for(var t=this.toTables(),e=t.encode(),n=new ArrayBuffer(e.length),i=new Uint8Array(n),o=0;o<e.length;o++)i[o]=e[o];return n},Font.prototype.download=function(){var t=this.familyName.replace(/\s/g,"")+"-"+this.styleName+".otf",e=this.toBuffer();window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,e.byteLength,function(n){n.root.getFile(t,{create:!0},function(t){t.createWriter(function(n){var i=new DataView(e),o=new Blob([i],{type:"font/opentype"});n.write(o),n.addEventListener("writeend",function(){location.href=t.toURL()},!1)})})},function(t){throw t})},exports.Font=Font;
},{"./encoding":3,"./path":8,"./tables/sfnt":23}],5:[function(require,module,exports){
"use strict";function Glyph(t){this.font=t.font||null,this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||void 0!==t.unicode?[t.unicode]:[],this.xMin=t.xMin||0,this.yMin=t.yMin||0,this.xMax=t.xMax||0,this.yMax=t.yMax||0,this.advanceWidth=t.advanceWidth||0,this.path=t.path||null}var check=require("./check"),draw=require("./draw"),path=require("./path");Glyph.prototype.addUnicode=function(t){0===this.unicodes.length&&(this.unicode=t),this.unicodes.push(t)},Glyph.prototype.getPath=function(t,i,e){var n,h,o,a;t=void 0!==t?t:0,i=void 0!==i?i:0,e=void 0!==e?e:72,n=1/this.font.unitsPerEm*e,h=new path.Path,o=this.path.commands;for(var r=0;r<o.length;r+=1)a=o[r],"M"===a.type?h.moveTo(t+a.x*n,i+-a.y*n):"L"===a.type?h.lineTo(t+a.x*n,i+-a.y*n):"Q"===a.type?h.quadraticCurveTo(t+a.x1*n,i+-a.y1*n,t+a.x*n,i+-a.y*n):"C"===a.type?h.curveTo(t+a.x1*n,i+-a.y1*n,t+a.x2*n,i+-a.y2*n,t+a.x*n,i+-a.y*n):"Z"===a.type&&h.closePath();return h},Glyph.prototype.getContours=function(){var t,i,e,n;if(void 0===this.points)return[];for(t=[],i=[],e=0;e<this.points.length;e+=1)n=this.points[e],i.push(n),n.lastPointOfContour&&(t.push(i),i=[]);return check.argument(0===i.length,"There are still points left in the current contour."),t},Glyph.prototype.getMetrics=function(){for(var t=this.path.commands,i=[],e=[],n=0;n<t.length;n+=1){var h=t[n];"Z"!==h.type&&(i.push(h.x),e.push(h.y)),("Q"===h.type||"C"===h.type)&&(i.push(h.x1),e.push(h.y1)),"C"===h.type&&(i.push(h.x2),e.push(h.y2))}var o={xMin:Math.min.apply(null,i),yMin:Math.min.apply(null,e),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,e),leftSideBearing:0};return o.rightSideBearing=this.advanceWidth-o.leftSideBearing-(o.xMax-o.xMin),o},Glyph.prototype.draw=function(t,i,e,n){this.getPath(i,e,n).draw(t)},Glyph.prototype.drawPoints=function(t,i,e,n){function h(i,e,n,h){var o,a=2*Math.PI;for(t.beginPath(),o=0;o<i.length;o+=1)t.moveTo(e+i[o].x*h,n+i[o].y*h),t.arc(e+i[o].x*h,n+i[o].y*h,2,0,a,!1);t.closePath(),t.fill()}var o,a,r,s,l,p;for(i=void 0!==i?i:0,e=void 0!==e?e:0,n=void 0!==n?n:24,o=1/this.font.unitsPerEm*n,r=[],s=[],l=this.path,a=0;a<l.commands.length;a+=1)p=l.commands[a],void 0!==p.x&&r.push({x:p.x,y:-p.y}),void 0!==p.x1&&s.push({x:p.x1,y:-p.y1}),void 0!==p.x2&&s.push({x:p.x2,y:-p.y2});t.fillStyle="blue",h(r,i,e,o),t.fillStyle="red",h(s,i,e,o)},Glyph.prototype.drawMetrics=function(t,i,e,n){var h;i=void 0!==i?i:0,e=void 0!==e?e:0,n=void 0!==n?n:24,h=1/this.font.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",draw.line(t,i,-1e4,i,1e4),draw.line(t,-1e4,e,1e4,e),t.strokeStyle="blue",draw.line(t,i+this.xMin*h,-1e4,i+this.xMin*h,1e4),draw.line(t,i+this.xMax*h,-1e4,i+this.xMax*h,1e4),draw.line(t,-1e4,e+-this.yMin*h,1e4,e+-this.yMin*h),draw.line(t,-1e4,e+-this.yMax*h,1e4,e+-this.yMax*h),t.strokeStyle="green",draw.line(t,i+this.advanceWidth*h,-1e4,i+this.advanceWidth*h,1e4)},exports.Glyph=Glyph;
},{"./check":1,"./draw":2,"./path":8}],6:[function(require,module,exports){
"use strict";function toArrayBuffer(e){var a,r=new ArrayBuffer(e.length),s=new Uint8Array(r);for(a=0;a<e.length;a+=1)s[a]=e[a];return r}function loadFromFile(e,a){var r=require("fs");r.readFile(e,function(e,r){return e?a(e.message):void a(null,toArrayBuffer(r))})}function loadFromUrl(e,a){var r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){return 200!==r.status?a("Font could not be loaded: "+r.statusText):a(null,r.response)},r.send()}function parseBuffer(e){var a,r,s,t,n,o,p,l,i,u,c,f,h,d,m,b,g,y;if(a=new _font.Font,r=new DataView(e,0),s=parse.getFixed(r,0),1===s)a.outlinesFormat="truetype";else{if(s=parse.getTag(r,0),"OTTO"!==s)throw new Error("Unsupported OpenType version "+s);a.outlinesFormat="cff"}for(t=parse.getUShort(r,4),o=12,n=0;t>n;n+=1){switch(p=parse.getTag(r,o),l=parse.getULong(r,o+8),p){case"cmap":a.tables.cmap=cmap.parse(r,l),a.encoding=new encoding.CmapEncoding(a.tables.cmap),a.encoding||(a.supported=!1);break;case"head":a.tables.head=head.parse(r,l),a.unitsPerEm=a.tables.head.unitsPerEm,m=a.tables.head.indexToLocFormat;break;case"hhea":a.tables.hhea=hhea.parse(r,l),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":i=l;break;case"maxp":a.tables.maxp=maxp.parse(r,l),a.numGlyphs=b=a.tables.maxp.numGlyphs;break;case"name":a.tables.name=_name.parse(r,l),a.familyName=a.tables.name.fontFamily,a.styleName=a.tables.name.fontSubfamily;break;case"OS/2":a.tables.os2=os2.parse(r,l);break;case"post":a.tables.post=post.parse(r,l),a.glyphNames=new encoding.GlyphNames(a.tables.post);break;case"glyf":u=l;break;case"loca":c=l;break;case"CFF ":f=l;break;case"kern":h=l;break;case"GPOS":d=l}o+=16}return u&&c?(y=0===m,g=loca.parse(r,c,b,y),a.glyphs=glyf.parse(r,u,g,a),hmtx.parse(r,i,a.numberOfHMetrics,a.numGlyphs,a.glyphs),encoding.addGlyphNames(a)):f?(cff.parse(r,f,a),encoding.addGlyphNames(a)):a.supported=!1,a.supported&&(a.kerningPairs=h?kern.parse(r,h):{},d&&gpos.parse(r,d,a)),a}function load(e,a){var r="undefined"==typeof window,s=r?loadFromFile:loadFromUrl;s(e,function(e,r){if(e)return a(e);var s=parseBuffer(r);return s.supported?a(null,s):a("Font is not supported (is this a Postscript font?)")})}var encoding=require("./encoding"),_font=require("./font"),glyph=require("./glyph"),parse=require("./parse"),path=require("./path"),cmap=require("./tables/cmap"),cff=require("./tables/cff"),glyf=require("./tables/glyf"),gpos=require("./tables/gpos"),head=require("./tables/head"),hhea=require("./tables/hhea"),hmtx=require("./tables/hmtx"),kern=require("./tables/kern"),loca=require("./tables/loca"),maxp=require("./tables/maxp"),_name=require("./tables/name"),os2=require("./tables/os2"),post=require("./tables/post");exports.Font=_font.Font,exports.Glyph=glyph.Glyph,exports.Path=path.Path,exports.parse=parseBuffer,exports.load=load;
},{"./encoding":3,"./font":4,"./glyph":5,"./parse":7,"./path":8,"./tables/cff":10,"./tables/cmap":11,"./tables/glyf":12,"./tables/gpos":13,"./tables/head":14,"./tables/hhea":15,"./tables/hmtx":16,"./tables/kern":17,"./tables/loca":18,"./tables/maxp":19,"./tables/name":20,"./tables/os2":21,"./tables/post":22,"fs":undefined}],7:[function(require,module,exports){
"use strict";function Parser(t,e){this.data=t,this.offset=e,this.relativeOffset=0}exports.getByte=function(t,e){return t.getUint8(e)},exports.getCard8=exports.getByte,exports.getUShort=function(t,e){return t.getUint16(e,!1)},exports.getCard16=exports.getUShort,exports.getShort=function(t,e){return t.getInt16(e,!1)},exports.getULong=function(t,e){return t.getUint32(e,!1)},exports.getFixed=function(t,e){var r,s;return r=t.getInt16(e,!1),s=t.getUint16(e+2,!1),r+s/65535},exports.getTag=function(t,e){var r,s="";for(r=e;e+4>r;r+=1)s+=String.fromCharCode(t.getInt8(r));return s},exports.getOffset=function(t,e,r){var s,o;for(o=0,s=0;r>s;s+=1)o<<=8,o+=t.getUint8(e+s);return o},exports.getBytes=function(t,e,r){var s,o;for(s=[],o=e;r>o;o+=1)s.push(t.getUint8(o));return s},exports.bytesToString=function(t){var e,r;for(e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e};var typeOffsets={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};Parser.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},Parser.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},Parser.prototype.parseULong=function(){var t=exports.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseFixed=function(){var t=exports.getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(t){for(var e=new Array(t),r=this.data,s=this.offset+this.relativeOffset,o=0;t>o;o++)e[o]=exports.getUShort(r,s),s+=2;return this.relativeOffset+=2*t,e},Parser.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,s="";this.relativeOffset+=t;for(var o=0;t>o;o++)s+=String.fromCharCode(e.getUint8(r+o));return s},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var t=exports.getULong(this.data,this.offset+this.relativeOffset+4);return this.relativeOffset+=8,t},Parser.prototype.parseFixed=function(){var t=exports.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t/65536},Parser.prototype.parseVersion=function(){var t=exports.getUShort(this.data,this.offset+this.relativeOffset),e=exports.getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t+e/4096/10},Parser.prototype.skip=function(t,e){void 0===e&&(e=1),this.relativeOffset+=typeOffsets[t]*e},exports.Parser=Parser;
},{}],8:[function(require,module,exports){
"use strict";function Path(){this.commands=[]}Path.prototype.moveTo=function(t,o){this.commands.push({type:"M",x:t,y:o})},Path.prototype.lineTo=function(t,o){this.commands.push({type:"L",x:t,y:o})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(t,o,e,a,n,p){this.commands.push({type:"C",x1:t,y1:o,x2:e,y2:a,x:n,y:p})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(t,o,e,a){this.commands.push({type:"Q",x1:t,y1:o,x:e,y:a})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(t){t.commands&&(t=t.commands),Array.prototype.push.apply(this.commands,t)},Path.prototype.draw=function(t){var o,e;for(t.beginPath(),o=0;o<this.commands.length;o+=1)e=this.commands[o],"M"===e.type?t.moveTo(e.x,e.y):"L"===e.type?t.lineTo(e.x,e.y):"C"===e.type?t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y):"Q"===e.type?t.quadraticCurveTo(e.x1,e.y1,e.x,e.y):"Z"===e.type&&t.closePath();t.fill(),t.stroke()},Path.prototype.toPathData=function(t){function o(o){return Math.round(o)===o?""+Math.round(o):o.toFixed(t)}function e(){for(var t="",e=0;e<arguments.length;e+=1){var a=arguments[e];a>=0&&e>0&&(t+=" "),t+=o(a)}return t}t=void 0!==t?t:2;for(var a="",n=0;n<this.commands.length;n+=1){var p=this.commands[n];"M"===p.type?a+="M"+e(p.x,p.y):"L"===p.type?a+="L"+e(p.x,p.y):"C"===p.type?a+="C"+e(p.x1,p.y1,p.x2,p.y2,p.x,p.y):"Q"===p.type?a+="Q"+e(p.x1,p.y1,p.x,p.y):"Z"===p.type&&(a+="Z")}return a},Path.prototype.toSVG=function(t,o,e,a){var n='<path d="';return n+=this.toPathData(t),n+='"',o&&"black"!==o&&(n+=null===o?' fill="none"':' fill="'+o+'"'),e&&(n+=' stroke="'+e+'" stroke-width="'+(a||1)+'"'),n+="/>"},exports.Path=Path;
},{}],9:[function(require,module,exports){
"use strict";function Table(e,t,i){var s;for(s=0;s<t.length;s+=1){var r=t[s];this[r.name]=r.value}if(this.tableName=e,this.fields=t,i){var f=Object.keys(i);for(s=0;s<f.length;s+=1){var n=f[s],o=i[n];void 0!==this[n]&&(this[n]=o)}}}var check=require("./check"),encode=require("./types").encode,sizeOf=require("./types").sizeOf;Table.prototype.sizeOf=function(){for(var e=0,t=0;t<this.fields.length;t+=1){var i=this.fields[t],s=this[i.name];if(void 0===s&&(s=i.value),"function"==typeof s.sizeOf)e+=s.sizeOf();else{var r=sizeOf[i.type];check.assert("function"==typeof r,"Could not find sizeOf function for field"+i.name),e+=r(s)}}return e},Table.prototype.encode=function(){return encode.TABLE(this)},exports.Table=Table;
},{"./check":1,"./types":24}],10:[function(require,module,exports){
"use strict";function equals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a+=1)if(!equals(e[a],t[a]))return!1;return!0}return!1}function parseCFFIndex(e,t,a){var r,n,s,i,p,o,u,f,h;if(r=[],n=[],s=parse.getCard16(e,t),0!==s){for(p=parse.getByte(e,t+2),o=t+(s+1)*p+2,u=t+3,f=0;s+1>f;f+=1)r.push(parse.getOffset(e,u,p)),u+=p;i=o+r[s]}else i=t+2;for(f=0;f<r.length-1;f+=1)h=parse.getBytes(e,o+r[f],o+r[f+1]),a&&(h=a(h)),n.push(h);return{objects:n,startOffset:t,endOffset:i}}function parseFloatOperand(e){var t,a,r,n,s,i;for(t="",a=15,r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){if(n=e.parseByte(),s=n>>4,i=15&n,s===a)break;if(t+=r[s],i===a)break;t+=r[i]}return parseFloat(t)}function parseOperand(e,t){var a,r,n,s;if(28===t)return a=e.parseByte(),r=e.parseByte(),a<<8|r;if(29===t)return a=e.parseByte(),r=e.parseByte(),n=e.parseByte(),s=e.parseByte(),a<<24|r<<16|n<<8|s;if(30===t)return parseFloatOperand(e);if(t>=32&&246>=t)return t-139;if(t>=247&&250>=t)return a=e.parseByte(),256*(t-247)+a+108;if(t>=251&&254>=t)return a=e.parseByte(),256*-(t-251)-a-108;throw new Error("Invalid b0 "+t)}function entriesToObject(e){var t,a,r,n,s;for(t={},n=0;n<e.length;n+=1){if(a=e[n][0],r=e[n][1],s=1===r.length?r[0]:r,t.hasOwnProperty(a))throw new Error("Object "+t+" already has key "+a);t[a]=s}return t}function parseCFFDict(e,t,a){var r,n,s,i;for(t=void 0!==t?t:0,r=new parse.Parser(e,t),n=[],s=[],a=void 0!==a?a:e.length;r.relativeOffset<a;)i=r.parseByte(),21>=i?(12===i&&(i=1200+r.parseByte()),n.push([i,s]),s=[]):s.push(parseOperand(r,i));return entriesToObject(n)}function getCFFString(e,t){return t=390>=t?encoding.cffStandardStrings[t]:e[t-391]}function interpretDict(e,t,a){var r,n,s,i;for(i={},r=0;r<t.length;r+=1)n=t[r],s=e[n.op],void 0===s&&(s=void 0!==n.value?n.value:null),"SID"===n.type&&(s=getCFFString(a,s)),i[n.name]=s;return i}function parseCFFHeader(e,t){var a={};return a.formatMajor=parse.getCard8(e,t),a.formatMinor=parse.getCard8(e,t+1),a.size=parse.getCard8(e,t+2),a.offsetSize=parse.getCard8(e,t+3),a.startOffset=t,a.endOffset=t+4,a}function parseCFFTopDict(e,t){var a;return a=parseCFFDict(e,0,e.byteLength),interpretDict(a,TOP_DICT_META,t)}function parseCFFPrivateDict(e,t,a,r){var n;return n=parseCFFDict(e,t,a),interpretDict(n,PRIVATE_DICT_META,r)}function parseCFFCharset(e,t,a,r){var n,s,i,p,o,u;if(n=new parse.Parser(e,t),a-=1,i=[".notdef"],s=n.parseCard8(),0===s)for(p=0;a>p;p+=1)o=n.parseSID(),i.push(getCFFString(r,o));else if(1===s)for(;i.length<=a;)for(o=n.parseSID(),u=n.parseCard8(),p=0;u>=p;p+=1)i.push(getCFFString(r,o)),o+=1;else{if(2!==s)throw new Error("Unknown charset format "+s);for(;i.length<=a;)for(o=n.parseSID(),u=n.parseCard16(),p=0;u>=p;p+=1)i.push(getCFFString(r,o)),o+=1}return i}function parseCFFEncoding(e,t,a){var r,n,s,i,p,o,u,f,h,l;if(r={},n=new parse.Parser(e,t),s=n.parseCard8(),0===s)for(i=n.parseCard8(),p=0;i>p;p+=1)o=n.parseCard8(),r[o]=p;else{if(1!==s)throw new Error("Unknown encoding format "+s);for(u=n.parseCard8(),o=1,p=0;u>p;p+=1)for(f=n.parseCard8(),h=n.parseCard8(),l=f;f+h>=l;l+=1)r[l]=o,o+=1}return new encoding.CffEncoding(r,a)}function parseCFFCharstring(e,t,a){function r(){var e;e=p.length%2!==0,e&&!u&&(f=p.shift()+t.nominalWidthX),o+=p.length>>1,p.length=0,u=!0}function n(e){var i,y,b,T,C,I,F;for(i=0;i<e.length;)switch(v=e[i],i+=1,v){case 1:r();break;case 3:r();break;case 4:p.length>1&&!u&&(f=p.shift()+t.nominalWidthX,u=!0),l+=p.pop(),s.moveTo(h,l);break;case 5:for(;p.length>0;)h+=p.shift(),l+=p.shift(),s.lineTo(h,l);break;case 6:for(;p.length>0&&(h+=p.shift(),s.lineTo(h,l),0!==p.length);)l+=p.shift(),s.lineTo(h,l);break;case 7:for(;p.length>0&&(l+=p.shift(),s.lineTo(h,l),0!==p.length);)h+=p.shift(),s.lineTo(h,l);break;case 8:for(;p.length>0;)c=h+p.shift(),d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g+p.shift(),s.curveTo(c,d,m,g,h,l);break;case 10:I=p.pop()+t.subrsBias,F=t.subrs[I],F&&n(F);break;case 11:return;case 12:v=e[i],i+=1;break;case 14:p.length>0&&!u&&(f=p.shift()+t.nominalWidthX,u=!0),s.closePath();break;case 18:r();break;case 19:case 20:r(),i+=o+7>>3;break;case 21:p.length>2&&!u&&(f=p.shift()+t.nominalWidthX,u=!0),l+=p.pop(),h+=p.pop(),s.moveTo(h,l);break;case 22:p.length>1&&!u&&(f=p.shift()+t.nominalWidthX,u=!0),h+=p.pop(),s.moveTo(h,l);break;case 23:r();break;case 24:for(;p.length>2;)c=h+p.shift(),d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g+p.shift(),s.curveTo(c,d,m,g,h,l);h+=p.shift(),l+=p.shift(),s.lineTo(h,l);break;case 25:for(;p.length>6;)h+=p.shift(),l+=p.shift(),s.lineTo(h,l);c=h+p.shift(),d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g+p.shift(),s.curveTo(c,d,m,g,h,l);break;case 26:for(p.length%2&&(h+=p.shift());p.length>0;)c=h,d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m,l=g+p.shift(),s.curveTo(c,d,m,g,h,l);break;case 27:for(p.length%2&&(l+=p.shift());p.length>0;)c=h+p.shift(),d=l,m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g,s.curveTo(c,d,m,g,h,l);break;case 28:y=e[i],b=e[i+1],p.push((y<<24|b<<16)>>16),i+=2;break;case 29:I=p.pop()+t.gsubrsBias,F=t.gsubrs[I],F&&n(F);break;case 30:for(;p.length>0&&(c=h,d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g+(1===p.length?p.shift():0),s.curveTo(c,d,m,g,h,l),0!==p.length);)c=h+p.shift(),d=l,m=c+p.shift(),g=d+p.shift(),l=g+p.shift(),h=m+(1===p.length?p.shift():0),s.curveTo(c,d,m,g,h,l);break;case 31:for(;p.length>0&&(c=h+p.shift(),d=l,m=c+p.shift(),g=d+p.shift(),l=g+p.shift(),h=m+(1===p.length?p.shift():0),s.curveTo(c,d,m,g,h,l),0!==p.length);)c=h,d=l+p.shift(),m=c+p.shift(),g=d+p.shift(),h=m+p.shift(),l=g+(1===p.length?p.shift():0),s.curveTo(c,d,m,g,h,l);break;default:32>v?console.log("Glyph "+a+": unknown operator "+v):247>v?p.push(v-139):251>v?(y=e[i],i+=1,p.push(256*(v-247)+y+108)):255>v?(y=e[i],i+=1,p.push(256*-(v-251)-y-108)):(y=e[i],b=e[i+1],T=e[i+2],C=e[i+3],i+=4,p.push((y<<24|b<<16|T<<8|C)/65536))}}var s,i,p,o,u,f,h,l,c,d,m,g,v;return s=new path.Path,p=[],o=0,u=!1,f=t.defaultWidthX,h=l=0,n(e),i=new _glyph.Glyph({font:t,index:a}),i.path=s,i.advanceWidth=f,i}function calcCFFSubroutineBias(e){var t;return t=e.length<1240?107:e.length<33900?1131:32768}function parseCFFTable(e,t,a){var r,n,s,i,p,o,u,f,h,l,c,d,m,g;a.tables.cff={},r=parseCFFHeader(e,t),n=parseCFFIndex(e,r.endOffset,parse.bytesToString),s=parseCFFIndex(e,n.endOffset),i=parseCFFIndex(e,s.endOffset,parse.bytesToString),p=parseCFFIndex(e,i.endOffset),a.gsubrs=p.objects,a.gsubrsBias=calcCFFSubroutineBias(a.gsubrs);var v=new DataView(new Uint8Array(s.objects[0]).buffer);for(o=parseCFFTopDict(v,i.objects),a.tables.cff.topDict=o,u=t+o["private"][1],f=parseCFFPrivateDict(e,u,o["private"][0],i.objects),a.defaultWidthX=f.defaultWidthX,a.nominalWidthX=f.nominalWidthX,0!==f.subrs?(h=u+f.subrs,l=parseCFFIndex(e,h),a.subrs=l.objects,a.subrsBias=calcCFFSubroutineBias(a.subrs)):(a.subrs=[],a.subrsBias=0),d=parseCFFIndex(e,t+o.charStrings),a.nGlyphs=d.objects.length,m=parseCFFCharset(e,t+o.charset,a.nGlyphs,i.objects),a.cffEncoding=0===o.encoding?new encoding.CffEncoding(encoding.cffStandardEncoding,m):1===o.encoding?new encoding.CffEncoding(encoding.cffExpertEncoding,m):parseCFFEncoding(e,t+o.encoding,m),a.encoding=a.encoding||a.cffEncoding,a.glyphs=[],g=0;g<a.nGlyphs;g+=1)c=d.objects[g],a.glyphs.push(parseCFFCharstring(c,a,g))}function encodeString(e,t){var a,r;return a=encoding.cffStandardStrings.indexOf(e),a>=0&&(r=a),a=t.indexOf(e),a>=0?r=a+encoding.cffStandardStrings.length:(r=encoding.cffStandardStrings.length+t.length,t.push(e)),r}function makeHeader(){return new table.Table("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(e){var t=new table.Table("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var a=0;a<e.length;a+=1)t.names.push({name:"name_"+a,type:"NAME",value:e[a]});return t}function makeDict(e,t,a){var r,n,s,i={};for(r=0;r<e.length;r+=1)n=e[r],s=t[n.name],void 0===s||equals(s,n.value)||("SID"===n.type&&(s=encodeString(s,a)),i[n.op]={name:n.name,type:n.type,value:s});return i}function makeTopDict(e,t){var a=new table.Table("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=makeDict(TOP_DICT_META,e,t),a}function makeTopDictIndex(e){var t=new table.Table("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function makeStringIndex(e){var t=new table.Table("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var a=0;a<e.length;a+=1)t.strings.push({name:"string_"+a,type:"STRING",value:e[a]});return t}function makeGlobalSubrIndex(){return new table.Table("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(e,t){for(var a=new table.Table("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<e.length;r+=1){var n=e[r],s=encodeString(n,t);a.fields.push({name:"glyph_"+r,type:"SID",value:s})}return a}function glyphToOps(e){var t,a,r,n,s,i,p,o,u,f,h=[],l=e.path;for(h.push({name:"width",type:"NUMBER",value:e.advanceWidth}),t=0,a=0,r=0;r<l.commands.length;r+=1)if(n=l.commands[r],"M"===n.type)s=n.x-t,i=n.y-a,h.push({name:"dx",type:"NUMBER",value:s}),h.push({name:"dy",type:"NUMBER",value:i}),h.push({name:"rmoveto",type:"OP",value:21}),t=n.x,a=n.y;else if("L"===n.type)s=n.x-t,i=n.y-a,h.push({name:"dx",type:"NUMBER",value:s}),h.push({name:"dy",type:"NUMBER",value:i}),h.push({name:"rlineto",type:"OP",value:5}),t=n.x,a=n.y;else{if("Q"===n.type)throw new Error("Writing quad curves is currently not supported.");"C"===n.type?(p=n.x1-t,o=n.y1-a,u=n.x2-n.x1,f=n.y2-n.y1,s=n.x-n.x2,i=n.y-n.y2,h.push({name:"dx1",type:"NUMBER",value:p}),h.push({name:"dy1",type:"NUMBER",value:o}),h.push({name:"dx2",type:"NUMBER",value:u}),h.push({name:"dy2",type:"NUMBER",value:f}),h.push({name:"dx",type:"NUMBER",value:s}),h.push({name:"dy",type:"NUMBER",value:i}),h.push({name:"rrcurveto",type:"OP",value:8}),t=n.x,a=n.y):"Z"===n.type}return h.push({name:"endchar",type:"OP",value:14}),h}function makeCharStringsIndex(e){for(var t=new table.Table("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),a=0;a<e.length;a+=1){var r=e[a],n=glyphToOps(r);t.charStrings.push({name:r.name,type:"CHARSTRING",value:n})}return t}function makePrivateDict(e,t){var a=new table.Table("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=makeDict(PRIVATE_DICT_META,e,t),a}function makePrivateDictIndex(e){var t=new table.Table("Private DICT INDEX",[{name:"privateDicts",type:"INDEX",value:[]}]);return t.privateDicts=[{name:"privateDict_0",type:"TABLE",value:e}],t}function makeCFFTable(e,t){for(var a=new table.Table("CFF ",[{name:"header",type:"TABLE"},{name:"nameIndex",type:"TABLE"},{name:"topDictIndex",type:"TABLE"},{name:"stringIndex",type:"TABLE"},{name:"globalSubrIndex",type:"TABLE"},{name:"charsets",type:"TABLE"},{name:"charStringsIndex",type:"TABLE"},{name:"privateDictIndex",type:"TABLE"}]),r={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,charset:999,encoding:0,charStrings:999,"private":[0,999]},n={},s=[],i=1;i<e.length;i+=1)s.push(e[i].name);var p=[];a.header=makeHeader(),a.nameIndex=makeNameIndex([t.postScriptName]);var o=makeTopDict(r,p);a.topDictIndex=makeTopDictIndex(o),a.globalSubrIndex=makeGlobalSubrIndex(),a.charsets=makeCharsets(s,p),a.charStringsIndex=makeCharStringsIndex(e);var u=makePrivateDict(n,p);a.privateDictIndex=makePrivateDictIndex(u),a.stringIndex=makeStringIndex(p);var f=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return r.charset=f,r.encoding=0,r.charStrings=r.charset+a.charsets.sizeOf(),r["private"][1]=r.charStrings+a.charStringsIndex.sizeOf(),o=makeTopDict(r,p),a.topDictIndex=makeTopDictIndex(o),a}var encoding=require("../encoding"),_glyph=require("../glyph"),parse=require("../parse"),path=require("../path"),table=require("../table"),TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];exports.parse=parseCFFTable,exports.make=makeCFFTable;
},{"../encoding":3,"../glyph":5,"../parse":7,"../path":8,"../table":9}],11:[function(require,module,exports){
"use strict";function parseCmapTable(e,a){var t,r,n,s,l,o,p,g,h,u,m,c,f,d,S,i,v,U,y,T,R={};for(R.version=t=parse.getUShort(e,a),check.argument(0===t,"cmap table version should be 0."),R.numtables=r=parse.getUShort(e,a+2),n=-1,S=0;r>S;S+=1)if(s=parse.getUShort(e,a+4+8*S),l=parse.getUShort(e,a+4+8*S+2),3===s&&(1===l||0===l)){n=parse.getULong(e,a+4+8*S+4);break}if(-1===n)return null;for(y=new parse.Parser(e,a+n),R.format=o=y.parseUShort(),check.argument(4===o,"Only format 4 cmap tables are supported."),R.length=y.parseUShort(),R.language=y.parseUShort(),R.segCount=p=y.parseUShort()>>1,y.skip("uShort",3),R.glyphIndexMap={},g=new parse.Parser(e,a+n+14),h=new parse.Parser(e,a+n+16+2*p),u=new parse.Parser(e,a+n+16+4*p),m=new parse.Parser(e,a+n+16+6*p),c=a+n+16+8*p,S=0;p-1>S;S+=1)for(f=g.parseUShort(),d=h.parseUShort(),v=u.parseShort(),U=m.parseUShort(),i=d;f>=i;i+=1)0!==U?(c=m.offset+m.relativeOffset-2,c+=U,c+=2*(i-d),T=parse.getUShort(e,c),0!==T&&(T=T+v&65535)):T=i+v&65535,R.glyphIndexMap[i]=T;return R}function addSegment(e,a,t){e.segments.push({end:a,start:a,delta:-(a-t),offset:0})}function addTerminatorSegment(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(e){var a,t,r,n=new table.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);for(n.segments=[],a=0;a<e.length;a+=1)for(r=e[a],t=0;t<r.unicodes.length;t+=1)addSegment(n,r.unicodes[t],a);addTerminatorSegment(n);var s;s=n.segments.length,n.segCountX2=2*s,n.searchRange=2*Math.pow(2,Math.floor(Math.log(s)/Math.log(2))),n.entrySelector=Math.log(n.searchRange/2)/Math.log(2),n.rangeShift=n.segCountX2-n.searchRange;var l=[],o=[],p=[],g=[],h=[];for(a=0;s>a;a+=1){var u=n.segments[a];l=l.concat({name:"end_"+a,type:"USHORT",value:u.end}),o=o.concat({name:"start_"+a,type:"USHORT",value:u.start}),p=p.concat({name:"idDelta_"+a,type:"SHORT",value:u.delta}),g=g.concat({name:"idRangeOffset_"+a,type:"USHORT",value:u.offset}),void 0!==u.glyphId&&(h=h.concat({name:"glyph_"+a,type:"USHORT",value:u.glyphId}))}return n.fields=n.fields.concat(l),n.fields.push({name:"reservedPad",type:"USHORT",value:0}),n.fields=n.fields.concat(o),n.fields=n.fields.concat(p),n.fields=n.fields.concat(g),n.fields=n.fields.concat(h),n.length=14+2*l.length+2+2*o.length+2*p.length+2*g.length+2*h.length,n}var check=require("../check"),parse=require("../parse"),table=require("../table");exports.parse=parseCmapTable,exports.make=makeCmapTable;
},{"../check":1,"../parse":7,"../table":9}],12:[function(require,module,exports){
"use strict";function parseGlyphCoordinate(e,r,t,o,n){var s;return(r&o)>0?(s=e.parseByte(),0===(r&n)&&(s=-s),s=t+s):s=(r&n)>0?t:t+e.parseShort(),s}function parseGlyph(e,r,t,o){var n,s,a,p,u,i,l,h,y,f,c,x,C,g,v;if(n=new parse.Parser(e,r),s=new _glyph.Glyph({font:o,index:t}),s.numberOfContours=n.parseShort(),s.xMin=n.parseShort(),s.yMin=n.parseShort(),s.xMax=n.parseShort(),s.yMax=n.parseShort(),s.numberOfContours>0){for(l=s.endPointIndices=[],p=0;p<s.numberOfContours;p+=1)l.push(n.parseUShort());for(s.instructionLength=n.parseUShort(),s.instructions=[],p=0;p<s.instructionLength;p+=1)s.instructions.push(n.parseByte());for(h=l[l.length-1]+1,i=[],p=0;h>p;p+=1)if(a=n.parseByte(),i.push(a),(8&a)>0)for(y=n.parseByte(),u=0;y>u;u+=1)i.push(a),p+=1;if(check.argument(i.length===h,"Bad flags."),l.length>0){if(f=[],h>0){for(p=0;h>p;p+=1)a=i[p],c={},c.onCurve=!!(1&a),c.lastPointOfContour=l.indexOf(p)>=0,f.push(c);for(x=0,p=0;h>p;p+=1)a=i[p],c=f[p],c.x=parseGlyphCoordinate(n,a,x,2,16),x=c.x;for(C=0,p=0;h>p;p+=1)a=i[p],c=f[p],c.y=parseGlyphCoordinate(n,a,C,4,32),C=c.y}s.points=f}else s.points=[]}else if(0===s.numberOfContours)s.points=[];else for(s.isComposite=!0,s.points=[],s.components=[],v=!0;v;)i=n.parseUShort(),g={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0},(1&i)>0?(g.dx=n.parseShort(),g.dy=n.parseShort()):(g.dx=n.parseChar(),g.dy=n.parseChar()),(8&i)>0?g.xScale=g.yScale=n.parseF2Dot14():(64&i)>0?(g.xScale=n.parseF2Dot14(),g.yScale=n.parseF2Dot14()):(128&i)>0&&(g.xScale=n.parseF2Dot14(),g.scale01=n.parseF2Dot14(),g.scale10=n.parseF2Dot14(),g.yScale=n.parseF2Dot14()),s.components.push(g),v=!!(32&i);return s}function transformPoints(e,r){var t,o,n,s;for(t=[],o=0;o<e.length;o+=1)n=e[o],s={x:r.xScale*n.x+r.scale01*n.y+r.dx,y:r.scale10*n.x+r.yScale*n.y+r.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour},t.push(s);return t}function getContours(e){var r,t,o,n;for(r=[],t=[],o=0;o<e.length;o+=1)n=e[o],t.push(n),n.lastPointOfContour&&(r.push(t),t=[]);return check.argument(0===t.length,"There are still points left in the current contour."),r}function getPath(e){var r,t,o,n,s,a,p,u,i,l,h,y;if(r=new path.Path,!e)return r;for(t=getContours(e),o=0;o<t.length;o+=1){for(a=t[o],u=a[0],y=a[a.length-1],u.onCurve?(h=null,n=!0):(u=y.onCurve?y:{x:(u.x+y.x)/2,y:(u.y+y.y)/2},h=u,n=!1),r.moveTo(u.x,u.y),s=n?1:0;s<a.length;s+=1)if(p=a[s],i=0===s?u:a[s-1],i.onCurve&&p.onCurve)r.lineTo(p.x,p.y);else if(i.onCurve&&!p.onCurve)h=p;else if(i.onCurve||p.onCurve){if(i.onCurve||!p.onCurve)throw new Error("Invalid state.");r.quadraticCurveTo(h.x,h.y,p.x,p.y),h=null}else l={x:(i.x+p.x)/2,y:(i.y+p.y)/2},r.quadraticCurveTo(i.x,i.y,l.x,l.y),h=p;u!==y&&(h?r.quadraticCurveTo(h.x,h.y,u.x,u.y):r.lineTo(u.x,u.y))}return r.closePath(),r}function parseGlyfTable(e,r,t,o){var n,s,a,p,u,i,l,h,y;for(n=[],s=0;s<t.length-1;s+=1)p=t[s],u=t[s+1],n.push(p!==u?parseGlyph(e,r+p,s,o):new _glyph.Glyph({font:o,index:s}));for(s=0;s<n.length;s+=1){if(i=n[s],i.isComposite)for(a=0;a<i.components.length;a+=1)l=i.components[a],h=n[l.glyphIndex],h.points&&(y=transformPoints(h.points,l),i.points=i.points.concat(y));i.path=getPath(i.points)}return n}var check=require("../check"),_glyph=require("../glyph"),parse=require("../parse"),path=require("../path");exports.parse=parseGlyfTable;
},{"../check":1,"../glyph":5,"../parse":7,"../path":8}],13:[function(require,module,exports){
"use strict";function parseTaggedListTable(r,e){for(var a=new parse.Parser(r,e),s=a.parseUShort(),t=[],o=0;s>o;o++)t[a.parseTag()]={offset:a.parseUShort()};return t}function parseCoverageTable(r,e){var a=new parse.Parser(r,e),s=a.parseUShort(),t=a.parseUShort();if(1===s)return a.parseUShortList(t);if(2===s){for(var o,p,n,f,i=[];t--;)for(p=a.parseUShort(),n=a.parseUShort(),f=a.parseUShort(),o=p;n>=o;o++)i[f++]=o;return i}}function parseClassDefTable(r,e){var a=new parse.Parser(r,e),s=a.parseUShort();if(1===s){var t=a.parseUShort(),o=a.parseUShort(),p=a.parseUShortList(o);return function(r){return p[r-t]||0}}if(2===s){for(var n=a.parseUShort(),f=[],i=[],h=[],S=0;n>S;S++)f[S]=a.parseUShort(),i[S]=a.parseUShort(),h[S]=a.parseUShort();return function(r){var e,a,s;for(e=0,s=f.length-1;s>e;)a=e+s+1>>1,r<f[a]?s=a-1:e=a;return f[e]<=r&&r<=i[e]?h[e]||0:0}}}function parsePairPosSubTable(r,e){var a,s,t,o,p,n,f,i,h,S,u=new parse.Parser(r,e);if(a=u.parseUShort(),s=u.parseUShort(),t=parseCoverageTable(r,e+s),o=u.parseUShort(),p=u.parseUShort(),4===o&&0===p){if(n={},1===a){var U,l,v,g,T,c;for(U=u.parseUShort(),c=[],l=u.parseOffset16List(U),f=0;U>f;f++){if(v=l[f],g=n[v],!g)for(g={},u.relativeOffset=v,T=u.parseUShort();T--;)i=u.parseUShort(),o&&(h=u.parseShort()),p&&(S=u.parseShort()),g[i]=h;c[t[f]]=g}return function(r,e){var a=c[r];return a?a[e]:void 0}}if(2===a){var b,P,L,k,d,w,O,C,G,K,V;for(b=u.parseUShort(),P=u.parseUShort(),L=u.parseUShort(),k=u.parseUShort(),O=parseClassDefTable(r,e+b),C=parseClassDefTable(r,e+P),G=[],d=0;L>d;d++)for(K=G[d]=[],w=0;k>w;w++)o&&(h=u.parseShort()),p&&(S=u.parseShort()),K[w]=h;for(V={},d=0;d<t.length;d++)V[t[d]]=1;return function(r,e){if(V[r]){var a=O(r),s=C(e),t=G[a];return t?t[s]:void 0}}}}}function parseLookupTable(r,e){var a,s,t,o,p,n,f,i,h=new parse.Parser(r,e);if(s=h.parseUShort(),t=h.parseUShort(),o=16&t,p=h.parseUShort(),n=h.parseOffset16List(p),a={lookupType:s,lookupFlag:t,markFilteringSet:o?h.parseUShort():-1},2===s){for(f=[],i=0;p>i;i++)f.push(parsePairPosSubTable(r,e+n[i]));a.getKerningValue=function(r,e){for(var a=f.length;a--;){var s=f[a](r,e);if(void 0!==s)return s}return 0}}return a}function parseGposTable(r,e,a){var s,t,o,p,n,f,i,h,S,u;for(s=new parse.Parser(r,e),t=s.parseFixed(),check.argument(1===t,"Unsupported GPOS table version."),p=parseTaggedListTable(r,e+s.parseUShort()),f=parseTaggedListTable(r,e+s.parseUShort()),o=s.parseUShort(),s.relativeOffset=o,i=s.parseUShort(),h=s.parseOffset16List(i),S=e+o,n=0;i>n;n++)u=parseLookupTable(r,S+h[n]),2!==u.lookupType||a.getGposKerningValue||(a.getGposKerningValue=u.getKerningValue)}var check=require("../check"),parse=require("../parse");exports.parse=parseGposTable;
},{"../check":1,"../parse":7}],14:[function(require,module,exports){
"use strict";function parseHeadTable(e,a){var r={},t=new parse.Parser(e,a);return r.version=t.parseVersion(),r.fontRevision=Math.round(1e3*t.parseFixed())/1e3,r.checkSumAdjustment=t.parseULong(),r.magicNumber=t.parseULong(),check.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=t.parseUShort(),r.unitsPerEm=t.parseUShort(),r.created=t.parseLongDateTime(),r.modified=t.parseLongDateTime(),r.xMin=t.parseShort(),r.yMin=t.parseShort(),r.xMax=t.parseShort(),r.yMax=t.parseShort(),r.macStyle=t.parseUShort(),r.lowestRecPPEM=t.parseUShort(),r.fontDirectionHint=t.parseShort(),r.indexToLocFormat=t.parseShort(),r.glyphDataFormat=t.parseShort(),r}function makeHeadTable(e){return new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var check=require("../check"),parse=require("../parse"),table=require("../table");exports.parse=parseHeadTable,exports.make=makeHeadTable;
},{"../check":1,"../parse":7,"../table":9}],15:[function(require,module,exports){
"use strict";function parseHheaTable(e,a){var r={},t=new parse.Parser(e,a);return r.version=t.parseVersion(),r.ascender=t.parseShort(),r.descender=t.parseShort(),r.lineGap=t.parseShort(),r.advanceWidthMax=t.parseUShort(),r.minLeftSideBearing=t.parseShort(),r.minRightSideBearing=t.parseShort(),r.xMaxExtent=t.parseShort(),r.caretSlopeRise=t.parseShort(),r.caretSlopeRun=t.parseShort(),r.caretOffset=t.parseShort(),t.relativeOffset+=8,r.metricDataFormat=t.parseShort(),r.numberOfHMetrics=t.parseUShort(),r}function makeHheaTable(e){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var parse=require("../parse"),table=require("../table");exports.parse=parseHheaTable,exports.make=makeHheaTable;
},{"../parse":7,"../table":9}],16:[function(require,module,exports){
"use strict";function parseHmtxTable(e,a,r,t,s){var i,l,n,p,d;for(i=new parse.Parser(e,a),l=0;t>l;l+=1)r>l&&(p=i.parseUShort(),d=i.parseShort()),n=s[l],n.advanceWidth=p,n.leftSideBearing=d}function makeHmtxTable(e){for(var a=new table.Table("hmtx",[]),r=0;r<e.length;r+=1){var t=e[r],s=t.advanceWidth||0,i=t.leftSideBearing||0;a.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:s}),a.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return a}var parse=require("../parse"),table=require("../table");exports.parse=parseHmtxTable,exports.make=makeHmtxTable;
},{"../parse":7,"../table":9}],17:[function(require,module,exports){
"use strict";function parseKernTable(r,e){var s,a,p,t,o,n,h,u,c;for(s={},a=new parse.Parser(r,e),p=a.parseUShort(),check.argument(0===p,"Unsupported kern table version."),a.skip("uShort",1),t=a.parseUShort(),check.argument(0===t,"Unsupported kern sub-table version."),a.skip("uShort",2),o=a.parseUShort(),a.skip("uShort",3),n=0;o>n;n+=1)h=a.parseUShort(),u=a.parseUShort(),c=a.parseShort(),s[h+","+u]=c;return s}var check=require("../check"),parse=require("../parse");exports.parse=parseKernTable;
},{"../check":1,"../parse":7}],18:[function(require,module,exports){
"use strict";function parseLocaTable(r,e,a,s){var p,o,t,c,n;for(p=new parse.Parser(r,e),o=s?p.parseUShort:p.parseULong,t=[],n=0;a+1>n;n+=1)c=o.call(p),s&&(c*=2),t.push(c);return t}var parse=require("../parse");exports.parse=parseLocaTable;
},{"../parse":7}],19:[function(require,module,exports){
"use strict";function parseMaxpTable(e,a){var r={},s=new parse.Parser(e,a);return r.version=s.parseVersion(),r.numGlyphs=s.parseUShort(),1===r.version&&(r.maxPoints=s.parseUShort(),r.maxContours=s.parseUShort(),r.maxCompositePoints=s.parseUShort(),r.maxCompositeContours=s.parseUShort(),r.maxZones=s.parseUShort(),r.maxTwilightPoints=s.parseUShort(),r.maxStorage=s.parseUShort(),r.maxFunctionDefs=s.parseUShort(),r.maxInstructionDefs=s.parseUShort(),r.maxStackElements=s.parseUShort(),r.maxSizeOfInstructions=s.parseUShort(),r.maxComponentElements=s.parseUShort(),r.maxComponentDepth=s.parseUShort()),r}function makeMaxpTable(e){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var parse=require("../parse"),table=require("../table");exports.parse=parseMaxpTable,exports.make=makeMaxpTable;
},{"../parse":7,"../table":9}],20:[function(require,module,exports){
"use strict";function parseNameTable(e,a){var r={},n=new parse.Parser(e,a);r.format=n.parseUShort();var t,s,o,m,l,p,u,i,d,c,f,h=n.parseUShort(),T=n.offset+n.parseUShort(),g=0;for(d=0;h>d;d++)if(t=n.parseUShort(),s=n.parseUShort(),o=n.parseUShort(),m=n.parseUShort(),l=nameTableNames[m],p=n.parseUShort(),u=n.parseUShort(),3===t&&1===s&&1033===o){f=[];var S=p/2;for(c=0;S>c;c++,u+=2)f[c]=parse.getShort(e,T+u);i=String.fromCharCode.apply(null,f),l?r[l]=i:(g++,r["unknown"+g]=i)}return 1===r.format&&(r.langTagCount=n.parseUShort()),r}function makeNameRecord(e,a,r,n,t,s){return new table.Table("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:a},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:t},{name:"offset",type:"USHORT",value:s}])}function addMacintoshNameRecord(e,a,r,n){var t=encode.STRING(r);return e.records.push(makeNameRecord(1,0,0,a,t.length,n)),e.strings.push(t),n+=t.length}function addWindowsNameRecord(e,a,r,n){var t=encode.UTF16(r);return e.records.push(makeNameRecord(3,1,1033,a,t.length,n)),e.strings.push(t),n+=t.length}function makeNameTable(e){var a,r,n=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:0},{name:"stringOffset",type:"USHORT",value:0}]);n.records=[],n.strings=[];var t=0;for(a=0;a<nameTableNames.length;a+=1)void 0!==e[nameTableNames[a]]&&(r=e[nameTableNames[a]],t=addMacintoshNameRecord(n,a,r,t));for(a=0;a<nameTableNames.length;a+=1)void 0!==e[nameTableNames[a]]&&(r=e[nameTableNames[a]],t=addWindowsNameRecord(n,a,r,t));for(n.count=n.records.length,n.stringOffset=6+12*n.count,a=0;a<n.records.length;a+=1)n.fields.push({name:"record_"+a,type:"TABLE",value:n.records[a]});for(a=0;a<n.strings.length;a+=1)n.fields.push({name:"string_"+a,type:"LITERAL",value:n.strings[a]});return n}var encode=require("../types").encode,parse=require("../parse"),table=require("../table"),nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","licence","licenceURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"];exports.parse=parseNameTable,exports.make=makeNameTable;
},{"../parse":7,"../table":9,"../types":24}],21:[function(require,module,exports){
"use strict";function parseOS2Table(e,a){var t={},r=new parse.Parser(e,a);t.version=r.parseUShort(),t.xAvgCharWidth=r.parseShort(),t.usWeightClass=r.parseUShort(),t.usWidthClass=r.parseUShort(),t.fsType=r.parseUShort(),t.ySubscriptXSize=r.parseShort(),t.ySubscriptYSize=r.parseShort(),t.ySubscriptXOffset=r.parseShort(),t.ySubscriptYOffset=r.parseShort(),t.ySuperscriptXSize=r.parseShort(),t.ySuperscriptYSize=r.parseShort(),t.ySuperscriptXOffset=r.parseShort(),t.ySuperscriptYOffset=r.parseShort(),t.yStrikeoutSize=r.parseShort(),t.yStrikeoutPosition=r.parseShort(),t.sFamilyClass=r.parseShort(),t.panose=[];for(var s=0;10>s;s++)t.panose[s]=r.parseByte();return t.ulUnicodeRange1=r.parseULong(),t.ulUnicodeRange2=r.parseULong(),t.ulUnicodeRange3=r.parseULong(),t.ulUnicodeRange4=r.parseULong(),t.achVendID=String.fromCharCode(r.parseByte(),r.parseByte(),r.parseByte(),r.parseByte()),t.fsSelection=r.parseUShort(),t.usFirstCharIndex=r.parseUShort(),t.usLastCharIndex=r.parseUShort(),t.sTypoAscender=r.parseShort(),t.sTypoDescender=r.parseShort(),t.sTypoLineGap=r.parseShort(),t.usWinAscent=r.parseUShort(),t.usWinDescent=r.parseUShort(),t.version>=1&&(t.ulCodePageRange1=r.parseULong(),t.ulCodePageRange2=r.parseULong()),t.version>=2&&(t.sxHeight=r.parseShort(),t.sCapHeight=r.parseShort(),t.usDefaultChar=r.parseUShort(),t.usBreakChar=r.parseUShort(),t.usMaxContent=r.parseUShort()),t}function makeOS2Table(e){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:0},{name:"ySubscriptYSize",type:"SHORT",value:0},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:0},{name:"ySuperscriptXSize",type:"SHORT",value:0},{name:"ySuperscriptYSize",type:"SHORT",value:0},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:0},{name:"yStrikeoutSize",type:"SHORT",value:0},{name:"yStrikeoutPosition",type:"SHORT",value:0},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var parse=require("../parse"),table=require("../table");exports.parse=parseOS2Table,exports.make=makeOS2Table;
},{"../parse":7,"../table":9}],22:[function(require,module,exports){
"use strict";function parsePostTable(e,a){var r,n,s={},p=new parse.Parser(e,a);switch(s.version=p.parseVersion(),s.italicAngle=p.parseFixed(),s.underlinePosition=p.parseShort(),s.underlineThickness=p.parseShort(),s.isFixedPitch=p.parseULong(),s.minMemType42=p.parseULong(),s.maxMemType42=p.parseULong(),s.minMemType1=p.parseULong(),s.maxMemType1=p.parseULong(),s.version){case 1:s.names=encoding.standardNames.slice();break;case 2:for(s.numberOfGlyphs=p.parseUShort(),s.glyphNameIndex=new Array(s.numberOfGlyphs),r=0;r<s.numberOfGlyphs;r++)s.glyphNameIndex[r]=p.parseUShort();for(s.names=[],r=0;r<s.numberOfGlyphs;r++)s.glyphNameIndex[r]>=encoding.standardNames.length&&(n=p.parseChar(),s.names.push(p.parseString(n)));break;case 2.5:for(s.numberOfGlyphs=p.parseUShort(),s.offset=new Array(s.numberOfGlyphs),r=0;r<s.numberOfGlyphs;r++)s.offset[r]=p.parseChar()}return s}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var encoding=require("../encoding"),parse=require("../parse"),table=require("../table");exports.parse=parsePostTable,exports.make=makePostTable;
},{"../encoding":3,"../parse":7,"../table":9}],23:[function(require,module,exports){
"use strict";function log2(e){return Math.log(e)/Math.log(2)|0}function computeCheckSum(e){for(;e.length%4!==0;)e.push(0);for(var a=0,n=0;n<e.length;n+=4)a+=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];return a%=Math.pow(2,32)}function makeTableRecord(e,a,n,r){return new table.Table("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==a?a:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==r?r:0}])}function makeSfntTable(e){var a=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);a.tables=e,a.numTables=e.length;var n=Math.pow(2,log2(a.numTables));a.searchRange=16*n,a.entrySelector=log2(n),a.rangeShift=16*a.numTables-a.searchRange;for(var r=[],t=[],i=a.sizeOf()+makeTableRecord().sizeOf()*a.numTables;i%4!==0;)i+=1,t.push({name:"padding",type:"BYTE",value:0});for(var l=0;l<e.length;l+=1){var u=e[l];check.argument(4===u.tableName.length,"Table name"+u.tableName+" is invalid.");var m=u.sizeOf(),s=makeTableRecord(u.tableName,computeCheckSum(u.encode()),i,m);for(r.push({name:s.tag+" Table Record",type:"TABLE",value:s}),t.push({name:u.tableName+" table",type:"TABLE",value:u}),i+=m,check.argument(!isNaN(i),"Something went wrong calculating the offset.");i%4!==0;)i+=1,t.push({name:"padding",type:"BYTE",value:0})}return r.sort(function(e,a){return e.value.tag>a.value.tag?1:-1}),a.fields=a.fields.concat(r),a.fields=a.fields.concat(t),a}function metricsForChar(e,a,n){for(var r=0;r<a.length;r+=1){var t=e.charToGlyphIndex(a[r]);if(t>0){var i=e.glyphs[t];return i.getMetrics()}}return n}function charCodeBounds(e){for(var a,n,r=0;r<e.length;r+=1){var t=e[r];t.unicode>=20&&(void 0===a?a=t.unicode:t.unicode<a&&(a=t.unicode),void 0===n?n=t.unicode:t.unicode>n&&(n=t.unicode))}return[a,n]}function average(e){for(var a=0,n=0;n<e.length;n+=1)a+=e[n];return a/e.length}function fontToSfntTable(e){for(var a=[],n=[],r=[],t=[],i=[],l=[],u=[],m=0;m<e.glyphs.length;m+=1){var s=e.glyphs[m];if(".notdef"!==s.name){var c=s.getMetrics();a.push(c.xMin),n.push(c.yMin),r.push(c.xMax),t.push(c.yMax),l.push(c.leftSideBearing),u.push(c.rightSideBearing),i.push(s.advanceWidth)}}var h={xMin:Math.min.apply(null,a),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,t),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:average(i),minLeftSideBearing:Math.min.apply(null,l),maxLeftSideBearing:Math.max.apply(null,l),minRightSideBearing:Math.min.apply(null,u)};h.ascender=h.yMax,h.descender=h.yMin;var o=head.make({unitsPerEm:e.unitsPerEm,xMin:h.xMin,yMin:h.yMin,xMax:h.xMax,yMax:h.yMax}),d=hhea.make({ascender:h.ascender,descender:h.descender,advanceWidthMax:h.advanceWidthMax,minLeftSideBearing:h.minLeftSideBearing,minRightSideBearing:h.minRightSideBearing,xMaxExtent:h.maxLeftSideBearing+(h.xMax-h.xMin),numberOfHMetrics:e.glyphs.length}),p=maxp.make(e.glyphs.length),g=charCodeBounds(e.glyphs),f=os2.make({xAvgCharWidth:Math.round(h.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:g[0],usLastCharIndex:g[1],ulUnicodeRange1:1,sTypoAscender:h.ascender,sTypoDescender:h.descender,sTypoLineGap:0,usWinAscent:h.ascender,usWinDescent:-h.descender,ulCodePageRange1:1,sxHeight:metricsForChar(e,"xyvw",{yMax:0}).yMax,sCapHeight:metricsForChar(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",h).yMax,usBreakChar:e.hasChar(" ")?32:0}),y=hmtx.make(e.glyphs),v=cmap.make(e.glyphs),x=e.familyName+" "+e.styleName,M=e.familyName.replace(/\s/g,"")+"-"+e.styleName,T=_name.make({copyright:e.copyright,fontFamily:e.familyName,fontSubfamily:e.styleName,uniqueID:e.manufacturer+":"+x,fullName:x,version:e.version,postScriptName:M,trademark:e.trademark,manufacturer:e.manufacturer,designer:e.designer,description:e.description,manufacturerURL:e.manufacturerURL,designerURL:e.designerURL,license:e.license,licenseURL:e.licenseURL,preferredFamily:e.familyName,preferredSubfamily:e.styleName}),S=post.make(),b=cff.make(e.glyphs,{version:e.version,fullName:x,familyName:e.familyName,weightName:e.styleName,postScriptName:M}),k=[o,d,p,f,T,v,S,b,y],N=makeSfntTable(k),R=N.encode(),C=computeCheckSum(R);return o.checkSumAdjustment=2981146554-C,N=makeSfntTable(k)}var check=require("../check"),table=require("../table"),cmap=require("./cmap"),cff=require("./cff"),head=require("./head"),hhea=require("./hhea"),hmtx=require("./hmtx"),maxp=require("./maxp"),_name=require("./name"),os2=require("./os2"),post=require("./post");exports.computeCheckSum=computeCheckSum,exports.make=makeSfntTable,exports.fontToTable=fontToSfntTable;
},{"../check":1,"../table":9,"./cff":10,"./cmap":11,"./head":14,"./hhea":15,"./hmtx":16,"./maxp":19,"./name":20,"./os2":21,"./post":22}],24:[function(require,module,exports){
"use strict";function constant(e){return function(){return e}}var check=require("./check"),LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};encode.BYTE=function(e){return check.argument(e>=0&&255>=e,"Byte value should be between 0 and 255."),[e]},sizeOf.BYTE=constant(1),encode.CHAR=function(e){return[e.charCodeAt(0)]},sizeOf.BYTE=constant(1),encode.CHARARRAY=function(e){for(var n=[],o=0;o<e.length;o+=1)n.push(e.charCodeAt(o));return n},sizeOf.CHARARRAY=function(e){return e.length},encode.USHORT=function(e){return[e>>8&255,255&e]},sizeOf.USHORT=constant(2),encode.SHORT=function(e){return e>=LIMIT16&&(e=-(2*LIMIT16-e)),[e>>8&255,255&e]},sizeOf.SHORT=constant(2),encode.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},sizeOf.UINT24=constant(3),encode.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.ULONG=constant(4),encode.LONG=function(e){return e>=LIMIT32&&(e=-(2*LIMIT32-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(e){return check.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(e){return e>=-107&&107>=e?[e+139]:e>=108&&1131>=e?(e-=108,[(e>>8)+247,255&e]):e>=-1131&&-108>=e?(e=-e-108,[(e>>8)+251,255&e]):e>=-32768&&32767>=e?encode.NUMBER16(e):encode.NUMBER32(e)},sizeOf.NUMBER=function(e){return encode.NUMBER(e).length},encode.NUMBER16=function(e){return[28,e>>8&255,255&e]},sizeOf.NUMBER16=constant(2),encode.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.NUMBER32=constant(4),encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,encode.UTF16=function(e){for(var n=[],o=0;o<e.length;o+=1)n.push(0),n.push(e.charCodeAt(o));return n},sizeOf.UTF16=function(e){return 2*e.length},encode.INDEX=function(e){var n,o,t,c,r,f,d,i,u,O;for(o=1,t=[o],d=[],i=0,u=0;u<e.length;u+=1)O=encode.OBJECT(e[u]),Array.prototype.push.apply(d,O),i+=O.length,o+=O.length,t.push(o);if(0===d.length)return[0,0];for(r=[],n=1+Math.floor(Math.log(i)/Math.log(2))/8|0,c=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][n],u=0;u<t.length;u+=1)f=c(t[u]),Array.prototype.push.apply(r,f);return Array.prototype.concat(encode.Card16(e.length),encode.OffSize(n),r,d)},sizeOf.INDEX=function(e){return encode.INDEX(e).length},encode.DICT=function(e){for(var n=[],o=Object.keys(e),t=o.length,c=0;t>c;c+=1){var r=parseInt(o[c],0),f=e[r];n=n.concat(encode.OPERAND(f.value,f.type)),n=n.concat(encode.OPERATOR(r))}return n},sizeOf.DICT=function(e){return encode.DICT(e).length},encode.OPERATOR=function(e){return 1200>e?[e]:[12,e-1200]},encode.OPERAND=function(e,n){var o,t;if(o=[],Array.isArray(n))for(t=0;t<n.length;t+=1)check.argument(e.length===n.length,"Not enough arguments given for type"+n),o=o.concat(encode.OPERAND(e[t],n[t]));else o=o.concat("SID"===n?encode.NUMBER(e):"offset"===n?encode.NUMBER32(e):encode.NUMBER(e));return o},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm="function"==typeof WeakMap&&new WeakMap;encode.CHARSTRING=function(e){if(wmm&&wmm.has(e))return wmm.get(e);var n,o,t=[],c=e.length;for(o=0;c>o;o+=1)n=e[o],t=t.concat(encode[n.type](n.value));return wmm&&wmm.set(e,t),t},sizeOf.CHARSTRING=function(e){return encode.CHARSTRING(e).length},encode.OBJECT=function(e){var n=encode[e.type];return check.argument(void 0!==n,"No encoding function for type "+e.type),n(e.value)},encode.TABLE=function(e){var n,o=[],t=e.fields.length;for(n=0;t>n;n+=1){var c=e.fields[n],r=encode[c.type];check.argument(void 0!==r,"No encoding function for field type "+c.type);var f=e[c.name];void 0===f&&(f=c.value);var d=r(f);o=o.concat(d)}return o},encode.LITERAL=function(e){return e},sizeOf.LITERAL=function(e){return e.length},exports.decode=decode,exports.encode=encode,exports.sizeOf=sizeOf;
},{"./check":1}]},{},[6])(6)
});;
/*!{id:msgpack.codec.js,ver:1.05,license:"MIT",author:"uupaa.js@gmail.com"}*/
var msgpack=function(){function m(f,b,c){var a,e,h;if(null==b)f.push(192);else if(!1===b)f.push(194);else if(!0===b)f.push(195);else switch(typeof b){case "number":b!==b?f.push(203,255,255,255,255,255,255,255,255):Infinity===b?f.push(203,127,240,0,0,0,0,0,0):Math.floor(b)===b?0>b?-32<=b?f.push(224+b+32):-128<b?f.push(208,b+256):-32768<b?(b+=65536,f.push(209,b>>8,b&255)):-2147483648<b?(b+=4294967296,f.push(210,b>>>24,b>>16&255,b>>8&255,b&255)):(e=Math.floor(b/4294967296),b&=4294967295,
f.push(211,e>>24&255,e>>16&255,e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255)):128>b?f.push(b):256>b?f.push(204,b):65536>b?f.push(205,b>>8,b&255):4294967296>b?f.push(206,b>>>24,b>>16&255,b>>8&255,b&255):(e=Math.floor(b/4294967296),b&=4294967295,f.push(207,e>>24&255,e>>16&255,e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255)):((e=0>b)&&(b*=-1),h=Math.log(b)/0.6931471805599453+1023|0,c=b*Math.pow(2,1075-h),b=c&4294967295,e&&(h|=2048),e=c/4294967296&1048575|h<<20,f.push(203,e>>24&255,e>>16&255,
e>>8&255,e&255,b>>24&255,b>>16&255,b>>8&255,b&255));break;case "string":c=b.length;h=f.length;f.push(0);for(e=0;e<c;++e)a=b.charCodeAt(e),128>a?f.push(a&127):2048>a?f.push(a>>>6&31|192,a&63|128):65536>a&&f.push(a>>>12&15|224,a>>>6&63|128,a&63|128);a=f.length-h-1;32>a?f[h]=160+a:65536>a?f.splice(h,1,218,a>>8,a&255):4294967296>a&&f.splice(h,1,219,a>>>24,a>>16&255,a>>8&255,a&255);break;default:if(++c>=t)return n=1,[];if(u(b))for(a=b.length,16>a?f.push(144+a):65536>a?f.push(220,a>>8,a&255):4294967296>
a&&f.push(221,a>>>24,a>>16&255,a>>8&255,a&255),e=0;e<a;++e)m(f,b[e],c);else{h=f.length;f.push(0);a=0;for(e in b)++a,m(f,e,c),m(f,b[e],c);16>a?f[h]=128+a:65536>a?f.splice(h,1,222,a>>8,a&255):4294967296>a&&f.splice(h,1,223,a>>>24,a>>16&255,a>>8&255,a&255)}}return f}function p(){var f,b,g,a=0,e,h,d=q;b=d[++c];if(224<=b)return b-256;if(192>b){if(128>b)return b;144>b?(a=b-128,b=128):160>b?(a=b-144,b=144):(a=b-160,b=160)}switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 202:return a=
16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c],e=a>>23&255,h=a&8388607,a&&2147483648!==a?255===e?h?NaN:Infinity:(a&2147483648?-1:1)*(h|8388608)*Math.pow(2,e-127-23):0;case 203:a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];b=a&2147483648;e=a>>20&2047;h=a&1048575;if(!a||2147483648===a)return c+=4,0;if(2047===e)return c+=4,h?NaN:Infinity;a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];return(b?-1:1)*((h|1048576)*Math.pow(2,e-1023-20)+a*Math.pow(2,e-1023-52));case 207:return a=16777216*d[++c]+
(d[++c]<<16)+(d[++c]<<8)+d[++c],4294967296*a+16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c];case 206:a+=16777216*d[++c]+(d[++c]<<16);case 205:a+=d[++c]<<8;case 204:return a+d[++c];case 211:return a=d[++c],a&128?-1*(72057594037927936*(a^255)+281474976710656*(d[++c]^255)+1099511627776*(d[++c]^255)+4294967296*(d[++c]^255)+16777216*(d[++c]^255)+65536*(d[++c]^255)+256*(d[++c]^255)+(d[++c]^255)+1):72057594037927936*a+281474976710656*d[++c]+1099511627776*d[++c]+4294967296*d[++c]+16777216*d[++c]+65536*d[++c]+
256*d[++c]+d[++c];case 210:return a=16777216*d[++c]+(d[++c]<<16)+(d[++c]<<8)+d[++c],2147483648>a?a:a-4294967296;case 209:return a=(d[++c]<<8)+d[++c],32768>a?a:a-65536;case 208:return a=d[++c],128>a?a:a-256;case 219:a+=16777216*d[++c]+(d[++c]<<16);case 218:a+=(d[++c]<<8)+d[++c];case 160:e=[];b=c;for(f=b+a;b<f;)g=d[++b],e.push(128>g?g:224>g?(g&31)<<6|d[++b]&63:(g&15)<<12|(d[++b]&63)<<6|d[++b]&63);c=b;return 10240>e.length?l.apply(null,e):r(e);case 223:a+=16777216*d[++c]+(d[++c]<<16);case 222:a+=(d[++c]<<
8)+d[++c];case 128:for(h={};a--;){f=d[++c]-160;e=[];b=c;for(f=b+f;b<f;)g=d[++b],e.push(128>g?g:224>g?(g&31)<<6|d[++b]&63:(g&15)<<12|(d[++b]&63)<<6|d[++b]&63);c=b;h[l.apply(null,e)]=p()}return h;case 221:a+=16777216*d[++c]+(d[++c]<<16);case 220:a+=(d[++c]<<8)+d[++c];case 144:for(e=[];a--;)e.push(p());return e}}function r(c){try{return l.apply(null,c)}catch(b){}for(var g=[],a=0,e=c.length,h=s;a<e;++a)g[a]=h[c[a]];return g.join("")}var k={},s={},q=[],c=0,n=0,u=Array.isArray||function(c){return"[object Array]"===
Object.prototype.toString.call(c)},l=String.fromCharCode,t=512;(function(){for(var c=0,b;256>c;++c)b=l(c),k[b]=c,s[c]=b;for(c=128;256>c;++c)k[l(63232+c)]=c})();return{pack:function(c,b){n=0;var g=m([],c,0);return n?!1:b?r(g):g},unpack:function(f){var b;if("string"===typeof f){b=[];var g=f.split(""),a=-1,e;e=g.length;for(f=e%8;f--;)++a,b[a]=k[g[a]];for(f=e>>3;f--;)b.push(k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]],k[g[++a]])}else b=f;q=b;c=-1;return p()}}}();
var global=window;global.Engine=function(a){"use strict";function b(a){Object.getPrototypeOf(this);if("undefined"==typeof this._events&&Object.addProperty(this,"_events",{}),this.hasOwnProperty("$")&&(Object.isObject(this.$)?Object.clear(this.$):delete this.$),a){if(a.on){var c=a.on;for(var d in c)this.on(d,c[d])}if("$"in a){var e=a.$;Array.isArray(e)?e=e.clone():Object.isObject(e)&&(e=Object.clone(e)),this.$=e}if(this.hasOwnProperty("$"))var e=this.$;for(var f in a)"$"===f[0]&&"$"!==f&&(void 0===e&&(e=this.$),e[f.slice(1)]=a[f])}this.initialize(a),this.trigger(b.INITIALIZE)}function c(a,b){return b=b||!1,this.body="string"==typeof a?a:this.body,this.title=b&&"string"==typeof b.title?b.title:this.title,this.tag=b&&"string"==typeof b.tag?b.tag:this.tag,this.expireTime=b&&"number"==typeof b.expireTime&&b.expireTime>=0?b.expireTime:this.expireTime,this.iconURL=b&&"string"==typeof b.iconURL?b.iconURL:this.iconURL,this.autoshow=b&&"boolean"==typeof b.autoshow?b.autoshow:this.autoshow,this.onshow=b&&"function"==typeof b.onshow?b.onshow:this.onshow,this.onerror=b&&"function"==typeof b.onerror?b.onerror:this.onerror,this.onclick=b&&"function"==typeof b.onclick?b.onclick:this.onclick,this.onclose=b&&"function"==typeof b.onclose?b.onclose:this.onclose,cb.features.notifications?((null===this.title||"undefined"==typeof this.title)&&(this.title=String(this.body),this.body=null),void(this.autoshow&&this.show())):this.onerror&&this.onerror()}function d(a,c){c||(c=a,a=""),this.type=String(a||this.type),this.name=d.NAME.format(this.type.capitalize()),this.message=String(arguments.length?c:this.message),this.model instanceof b&&this.model.trigger(this.name.toLowerCase(),this)}function e(){d.apply(this,arguments)}function f(){d.apply(this,arguments)}function g(){d.apply(this,arguments)}function i(){d.apply(this,arguments)}function j(){d.apply(this,arguments)}function k(a){this.duration=a&&"duration"in a?Math.max(0,parseFloat(a.duration)||0):Math.max(0,parseFloat(this.duration)||0),this.delay=a&&"delay"in a?Math.max(1,parseInt(a.delay)||0):Math.max(1,parseInt(this.delay)||0),this.autoplay=a&&"autoplay"in a?Boolean(a.autoplay):this.autoplay,this.type=String(a&&"type"in a?a.type:this.type),this.loop=Boolean(a&&"loop"in a?a.loop:this.loop),this.iterations=a&&"iterations"in a?Math.max(0,Math.floor(parseFloat(a.iterations))||0):Math.max(0,Math.floor(parseFloat(this.iterations))||0),this.playing=!1,this.progress=0,this.stepprogress=0,this.count=0,b.call(this,a),this.autoplay&&this.play()}function l(a,b,c,d){var e=this instanceof l?this:l.create();return e.x=a,e.y=b,e.w=c,e.h=d,e}function m(a,b,c){this.width=a,this.height=b;var d=l.factory(0,0,a,b);this.spaces=this.spaces||[],this.spaces.push(d),this.sorter=m.sorters[c]||m.sorters[m.RIGHTWARD_TOP_TO_BOTTOM]}function n(a){this.src=String(a&&"src"in a?a.src:this.src),this.method=String(a&&"method"in a&&n.METHODS.has(a.method)?a.method:n.METHODS.has(this.method)?this.method:n.GET),this.data=a&&"data"in a?a.data:this.data,this.type=String(a&&"type"in a?a.type:this.type),this.headers=a&&"headers"in a?a.headers:this.headers,this.headers="object"==typeof this.headers?this.headers:null,this.autoload=Boolean(a&&"autoload"in a?a.autoload:this.autoload),this.pending=!1,this.response=null,this.complete=!1,b.call(this,a),""===this.src,this.autoload&&this.load()}function o(a,b){d.call(this,"Request finished with [{}] status".format(a)),this.status=parseInt(a)||0,this.data=b}function p(a){d.call(this,a)}function q(a){d.call(this,a)}function r(a){this.src=String(a&&"src"in a?a.src:this.src),b.call(this,a),""===this.src}function s(){return this?(b.call(this),void Object.addProperty(this,"_status",Object.CONFIGURABLE|Object.WRITABLE,s.INITIALIZED)):new s}function t(a,b,c,d){if("string"==typeof a){var e=a;if(e=t.Name[e]||e,t.cache.hasOwnProperty(e))return t.cache[e];var f;if(f=t.HASH3.exec(e))a=parseInt(f[1]+f[1],16)||0,b=parseInt(f[2]+f[2],16)||0,c=parseInt(f[3]+f[3],16)||0,d=1;else if(f=t.HASH6.exec(e))a=parseInt(f[1],16)||0,b=parseInt(f[2],16)||0,c=parseInt(f[3],16)||0,d=1;else if(f=t.RGB.exec(e))a=Math.round(f[1])||0,b=Math.round(f[2])||0,c=Math.round(f[3])||0,d=1;else if(f=t.RGBA.exec(e))a=Math.round(f[1])||0,b=Math.round(f[2])||0,c=Math.round(f[3])||0,d=+f[4]||0;else{if(!(f=t.HSL.exec(e)))throw new TypeError("Engine.Color: unknown color `"+a+"`");f=t.fromHSL(f[1],f[2],f[3],f),a=Math.round(f[0])||0,b=Math.round(f[1])||0,c=Math.round(f[2])||0,d=1}}else{if("number"!=typeof a)throw new TypeError("Engine.Color: unknown type passed as argument `"+a+"`");a=Math.round(+a)||0,b=Math.round(+b)||0,c=Math.round(+c)||0,d=void 0===d?1:+d||0}if(0>a||a>255)throw new RangeError("Engine.Color: `r` is out of range. "+a+" given.");if(0>b||b>255)throw new RangeError("Engine.Color: `g` is out of range. "+b+" given.");if(0>c||c>255)throw new RangeError("Engine.Color: `b` is out of range. "+c+" given.");if(0>d||d>1)throw new RangeError("Engine.Color: `a` is out of range. "+d+" given.");var g=t.toIndex(a,b,c,d);if(t.cache.hasOwnProperty(g))return t.cache[g];var h=t.cache[g]=Object.create(t.prototype);return s.call(h),e&&(t.cache[e]=h),h.r=a,h.g=b,h.b=c,h.a=d,h.index=g,h.status=s.READY,h}function u(a){var b=a.type||u.LINEAR,c=a.from||null,d=a.to||null,e=a.stop||null;if(!u.TYPES.has(b))throw new TypeError("Engine.Gradient: invalid `type`. `"+b+"` given.");if(!c)throw new TypeError("Engine.Gradient: `from` is empty. "+c+" given.");if(!d)throw new TypeError("Engine.Gradient: `to` is empty. "+d+" given.");if(!e)throw new TypeError("Engine.Gradient: `stop` is empty. "+e+" given.");for(var f in e)e[f]instanceof t==!1&&(e[f]=t(e[f]));var g=u.toIndex(b,c,d,e);if(u.cache.hasOwnProperty(g))return u.cache[g];var h=u.cache[g]=Object.create(u.prototype);return s.call(h),h.type=b,h.from=c,h.to=d,h.stop=e,h.index=g,h.status=s.READY,h}function v(a){if(v.cache.hasOwnProperty(a))return v.cache[a];var b=v.cache[a]=Object.create(v.prototype);return s.call(b),b.src=a,b}function z(){return this?(b.call(this),Object.addProperty(this,"loading",Object.ENUMERABLE,[]),Object.addProperty(this,"assets",Object.ENUMERABLE,[]),this._onAssetReady=this._onAssetReady(this),void(this._onAssetError=this._onAssetError(this))):new z}function A(){if(!this)return new A;b.call(this);var a=new z;Object.addProperty(this,"loader",a),a.on(z.PROGRESS,this.trigger.bind(this,z.PROGRESS)).on(z.READY,this.trigger.bind(this,z.READY)).on(z.COMPLETE,this.trigger.bind(this,z.COMPLETE)).on(z.ERROR,this.trigger.bind(this,z.ERROR))}function B(a){if(B.cache.hasOwnProperty(a))return B.cache[a];var b=B.cache[a]=Object.create(B.prototype);return s.call(b),b.src=a,b}function C(a){b.call(this,a),this.parent=null,this.children=Array.create().clear(),this.id=a&&"id"in a?a.id:this.id,this.name=a&&"name"in a?a.name:this.name,this.x=a&&"x"in a?a.x:this.x,this.y=a&&"y"in a?a.y:this.y,a&&"scale"in a&&(this.scale=a.scale),this.scaleX=a&&"scaleX"in a?a.scaleX:this.scaleX,this.scaleY=a&&"scaleY"in a?a.scaleY:this.scaleY,this.rotation=a&&"rotation"in a?a.rotation:this.rotation,this.width=a&&"width"in a?a.width:this.width,this.height=a&&"height"in a?a.height:this.height,this.opacity=a&&"opacity"in a?a.opacity:this.opacity,this.clip=a&&"clip"in a?a.clip:this.clip,this.originX=a&&"originX"in a?a.originX:this._originX,this.originY=a&&"originY"in a?a.originY:this._originY,this.transform=a&&"transform"in a?a.transform:this.transform,this.zIndex=a&&"zIndex"in a?a.zIndex:this.zIndex;var c=a&&a.children;if(c)for(var d=0,e=c.length;e>d;d++)this.appendChild(c[d]);var f=a&&"parent"in a?a.parent:this.parent;f instanceof C&&f.appendChild(this)}function D(a){C.call(this,a),Object.addProperty(this,"_color",Object.WRITABLE,null),this.color=a&&"color"in a?a.color:this.color}function E(a){C.call(this,a),Object.addProperty(this,"_color",Object.WRITABLE,null),Object.addProperty(this,"_image",Object.WRITABLE,null),Object.addProperty(this,"_gradient",Object.WRITABLE,null),Object.addProperty(this,"_stroke",Object.WRITABLE,null),this.color=a&&"color"in a?a.color:this.color,this.image=a&&"image"in a?a.image:this.image,this.gradient=a&&"gradient"in a?a.gradient:this.gradient,this.stroke=a&&"stroke"in a?a.stroke:this.stroke}function F(a){E.call(this,a)}function G(a){E.call(this,a),this.points=a&&"points"in a?a.points:this.points}function H(a){E.call(this,a),a&&"radius"in a&&(this.radiusY=this.radiusX=a.radius),a&&"radiusX"in a&&(this.radiusX=a.radiusX),a&&"radiusY"in a&&(this.radiusY=a.radiusY)}function I(a){E.call(this,a),Object.addProperty(this,"_textColor",Object.WRITABLE,I.COLOR),this.font=a&&"font"in a?a.font:this.font,this.fontSize=a&&"fontSize"in a?a.fontSize:this.fontSize,this.textColor=a&&"textColor"in a?a.textColor:this.textColor,this.textStroke=a&&"textStroke"in a?a.textStroke:this.textStroke,this.textStrokeWidth=a&&"textStrokeWidth"in a?a.textStrokeWidth:this.textStrokeWidth,this.text=a&&"text"in a?a.text:this.text,this.spacing=a&&"spacing"in a?a.spacing:this.spacing,this.lineHeight=a&&"lineHeight"in a?a.lineHeight:this.lineHeight,this.textAlign=a&&"textAlign"in a?a.textAlign:this.textAlign,this.textAlign=I.ALIGN.has(this.textAlign)?this.textAlign:I.ALIGN[0],a&&"padding"in a&&(this.padding=a.padding),this.paddingLeft=a&&"paddingLeft"in a?a.paddingLeft:this.paddingLeft,this.paddingTop=a&&"paddingTop"in a?a.paddingTop:this.paddingTop,this.paddingRight=a&&"paddingRight"in a?a.paddingRight:this.paddingRight,this.paddingBottom=a&&"paddingBottom"in a?a.paddingBottom:this.paddingBottom}function J(a){E.call(this,a),this.ix=a&&"ix"in a?a.ix:this.ix,this.iy=a&&"iy"in a?a.iy:this.iy}function K(a){C.call(this,a)}function L(a,c,d,e){if("string"==typeof a)return"number"==typeof c?L.call(this,{id:a,width:c,height:d,cameras:e}):L.call(this,{id:a,cameras:c});L.stack.push(this);var f=a;this.id=f&&"id"in f?f.id:"",this.width=f&&"width"in f?f.width:0,this.height=f&&"height"in f?f.height:0;var g=f&&("width"in f||"height"in f)?!1:!0;if(this.fill=f&&"fill"in f?f.fill:g,this.cameras=[],b.call(this,f),f&&"cameras"in f){var e=f.cameras instanceof M?[f.cameras]:f.cameras;if(e)for(var h=0,i=e.length;i>h;h++)this.addCamera(e[h])}}function M(a){b.call(this,a);var c=Object.getPrototypeOf(this);this.volume=a&&"volume"in a?a.volume:c.volume,this.zoom=a&&"zoom"in a?a.zoom:c.zoom,this.x=a&&"x"in a?a.x:c.x,this.y=a&&"y"in a?a.y:c.y,this.left=a&&"left"in a?a.left:c._left,this.top=a&&"top"in a?a.top:c._top,this.width=a&&"width"in a?a.width:c._width,this.height=a&&"height"in a?a.height:c._height,this.lookingAt=a&&"lookAt"in a?a.lookAt:null}function N(a){if(N.cache.hasOwnProperty(a))return N.cache[a];var b=N.cache[a]=Object.create(N.prototype);return s.call(b),Object.addProperty(b,"src",Object.ENUMERABLE,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,0),b}function O(a){var b=Object.getPrototypeOf(this),c=a.sound;"string"==typeof c&&(c=fb.getById(c)||N(c)),Object.addProperty(this,"sound",Object.CONFIGURABLE|Object.ENUMERABLE,c),c.status===s.INITIALIZED&&c.load(),this._impl&&this._impl.setSound(c.src),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,"autoplay"in a?a.autoplay:b.autoplay),Object.addProperty(this,"autodestroy",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autodestroy"in a?a.autodestroy:b.autodestroy),Object.addProperty(this,"_playing",Object.CONFIGURABLE|Object.WRITABLE,b._playing),Object.addProperty(this,"_loop",Object.CONFIGURABLE|Object.WRITABLE,b.loop),"loop"in a&&(this.loop=a.loop),Object.addProperty(this,"_volume",Object.CONFIGURABLE|Object.WRITABLE,b.volume),"volume"in a&&(this.volume=a.volume),C.call(this,a),this.hasOwnProperty("onSoundReady")||(this.onSoundReady=b.onSoundReady.bind(this)),this.hasOwnProperty("onEnd")||(this.onEnd=b.onEnd.bind(this)),this.sound.once(s.READY,this.onSoundReady),this._impl&&(this._impl.onEnd=this.onEnd)}function P(a){var b=this instanceof P?this:P.create();return ob&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,ob.createAmbientSound()),O.call(b,a),b}function Q(a){C.call(this,a),this.isoX=a&&"isoX"in a?a.isoX:this.isoX,this.isoY=a&&"isoY"in a?a.isoY:this.isoY,this.isoZ=a&&"isoZ"in a?a.isoZ:this.isoZ,this.isoW=a&&"isoW"in a?a.isoW:this.isoW,this.isoH=a&&"isoH"in a?a.isoH:this.isoH}function R(a){var c=Object.getPrototypeOf(this);Object.addProperty(this,"_mutable",Object.CONFIGURABLE|Object.WRITABLE,c._mutable),b.call(this,a),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autoplay"in a?a.autoplay:c.autoplay),Object.addProperty(this,"autodestroy",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"autodestroy"in a?a.autodestroy:c.autodestroy),a&&null!=a.duration,Object.addProperty(this,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"duration"in a?a.duration:c.duration),Object.addProperty(this,"_playing",Object.CONFIGURABLE|Object.WRITABLE,c._playing),Object.addProperty(this,"_paused",Object.CONFIGURABLE|Object.WRITABLE,c._paused),Object.addProperty(this,"_loop",Object.CONFIGURABLE|Object.WRITABLE,c._loop),a&&"loop"in a&&(this.loop=a.loop),Object.addProperty(this,"reverse",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"reverse"in a?a.reverse:c.reverse),this.hasOwnProperty("onEnd")||(this.onEnd=c.onEnd.bind(this)),this._impl&&(this._impl.onEnd=this.onEnd)}function S(a){var b=Object.getPrototypeOf(this);R.call(this,a),Object.addProperty(this,"animations",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"animations"in a?a.animations.clone():b.animations);for(var c=0,d=this.animations,e=d.length;e>c;c++){var f=d[c];S.setMutableDeep(f,!1)}Object.freeze(this.animations)}function T(a){var b=this instanceof T?this:T.create();return vb&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,vb.createSequentialAnimation()),S.call(b,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,T.getTotalDuration(b)),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function U(a){var b=this instanceof U?this:U.create();return vb&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,vb.createParallelAnimation()),S.call(b,a),Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,U.getMaxDuration(b)),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function V(a){var b=Object.getPrototypeOf(this);R.call(this,a),Object.addProperty(this,"target",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"target"in a?a.target:b.target),Object.addProperty(this,"property",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"property"in a?a.property:b.property),Object.addProperty(this,"updateProperty",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"updateProperty"in a?a.updateProperty:b.updateProperty),Object.addProperty(this,"easing",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"easing"in a?a.easing:b.easing)}function W(a){var b=this instanceof W?this:W.create(),c=Object.getPrototypeOf(b);vb&&Object.addProperty(b,"_impl",Object.CONFIGURABLE,vb.createNumberAnimation()),V.call(b,a);var d=a&&"from"in a?a.from:b.target[b.property];return Object.addProperty(b,"from",Object.CONFIGURABLE|Object.ENUMERABLE,d),Object.addProperty(b,"to",Object.CONFIGURABLE|Object.ENUMERABLE,a&&"to"in a?a.to:c.to),b._impl&&b._impl.initialize(b),b.autoplay&&b.play(),b}function X(a,b,c,d){this.buffer=X.getBuffer(a,b,c,d),this.index=0}function Y(a){this.frames=a&&a.frames instanceof Array?a.frames:[],this.frame=0,C.call(this,a);var b=this.frames[this.frame]||null;b&&(this.x=b.x,this.y=b.y,this.width=b.w,this.height=b.h)}var Z=function(){function b(a){return a&&"object"==typeof a&&!Array.isArray(a)}function c(a,c){if(!b(a)||"function"!=typeof c)throw new TypeError;return Object.forEach(a,function(a,b,d){d.hasOwnProperty(a)&&c(a,b)}),!0}Object.defineProperty(a,"Class",{get:function(){return f}});var d="_super",e=function(){},f={extend:function(a,b){if(2!==arguments.length)throw new RangeError;if("function"!=typeof a||"function"!=typeof b)throw new TypeError;var c=Object.createProto(b.prototype);return c.constructor=a,c[d]=null,a.prototype=c,a},decorate:function(a,f,g){if(b(f))return c(f,this.decorate.bind(this,a));if("function"==typeof a&&"function"!=typeof a[f]&&(a=a.prototype),3!==arguments.length)throw new RangeError;if("string"!=typeof f||"function"!=typeof g)throw new TypeError;var h=a.hasOwnProperty(f)&&"function"==typeof a[f]?a[f]:null,i=Object.getPrototypeOf(a);return a[f]=function(){if(null===this||"undefined"==typeof this)return g.apply(this,arguments);var a=this[d],b=!h&&i&&"function"==typeof i[f]&&i[f];this[d]=h||b||e;var c=g.apply(this,arguments);return this[d]=a,c}}};return Function.prototype.property=function(a,d){if(b(a))return c(a,this.property.bind(this));if("string"!=typeof a)throw new TypeError;if(this.prototype.hasOwnProperty(a))throw new ReferenceError;this.prototype[a]=d},Function.prototype.method=function(a,d){if(b(a))return c(a,this.method.bind(this));if(this.prototype.hasOwnProperty(a))throw new ReferenceError;return f.decorate(this.prototype,a,d)},Function.prototype.decorate=function(a,d){if(b(a))return c(a,this.decorate.bind(this));if("function"!=typeof this.prototype[a])throw new ReferenceError;return f.decorate(this.prototype,a,d)},f}();Function.prototype.bind||(Function.prototype.bind=function(){var a=this,b=Array.prototype.shift.call(arguments),c=Array.prototype.slice.call(arguments,0);return function(){return a.apply(b,Array.prototype.concat.call(c,Array.prototype.slice.call(arguments,0)))}}),Function.isFunction=function(a){return"function"==typeof a},Function.prototype.hasOwnProperty("name")||Object.defineProperty(Function.prototype,"name",{get:function(){/^function\s*([^\()]+)/.test(this);var a=RegExp.$1||"Empty";return Object.defineProperty(this,"name",{value:a}),a}}),Function.override=function(a,b,c){return a[b]=c.call(a,a[b]),this},Function.prototype.override=function(a,b){return Function.override(this.prototype,a,b),this},Function.prototype._pool_count=0,Function.prototype.POOL_THRESHOLD=100,Object.defineProperty(Function.prototype,"_pool",{get:function(){var a=[];return Object.addProperty(this,"_pool",a),a}}),Function.prototype.allocate=function(a){var b=this._pool,c=b.length;for(a>c&&(this._pool_count=0,b.length=a);a-->c;)b[a]=Object.create(this.prototype);return this},Function.prototype.grab=function(){return this._pool.pop()||null},Function.prototype.create=function(){var b=this.grab()||(this._pool_count++,Object.create(this.prototype));if(this._pool_count===this.POOL_THRESHOLD&&a.console&&a.console.warn){var c=this.name||"Function";a.console.warn(c+"::create: pool threshold reached. Do you call "+c+"::free when you are done with objects ?")}return b},Function.prototype.factory=function(){var a=this.create();return this.apply(a,arguments),a},Function.prototype.free=function(a){return this._pool_count=0,this._pool.push(a),this},function(){var a={},b=this.Uint8Array||Array;String.prototype.capitalize=function(){return this.length?a[this]||(a[this]=this[0].toUpperCase()+this.slice(1)):this},String.prototype.format=function(){function a(a){for(var b=a.split(c),g=0,h=b.length;h>g;g++){var i=b[g],j=i.indexOf(d);~j&&(b[g]=i.slice(j+1),b.splice(g,0,c+i.slice(0,j)+d),b.splice(g,0,i.slice(0,j)),g+=2,h+=2)}for(var k="var r = '', v = '';\n",l=[],g=0,h=b.length;h>g;g+=3){var a=b[g],m=b[g+1],n=b[g+2];if(a&&(a=a.replace(e,"\\$1"),a=a.replace(f,"\\n"),k+="r += '"+a+"';\n"),n){var o="arg"+l.length;l.push(o),m?(k+="v = arg0 && arg0['"+m+"'];\n",k+="if (typeof v === 'undefined' && '"+m+"' in arg0) v += '';"):k+="v = "+o+";\n",k+="if (v && typeof v === 'object') v = JSON.stringify(v);\n",k+="r += typeof v !== 'undefined' ? (v+'') : '"+n+"';\n\n"}}return k+="return r;",l.push(k),Function.apply(null,l)}function b(){return g[this]||(g[this]=a(this),++h===b.WARN_CACHE_LEN),g[this].apply(null,arguments)}var c="{",d="}",e=/(')/g,f=/(\n)/g;b.WARN_CACHE_LEN=500;var g={},h=0;return b}(),String.prototype.toByteArray=function(){for(var a=0,c=this.length,d=new b(c);c>a;a++)d[a]=255&this.charCodeAt(a);return d},String.prototype.contains=function(a){return!!~this.indexOf(a)},String.isString=function(a){return"string"==typeof a},String.generateUid=function(a){"undefined"==typeof a&&(a=8);for(var b="";b.length<a;)b+=Math.random().toString(16).slice(2);return b.slice(0,a)}}.call(this),function(a,b,c,d){Object.createProto=function(a){if(1!==arguments.length)throw new RangeError;if(!a||"object"!=typeof a)throw new TypeError;if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b},"undefined"==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});var e=Object.merge=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};Object.mergeAll=function(a){for(var b=1,c=arguments.length;c>b;b++)e(a,arguments[b]);return a},Object.mergeDeep=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(Object.isObject(a[c])&&Object.isObject(b[c])?Object.mergeDeep(a[c],b[c]):a[c]=b[c]);return a},Object.forEach=function(a,b,d){var e=a&&"object"==typeof a&&!c(a),f=e&&"function"==typeof b;if(!e||!f)throw new TypeError;for(var g in a)b.call(d,g,a[g],a)};var f=Object.clone=function(a){var b="function"==typeof a.toClone?a.toClone():a.toClone,c=Object.getPrototypeOf(a);return c=Object.createProto(c),Object.merge(c,a),b&&Object.merge(c,b),c},g=Object.cloneDeep=function(a){var b=f(a);for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];e&&"object"==typeof e&&(b[d]=c(e)?e.clone(!0):g(e))}return b};Object.isObject=function(a){return"object"==typeof a&&null!==a},Object.isArguments=function(a){return"[object Arguments]"===d.call(a)},Object.clear=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},Object.ENUMERABLE=1,Object.CONFIGURABLE=2,Object.WRITABLE=4,Object.addProperty=function(){{var a={value:void 0,configurable:!1,writable:!1,enumerable:!1},b={get:void 0,set:void 0,configurable:!1,enumerable:!1};Object.ENUMERABLE|Object.CONFIGURABLE|Object.WRITABLE}return function(c,d,e,f,g){if(("number"!=typeof e||3===arguments.length)&&(g=f,f=e,e=0),void 0===g){var h=a;h.value=f,h.writable=!!(e&Object.WRITABLE)}else{var h=b;h.get=f||void 0,h.set=g||void 0}return h.configurable=!!(e&Object.CONFIGURABLE),h.enumerable=!!(e&Object.ENUMERABLE),Object.defineProperty(c,d,h),c}}(),Object.values=function(a){for(var b=Object.keys(a),c=0,d=b.length;d>c;c++)b[c]=a[b[c]];return b}}(Array.prototype.shift,Array.prototype.pop,Array.isArray,Object.prototype.toString);var $=function(b){function c(b,c,h){var i="u"===b[0].toLowerCase(),j=~b.toLowerCase().indexOf("float");i||(c*=2);var k=0;switch(!0){case!j&&d>=c:k=8;break;case!j&&e>=c:k=16;break;case f>=c:k=32;break;case j&&g>=c:k=64;break;default:return!1}return new(a[b.capitalize()+k+"Array"])(h)}Object.defineProperty(a,"TypedArray",{get:function(){return c}}),this.Int8Array=this.Int8Array||Array,this.Int16Array=this.Int16Array||Array,this.Int32Array=this.Int32Array||Array,this.Uint8Array=this.Uint8Array||Array,this.Uint16Array=this.Uint16Array||Array,this.Uint32Array=this.Uint32Array||Array,this.Float32Array=this.Float32Array||Array,this.Float64Array=this.Float64Array||Array;var d=b(2,8)-1,e=b(2,16)-1,f=b(2,32)-1,g=b(2,64)-1;return c}.call(a,Math.pow);Array.prototype.first=function(){return this.length>0?this[0]:null},Array.prototype.last=function(){return this.length>0?this[this.length-1]:null},Array.prototype.has=function(a){return-1!==this.indexOf(a)},Array.prototype.indexOfElems=function(a){var b=-1,c=arguments.length;a:for(;~(b=this.indexOf(a,b+1));){for(var d=1;c>d;d++)if(this[b+d]!==arguments[d])continue a;return b}return b},Array.prototype.remove=function(a){for(var b=!1,c=0;-1!=(c=this.indexOf(a));)this.splice(c,1),b=!0;return b},Array.prototype.add=function(a){return-1===this.indexOf(a)?(this.push(a),!0):!1},Array.prototype.clear=function(){for(;this.length>0;)this.pop();return this},Array.prototype.filter||(Array.prototype.filter=function(a){for(var b=[],c=0;c<this.length;c++)a(this[c])&&b.push(this[c]);return b}),Array.prototype.random=function(){return this.length?this[Math.random()*this.length|0]:null},Array.prototype.swap=function(a,b){var c=null;return a<this.length&&a>=0&&b<this.length&&b>=0?(c=this[a],this[a]=this[b],this[b]=c,!0):!1},Array.prototype.clone=function(a){a="boolean"==typeof a?a:!1;var b=this.concat();if(!a)return b;for(var c=0,d=b.length;d>c;c++)b[c]&&"object"==typeof b[c]&&(b[c]=Array.isArray(b[c])?b[c].clone(!0):Object.cloneDeep(b[c]));return b},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){if("function"!=typeof a)return this;for(var c=0;c<this.length;c++)a.call(b,this[c],c,this);return this}),Array.prototype.without=function(a){if(!Array.isArray(a)||!a.length)return this.clone();a=a.slice(0);for(var b=[],c=0,d=this.length;d>c;c++){var e=this[c],f=a.indexOf(e);~f?f===a.length-1?a.pop():a[f]=a.pop():b.push(e)}return b},Array.prototype.toObject=function(a,b){a="function"==typeof a?a:null,b="undefined"!=typeof b?Object(b):null;var c=b||{};if(!this.length)return c;for(var d=0,e=this.length;e>d;d++){var f=a?a(this[d],d,this):d;f!==!1&&(c[f]=this[d])}return c},"undefined"==typeof Number.MAX_SAFE_INTEGER&&(Number.MAX_SAFE_INTEGER=9007199254740992),"undefined"==typeof Number.MIN_SAFE_INTEGER&&(Number.MIN_SAFE_INTEGER=-9007199254740992),Number.prototype.between=function(a,b){return this>=Math.min(a,b)&&this<=Math.max(a,b)},Number.prototype.sign=function(){return 0>this?-1:this>0?1:0},function(){var a=Math.random;Math.randomBetween=function(b,c){return a()*(c-b)+b},Object.defineProperty(Math,"DEGREE",{value:Math.PI/180}),Math.deg2rad=function(a){return Math.DEGREE*a}}(),function(){function b(a,c){var d=this instanceof b?this:b.create(),e=a*c;return d.stream&&d.stream.length===e||(d.stream=new b.Stream(a*c)),d.width=a,d.height=c,d}function c(a,b){return 3===b?e(a):2===b?f(a):1===b?g(a):d(a,b)}function d(a,d){for(var e=0,f=0,g=1;d>f;f++,g*=-1)h(f,0,a,d,d,b.cache),e+=g*c(b.cache,d-1,d-1);return e}function e(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j+c*g*h+d*e*i-h*f*d-i*g*b-j*e*c}function f(a){return a[0]*a[3]-a[2]*a[1]}function g(a){return a[0]}function h(a,b,c,d,e,f){for(var g=0,h=e-1,i=0;e>i;i++)if(i!==b){for(var j=0,k=d-1,l=0;d>l;l++)l!==a&&(f[g*k+j]=c[i*d+l],j++);g++}return k*h}function i(a,b,c,d){for(var e=0;b>e;e++)for(var f=0;c>f;f++)d[e*b+f]=a[f*b+e]}function j(a){var b=a[1],c=a[2],d=a[3],e=a[5],f=a[6],g=a[7];a[1]=d,a[2]=f,a[3]=b,a[5]=g,a[6]=c,a[7]=e}function k(a){var b=e(a),c=a[0],d=a[1],f=a[2],g=a[3],h=a[4],i=a[5],k=a[6],l=a[7],m=a[8],n=(h*m-i*l)/b,o=-(g*m-i*k)/b,p=(g*l-h*k)/b,q=-(d*m-f*l)/b,r=(c*m-f*k)/b,s=-(c*l-d*k)/b,t=(d*i-f*h)/b,u=-(c*g-f*g)/b,v=(c*h-d*g)/b;a[0]=n,a[1]=o,a[2]=p,a[3]=q,a[4]=r,a[5]=s,a[6]=t,a[7]=u,a[8]=v,j(a)}function l(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){s[0]=a*j+b*m+c*p,s[1]=a*k+b*n+c*q,s[2]=a*l+b*o+c*r,s[3]=d*j+e*m+f*p,s[4]=d*k+e*n+f*q,s[5]=d*l+e*o+f*r,s[6]=g*j+h*m+i*p,s[7]=g*k+h*n+i*q,s[8]=g*l+h*o+i*r}function m(a,b,c){for(var d=0;c>d;d++)a[d]=b[d]}function n(a,c,d,e,f,g,h,i,j){var k=this instanceof n?this:n.create();return b.call(k,3,3),k.set(a,c,d,e,f,g,h,i,j),k}var o=Math.cos,p=Math.sin;Math.Matrix=b,b.Stream=a.Float64Array,b.cache=new b.Stream(16),b.I=function(a){if(3===a)return new n(1,0,0,0,1,0,0,0,1);for(var c=new b(a,a),d=c.stream,e=0;a>e;e++)for(var f=0;a>f;f++)d[f*a+e]=e===f?1:0;return c},b.prototype.set=function(){return m(this.stream,arguments,this.stream.length>arguments.length?this.stream.length:arguments.length),this},b.prototype.multiply=function(a,c){var c=c||this,d=this.stream,e=this.width,f=this.height,g=a.width,h=a.height,a=a.stream,i=c.stream;if(e!==h)throw new RangeError("Matrix::multiply: can`t multiply matrices ({},{}) x ({}, {})".format(e,f,g,h));for(var j=g*f,k=0;f>k;k++)for(var l=0;g>l;l++){for(var n=0,o=0;h>o;o++)n+=d[k*e+o]*a[o*g+l];b.cache[k*g+l]=n}return i.length!==j&&(i=c.stream=new b.Stream(j)),m(i,b.cache,j),c},b.prototype.transpose=function(){var a=this.stream,c=this.width,d=this.height;return i(a,c,d,b.cache),m(a,b.cache,a.length),this.width=d,this.height=c,this},b.prototype.determinant=function(){var a=this.width,b=this.height;if(a!==b)throw RangeError("Matrix::determinant: matrix is not squere  ("+a+"x"+b+")");if(!a||!b)throw RangeError("Matrix::determinant: matrix is empty  ("+a+"x"+b+")");return c(this.stream,a)},b.prototype.clone=function(a){return a=a||b.create(),b.call(a,this.width,this.height),m(a.stream,this.stream,this.width*this.height),a},b.prototype.destroy=function(){b.free(this)},Math.Matrix33=n,n.prototype=Object.create(b.prototype,{m11:{get:function(){return this.stream[0]}},m12:{get:function(){return this.stream[1]}},m13:{get:function(){return this.stream[2]}},m21:{get:function(){return this.stream[3]}},m22:{get:function(){return this.stream[4]}},m23:{get:function(){return this.stream[5]}},m31:{get:function(){return this.stream[6]}},m32:{get:function(){return this.stream[7]}},m33:{get:function(){return this.stream[8]}}}),n.prototype.determinant=function(){return e(this.stream,3)},n.prototype.transpose=function(){return j(this.stream),this},n.prototype.inverse=function(){return k(this.stream),this},n.prototype.inv=function(){return this.inverse()},n.prototype.set=function(a,b,c,d,e,f,g,h,i){var j=this.stream;return j[0]=a,j[1]=b,j[2]=c,j[3]=d,j[4]=e,j[5]=f,j[6]=g,j[7]=h,j[8]=i,this},n.prototype.clone=function(a){return a=a||n.create(),n.apply(a,this.stream),a},n.prototype.translate=function(a,b,c){c=c||this;var d=this.stream,e=c.stream;return l(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],1,0,0,0,1,0,a,b,1,e),c},n.prototype.rotate=function(a,b){b=b||this;var c=this.stream,d=b.stream,e=p(a),f=o(a);return l(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],f,-e,0,e,f,0,0,0,1,d),b},n.prototype.scale=function(a,b,c){c=c||this;var d=this.stream,e=c.stream;return l(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],a,0,0,0,b,0,0,0,1,e),c},n.prototype.skew=function(a,b,c){c=c||this;var d=this.stream,e=c.stream;return l(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],1,Math.tan(b),0,Math.tan(a),1,0,0,0,1,e),c},n.prototype.destroy=function(){n.free(this)}}(),Math.Vector2d=function(a,b){var c=this instanceof Math.Vector2d?this:Math.Vector2d.create();return Math.Matrix.call(c,3,1),c.set(a,b),c},Math.Vector2d.prototype=Object.create(Math.Matrix.prototype,{x:{enumerable:!0,get:function(){return this.stream[0]},set:function(a){return this.stream[0]=a}},y:{enumerable:!0,get:function(){return this.stream[1]},set:function(a){return this.stream[1]=a}},length:{get:function(){var a=this.stream;return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))}}}),Math.Vector2d.prototype.set=function(a,b){var c=this.stream;return c[0]=a,c[1]=b,c[2]=1,this},Math.Vector2d.prototype.equals=function(a,b){return b=b||0,Math.abs(this.x-a.x)<=b&&Math.abs(this.y-a.y)<=b},Math.Vector2d.prototype.normalize=function(){var a=this.length||1,b=this.stream;return b[0]/=a,b[1]/=a,this},Math.Vector2d.prototype.multiplyByScalar=function(a,b){return b=b||this,b.x=this.x*a,b.y=this.y*a,b},Math.Vector2d.prototype.add=function(a,b){return b=b||this,b.x=this.x+a.x,b.y=this.y+a.y,b},Math.Vector2d.prototype.sub=function(a,b){return b=b||this,b.x=this.x-a.x,b.y=this.y-a.y,b},Math.Vector2d.prototype.dot=function(a){return this.x*a.x+this.y*a.y},Math.Vector2d.prototype.destroy=function(){Math.Vector2d.free(this)},Math.Vector2d.prototype.clone=function(a){return a=a||Math.Vector2d.create(),Math.Vector2d.call(a,this.x,this.y),a};var _=function(){function b(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}Object.defineProperty(a,"Namespace",{get:function(){return b}});var c=String.prototype.split,d=Array.prototype.indexOf,e=["function","object"],f=".",g="";return b.prototype.get=function(a){return b.get(this,a)},b.prototype.set=function(a,c){return b.set(this,a,c)},b.prototype.unset=function(a){return b.unset(this,a)},b.get=function(a,b){var e=a,h=c.call(String(b),f);if(-1!==d.call(h,g))throw'Namespace.get: Empty key passed - "'+b+'"';for(var i=0,j=h.length;j>i;i++){var k=h[i];if(!e||!e.hasOwnProperty(k))return void 0;e=e[k]}return e},b.set=function(a,b,h){var i=a,j=c.call(String(b),f);if(-1!==d.call(j,g))throw'Namespace.set: Empty key passed - "'+b+'"';
for(var k=0,l=j.length-1;l>k;k++){var m=j[k];i=i&&i.hasOwnProperty(m)&&i[m]&&-1!==d.call(e,typeof i[m])?i[m]:i[m]={}}return i[j[k]]=h},b.unset=function(a,b){var h=a,i=c.call(String(b),f);if(-1!==d.call(i,g))throw'Namespace.unset: Empty key passed - "'+b+'"';for(var j=0,k=i.length-1;k>j;j++){var l=i[j];if(!(h&&h.hasOwnProperty(l)&&h[l]&&-1!==d.call(e,typeof h[l])))return null;h=h[l]}return delete h[i[k]],h},b.Chain=function(a,c){var d=b.prototype;b.prototype=c;var e=new b(a);return b.prototype=d,e},b}();Object.defineProperty(a,"Model",{get:function(){return b}}),b.INITIALIZE="initialize",b._getEventMethodName=function(){var a={};return function(b){return a[b]?a[b]:a[b]="on{}".format(b)}}(),b.prototype={constructor:b,initialize:function(){},get $(){return this.$={}},set $(a){Object.addProperty(this,"$",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,a)},get:function(a){a+="";var b=this["get"+a.capitalize()];return"function"==typeof b?(arguments[0]=this,Function.call.apply(b,arguments)):this[a]},set:function(a){a+="";var b=this["set"+a.capitalize()];return"function"==typeof b?(arguments[0]=this,Function.call.apply(b,arguments)):this[a]=arguments[1],this},on:function(a,b){var c=this._events[a]||(this._events[a]=[]);return c.has(b)||c.push(b),this},once:function(a,b){function c(d){g.off(a,c),b.call(this,d)}var d=this._events[a];if(d)for(var e=0,f=d.length;f>e;e++)if(null!==d[e]&&d[e].handler===b)return this;var g=this;return c.handler=b,this.on(a,c),this},off:function(a,b){var c=this._events[a];if(a&&b){if(c){var d=c.indexOf(b);~d&&(c[d]=null);for(var e=0,f=c.length;f>e;e++)if(null!==c[e]&&c[e].handler===b){c[e]=null;break}}}else if(a){if(c)for(var e=0,f=c.length;f>e;e++)c[e]=null}else for(var a in this._events)this.off(a);return this},trigger:function(a,c){var d=this._events[a],e=b._getEventMethodName(a);if("function"==typeof this[e]&&this[e](c),d)for(var f=0,g=d.length;g>f;f++)null===d[f]?(d.splice(f,1),f--,g--):d[f].call(this,c);return this},destroy:function(){return this.off(),this.constructor.free(this),this}};var ab=new b;ab.ERROR="error",ab.WARN="warn",ab.INFO="info",ab.INITIALIZE="initialize",ab.BOOTSTRAP="bootstrap",ab.PRELOAD="preload",ab.READY="ready",ab.debug=!0,ab.ready=function(a){return"function"==typeof a&&(ab.state===ab.READY?a.call(ab):ab.once(ab.READY,a)),ab},ab.state=ab.INITIALIZE,ab.start=function(){return ab.state!==ab.INITIALIZE?ab:(ab.state=ab.BOOTSTRAP,ab.trigger(ab.BOOTSTRAP),ab.state=ab.PRELOAD,ab.trigger(ab.PRELOAD),fb.on(z.READY,function(){ab.state=ab.READY,ab.trigger(ab.READY)}),fb.load(),ab)},ab.NOP=function(){},ab.now=Date.now||function(){return(new Date).valueOf()},ab.Class=Z,ab.Model=b,ab.Namespace=_,ab.TypedArray=$,Object.addProperty(ab,"RELEASE",!0);var bb=ab.Loop=new b;bb.DELAY=17,bb.interval=0,bb.VSYNC="vsync",bb.REFLOW="reflow",bb.frame=function(){return clearTimeout(bb.interval),bb.interval=0,bb.trigger(bb.VSYNC),bb.trigger(bb.REFLOW),this},bb.request=function(){return bb.interval?!1:(bb.interval=setTimeout(bb.frame,bb.DELAY),!0)};var cb=ab.Device=new b;cb.platform={type:"desktop",name:""},cb.navigator={browser:{name:"",version:0},language:""},cb.keyboard=!1,cb.KEYBOARD_STATUS_CHANGE="keyboardstatuschange",cb.online=!0,cb.ONLINE="online",cb.OFFLINE="offline",cb.pageVisible=!0,cb.PAGE_SHOW="pageshow",cb.PAGE_HIDE="pagehide",cb.SCREEN_ORIENTATION_CHANGE="screenorientationchange",cb.screen={width:0,height:0,pixelDepth:24,pixelRatio:1,orientation:0},cb.features={canvas:!1,svg:!1,audio:!1,video:!1,compass:!1,fullscreen:!1,userMedia:!1,gamepad:!1,cache:{scripts:!1,files:!1,data:!1},geolocation:!1,notifications:!1,pageVisibility:!1,vibration:!1,telephony:!1,pointerLock:!1};var db=ab.Device.Fullscreen=new b;db.viewport=null,db.STATUS_CHANGED="statuschanged",db.request=function(a,b,c){return db.viewport!==a?c(new ab.Error("Feature not implemented")):(db.trigger(db.STATUS_CHANGED,a),void b())},db.exit=function(a,b){return db.viewport?b():(db.trigger(db.STATUS_CHANGED),void a())},db.toggle=function(a,b,c){return db.viewport?db.exit(b,c):db.request(a,b,c)};var eb=ab.Device.Geolocation=new b;eb.position=null,eb.watching=!1,eb.getPosition=function(a,b,c){var d=eb.position;null===d?b():c(d)},eb.setPosition=function(a){eb.position!==a&&(eb.position=a,eb.trigger("positionchanged"))},eb.clearWatch=function(a,b){eb.watching===!1?b():a()},ab.Device.Notification=c,c.property({title:void 0,body:void 0,tag:void 0,expireTime:0,iconURL:void 0,autoshow:!0,onshow:null,onerror:null,onclick:null,onclose:null}),c.method({show:function(){return"function"==typeof this.onshow?this.onshow():void 0},close:function(){return"function"==typeof this.onclose?this.onclose():void 0}}),function(a,b){var c=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||null;if(!c)return!1;var d=!1,e=function(){d=!1,b.frame()};b.request=function(){return d?!1:(d=!0,c(e),!0)}}(this,ab.Loop),function(){function a(a,c){if(a&&c){var d=document.createElement("meta");return d.setAttribute("name",a),d.setAttribute("content",c),document.head.insertBefore(d,b),d}}var b=document.head.children[1];a("viewport","width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"),a("HandheldFriendly","true"),a("MobileOptimized",480),/iPod|iPad|iPhone/.test(navigator.userAgent)&&(a("apple-mobile-web-app-capable","yes"),a("apple-mobile-web-app-status-bar-style","black-translucent"))}(ab,ab.Device),function(a){a.userAgents={platform:{"windows nt 6.2":"Windows 8","windows nt 6.1":"Windows 7","windows nt 6.0":"Windows Vista","windows nt 5.2":"Windows 2003","windows nt 5.1":"Windows XP","windows nt 5.0":"Windows 2000","windows nt 4.0":"Windows NT","winnt4.0":"Windows NT","winnt 4.0":"Windows NT",winnt:"Windows NT","windows 98":"Windows 98",win98:"Windows 98","windows 95":"Windows 95",win95:"Windows 95",windows:"Unknown Windows OS","os x":"Mac OS X","intel mac":"Intel Mac","ppc mac":"PowerPC Mac",powerpc:"PowerPC",ppc:"PowerPC",cygwin:"Cygwin",linux:"Linux",debian:"Debian",openvms:"OpenVMS",sunos:"Sun Solaris",amiga:"Amiga",beos:"BeOS",apachebench:"ApacheBench",freebsd:"FreeBSD",netbsd:"NetBSD",bsdi:"BSDi",openbsd:"OpenBSD","os/2":"OS/2",warp:"OS/2",aix:"AIX",irix:"Irix",osf:"DEC OSF","hp-ux":"HP-UX",hurd:"GNU/Hurd",unix:"Unknown Unix OS"},browser:{opera:"Opera",msie:"Internet Explorer","internet explorer":"Internet Explorer",iemobile:"Internet Explorer",shiira:"Shiira",firefox:"Firefox",chimera:"Chimera",phoenix:"Phoenix",firebird:"Firebird",camino:"Camino",navigator:"Netscape",netscape:"Netscape",omniweb:"OmniWeb",chrome:"Chrome",safari:"Safari",cfnetwork:"Safari",konqueror:"Konqueror",epiphany:"Epiphany",galeon:"Galeon",mozilla:"Mozilla",icab:"iCab",lynx:"Lynx",links:"Links",hotjava:"HotJava",amaya:"Amaya",ibrowse:"IBrowse"},mobile:{iemobile:"Windows Phone OS","windows phone os":"Windows Phone OS",mobileexplorer:"Mobile Explorer",openwave:"Open Wave","opera mini":"Opera Mini",operamini:"Opera Mini",elaine:"Palm",palmsource:"Palm","digital paths":"Palm",avantgo:"Avantgo",xiino:"Xiino",palmscape:"Palmscape",nokia:"Nokia",ericsson:"Ericsson",blackberry:"BlackBerry",motorola:"Motorola",iphone:"iPhone",ipad:"iPad",ipod:"iPod",android:"Android"}}}(ab.Device),function(a){var b,c=function(a,b,c){c[b]=a.toLowerCase()},d=function(a,b){var c=function(a,c){return b.indexOf(a)-b.indexOf(c)};return a.length>1&&a.sort(c),a};b=function(){var b=document.documentElement;return a.features=Object.merge(a.features,{canvas:!!window.CanvasRenderingContext2D,svg:!!window.SVGElement,audio:!!window.Audio,video:!!window.HTMLVideoElement,compass:"object"==typeof window.ondeviceorientation&&"object"==typeof window.ondevicemotion,fullscreen:!!(b.requestFullscreen||b.requestFullScreen||b.mozRequestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullscreen||b.webkitRequestFullScreen),userMedia:!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia),gamepad:!!(navigator.gamepads||navigator.webkitGamepads||navigator.mozGamepads),cache:{scripts:!!window.applicationCache,files:!!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem),data:!!(window.localStorage||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.openDatabase)},geolocation:!!navigator.geolocation,notifications:!!window.Notification,pageVisibility:!!(document.visibilityState||document.mozVisibilityState||document.webkitVisibilityState),vibration:!!navigator.vibrate,telephony:!(!navigator.telephony&&!navigator.mozTelephony),pointerLock:!!(b.requestPointerLock||b.webkitRequestPointerLock||b.mozRequestPointerLock)})}(),function(){var b,e,f,g,h,i=navigator.userAgent;g=a.userAgents.mobile,h=Object.keys(g),b=i.match(new RegExp(h.join("|"),"ig")),null!==b?e="mobile":(g=a.userAgents.platform,h=Object.keys(g),b=i.match(new RegExp(h.join("|"),"ig")),null!==b&&(e="desktop")),null!==b&&(b.forEach(c),d(b,h),f=g[b.first()],null!==f.match(/iPod|iPad|iPhone/)&&(f="iOS"),a.platform=Object.merge(a.platform,{type:e,name:f}))}(),function(){!function(){var b,e,f,g=a.userAgents.browser,h=Object.keys(g),i=navigator.userAgent;b=i.match(new RegExp(h.join("|"),"ig")),null!==b&&(e=function(){return b.forEach(c),d(b,h),b.first()}(),f=function(){var a=new RegExp(e,"i").exec(i).index,b=i.substring(a+e.length+1);return b.length>0?(b.indexOf(" ")>0&&(b=b.substring(0,b.indexOf(" "))),parseFloat(b)):void 0}(),a.navigator.browser=Object.merge(a.navigator.browser,{name:a.userAgents.browser[e],version:f}))}(),function(){var b=navigator.userLanguage||navigator.systemLanguage||navigator.language;"undefined"!=typeof b&&(b=b.split("-"),"undefined"==typeof b[1]&&(b[1]=b[0]),b=b[0]+"-"+b[1].toUpperCase(),a.navigator.language=b)}()}(),function(){if("mobile"===a.platform.type){var b=function(b){var c=a.keyboard;c!==b&&(a.keyboard=b,a.trigger(a.KEYBOARD_STATUS_CHANGE))};window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("touchstart",function(){b(!1)}),document.body.addEventListener("keydown",function(){b(!0)})})}a.keyboard="mobile"!==a.platform.type}(),"boolean"==typeof navigator.onLine&&!function(){var b=function(){a.online=navigator.onLine};window.addEventListener("online",function(){b(),a.trigger(a.ONLINE)}),window.addEventListener("offline",function(){b(),a.trigger(a.OFFLINE)}),b()}(),function(){var b,c,d=screen.mozOrientation||screen.webkitOrientation||screen.orientation;"string"==typeof d?(b=function(){a.screen.orientation=function(){switch(d){case"portrait-primary":return 0;case"portrait-secondary":return 180;case"landscape-primary":return-90;case"landscape-secondary":return 90}}()},screen.addEventListener("orientationchanged",function(){b(),a.trigger(a.SCREEN_ORIENTATION_CHANGE,a.screen.orientation)}),b()):"undefined"!=typeof window.orientation?(b=function(){a.screen.orientation=window.orientation},window.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("orientationchange",function(){b(),a.trigger(a.SCREEN_ORIENTATION_CHANGE,window.orientation)}),b()})):(b=function(){a.screen.orientation=c.clientWidth>c.clientHeight?90:0},window.addEventListener("DOMContentLoaded",function(){c=document.body,window.addEventListener("resize",function(){var c=a.screen.orientation;b(),c!==a.screen.orientation&&a.trigger(a.SCREEN_ORIENTATION_CHANGE,c)}),b()})),a.screen=Object.merge(a.screen,{width:screen.width,height:screen.height,pixelDepth:screen.pixelDepth||screen.colorDepth,pixelRatio:window.devicePixelRatio||1})}(),b.pageVisibility?!function(){var b="visibilityState",c="visibilitychange";!function(){var a=document.webkitVisibilityState&&"webkit"||document.mozVisibilityState&&"moz"||document.msVisibilityState&&"ms"||null;null!==a&&(b=a+b.capitalize(),c=a+c)}(),document.addEventListener(c,function(){var c=document[b],d="visible"===c;a.pageVisible=d,a.trigger(d?a.PAGE_SHOW:a.PAGE_HIDE)})}():(window.addEventListener("focus",function(){a.pageVisible||(a.pageVisible=!0,a.trigger(a.PAGE_SHOW))}),window.addEventListener("blur",function(){a.pageVisible&&(a.pageVisible=!1,a.trigger(a.PAGE_HIDE))})),delete a.userAgents}(ab.Device),function(a,b){function c(){l={};for(var a=k.length;a--;)k.pop()()}var d=window.document,e=d.documentElement,f=null,g=null,h=null,i=null,j=null;if(function(){function a(a,b){""!==n&&(a=a.capitalize()),b=b||"";for(var c=0;l>c;c++)var f=n+a+k[c]+b;return f in d||f in e?f:null}for(var b=["moz","webkit"],c=b.length,k=["Fullscreen","FullScreen"],l=k.length,m=-1;c>m;m++){var n=b[m]||"";a("request")&&(f=a("request"),g=a("exit")||a("cancel"),h=a("","Element")||a("current","Element"),i=n+"fullscreenchange",j=n+"fullscreenerror")}}(),f&&g&&h&&i&&j){var k=[],l={};d[h]&&(b.viewport=!0,b.exit()),e.addEventListener(i,function(){var a=d[h];b.viewport=a&&l[a],c()}),e.addEventListener(j,function(){c()}),Z.decorate(b,"request",function(a,b,c){var d=this._super.bind(this,a,b,c);k.push(d);var e=a.div;l[e]=a,e[f]()}),Z.decorate(b,"exit",function(a,b){var c=this._super.bind(this,a,b);k.push(c),d[g]()})}}(ab.Device,ab.Device.Fullscreen),function(a,b){if(a.features.geolocation){var c=null;Z.decorate(b,"getPosition",function(a,d,e){var f,g=this._super;f=navigator.geolocation[a?"watchPosition":"getCurrentPosition"](function(c){b.setPosition([c.coords.latitude,c.coords.longitude]),g(a,d,e)},function(){g(a,d,e)}),a&&(c=f)}),Z.decorate(b,"clearWatch",function(a){var d=this._super;null!==c&&b.watching===!0&&(b.watching=!1,navigator.geolocation.clearWatch(c)),d(onerror,a)})}}(ab.Device,ab.Device.Geolocation),function(a,b){if(a.features.notifications){var c=!0;b.decorate("show",function(){function a(){return e.onerror&&e.onerror()}function b(){var b=e.notification=new window.Notification(e.title,{body:e.body,tag:e.tag||"",iconUrl:e.iconURL});b.addEventListener("show",function(){return d.call(e)}),b.addEventListener("error",a),b.addEventListener("click",function(){return e.onclick&&e.onclick(),c&&e.close()}),e.expireTime&&b.addEventListener("show",function(){e.timeout=window.setTimeout(function(){return e.close()},e.expireTime)}),b.show()}var d=this._super,e=this,f=window.Notification.permission||window.Notification.permissionLevel&&window.Notification.permissionLevel();"granted"===f||"undefined"==typeof f?b():window.Notification.requestPermission(function(c){return"granted"===c?b():a()})}),b.decorate("close",function(){if(!this.notification)return this._super();var a=this._super,b=this,c=this.notification,d=c.timeout;return c.addEventListener("close",function(){return a.call(b)}),d&&window.clearTimeout(d),c.close(),delete this.notification})}}(ab.Device,ab.Device.Notification),function(a,b){Z.decorate(a,"request",function(c,d,e){if(c=c instanceof ab.Viewport?c:null,d="function"==typeof d?d:b,e="function"==typeof e?e:b,!c)throw new TypeError("No viewport passed");if(a.viewport===c)return d();if(a.viewport){var f=this._super.bind(this,c,d,e);return a.exit(f,e)}this._super(c,d,e)}),Z.decorate(a,"exit",function(c,d){return c="function"==typeof c?c:b,d="function"==typeof d?d:b,a.viewport?void this._super(c,d):c()})}(ab.Device.Fullscreen,ab.NOP),ab.Error=d,d.NAME="Engine{0}Error",d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d.prototype.type="",d.prototype.model=null,d.prototype.message="",d.prototype.toString=function(){return this.name+(this.message&&": "+this.message)},ab.Error.Reference=e,e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.type="reference",ab.Error.Syntax=f,f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f.prototype.type="syntax",ab.Error.Range=g,g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.type="range",ab.Error.Type=i,i.prototype=Object.create(d.prototype),i.prototype.constructor=i,i.prototype.type="type",ab.Error.NotImplemented=j,j.prototype=Object.create(d.prototype),j.prototype.constructor=j,j.prototype.type="notImplemented",ab.Timer=k,k.STANDARD="standard",k.LOOP="loop",k.STEP="step",k.STOP="stop",k.PLAY="play",k.PAUSE="pause",k.queue={},k.evaluate=function(a,b){var c=k.queue,d=c.hasOwnProperty(a)?c[a]:null;if(!d||!d.length)return!1;for(var e=d.length;e-->0;){var f=d[e];if(f){var g=f.progress+=b;f.stepprogress+=b,f.stepprogress>=f.delay&&(f.progress=Math.min(f.progress,f.duration),f.trigger(k.STEP),f.stepprogress%=f.delay),g>=f.duration&&(f.loop?(g%=f.duration,f.trigger(k.LOOP),f.count++,f.progress=g,f.count>=f.iterations&&f.stop()):f.stop())}else Array.prototype.splice.call(d,e,1)}return!!d.length},k.start=function(a){ab.trigger(k.PLAY,a)},k.stop=function(a){ab.trigger(k.STOP,a)},k.prototype=Object.create(b.prototype),k.prototype.constructor=k,k.prototype.type=k.STANDARD,k.prototype.duration=1e3,k.prototype.loop=!1,k.prototype.iterations=1/0,k.prototype.delay=1,k.prototype.autoplay=!1,k.prototype.reset=function(){this.progress=0,this.stepprogress=0,this.count=0},k.prototype.play=function(){if(!this.playing){var a=k.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[];return b.add(this),1===b.length&&k.start(this.type),this.playing=!0,this.trigger(k.PLAY),!0}return!1},k.prototype.pause=function(){if(this.playing){var a=k.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[],c=Array.prototype.indexOf.call(b,this);return~c&&(b[c]=null),this.playing=!1,this.trigger(k.PAUSE),!0}return!1},k.prototype.stop=function(){if(this.playing){var a=k.queue,b=a.hasOwnProperty(this.type)?a[this.type]:a[this.type]=[],c=Array.prototype.indexOf.call(b,this);return~c&&(b[c]=null),this.playing=!1,this.progress=0,this.stepprogress=0,this.trigger(k.STOP),!0}return!1},k.prototype.destroy=function(){return this.stop(),b.prototype.destroy.call(this)},function(a,b,c){function d(a){return a!==h?!1:(g||(i=c(),g=setInterval(f,17)),!0)}function e(a){return a!==h?!1:(clearInterval(g),g=0,!0)}function f(){var a=c()-i;i+=a,b.evaluate(h,a)||b.stop(b.STANDARD)}var g=0,h=b.STANDARD,i=0;a.on(b.PLAY,d).on(b.STOP,e)}(ab,ab.Timer,ab.now),function(a,b,c,d){function e(a){return a!==h?!1:(b.on(b.VSYNC,g),(b.request()||null===i)&&(i=d()),!0)}function f(a){return a!==h?!1:(b.off(b.VSYNC,g),i=null,!0)}function g(){var a=d()-i;i+=a,c.evaluate(h,a)?b.request():c.stop(c.VSYNC)}var h=c.VSYNC="vsync",i=null,j=0;a.Device.on(a.Device.PAGE_HIDE,function(){j=d()}).on(a.Device.PAGE_SHOW,function(){null!==i&&(i+=d()-j)}),a.on(c.PLAY,e).on(c.STOP,f)}(ab,ab.Loop,ab.Timer,ab.now),ab.Box=l,l.overlap=function(a,b,c,d,e,f,g,h){return e+g>a&&a+c>e&&f+h>b&&b+d>f},l.extend=function(a,b,c,d,e,f,g,h){return e>=a&&a+c>=e+g&&f>=b&&b+d>=f+h},l.prototype.overlap=function(a){return l.overlap(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},l.prototype.extend=function(a){return l.extend(this.x,this.y,this.w,this.h,a.x,a.y,a.w,a.h)},l.prototype.bound=function(a,b){var c=this.x,d=this.y,e=a.x,f=a.y,b=b||this;return b.x=Math.min(c,e),b.y=Math.min(d,f),b.w=Math.max(c+this.w,e+a.w)-b.x,b.h=Math.max(d+this.h,f+a.h)-b.y,b},l.prototype.clip=function(a,b){var c,d,e,f,g=this.x,h=this.y,i=a.x,j=a.y,b=b||this;return c=Math.max(g,i),d=Math.max(h,j),e=Math.min(g+this.w,i+a.w)-c,f=Math.min(h+this.h,j+a.h)-d,0>e||0>f?b.reset(0,0,0,0):b.reset(c,d,e,f)},l.prototype.copy=function(a){this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h},l.prototype.area=function(){return this.w*this.h},l.prototype.toString=function(){return"Box("+this.x+","+this.y+","+this.w+","+this.h+")"},l.prototype.clone=function(){return l(this.x,this.y,this.w,this.h)},l.prototype.equal=function(a){return a.x==this.x&&a.y==this.y&&a.w==this.w&&a.h==this.h},l.prototype.reset=function(a,b,c,d){return this.x=a,this.y=b,this.w=c,this.h=d,this},l.prototype.getMaximalFreeBoxes=function(a,b){if(b=b||[],!this.overlap(a))return null;var c=this.x+this.w,d=this.y+this.h,e=a.x+a.w,f=a.y+a.h;return this.y<a.y&&b.push(l.factory(this.x,this.y,this.w,a.y-this.y)),c>e&&b.push(l.factory(e,this.y,c-e,this.h)),d>f&&b.push(l.factory(this.x,f,this.w,d-f)),this.x<a.x&&b.push(l.factory(this.x,this.y,a.x-this.x,this.h)),b},l.prototype.fit=function(a){return this.w>=a.w&&this.h>=a.h},l.prototype.destroy=function(){l.free(this)},ab.BoxPacker=m,m.RIGHTWARD_TOP_TO_BOTTOM=1,m.DOWNWARD_LEFT_TO_RIGHT=2,m.sorters={},m.sorters[m.DOWNWARD_LEFT_TO_RIGHT]=function(a,b){return a.y-b.y||a.x-b.x},m.sorters[m.RIGHTWARD_TOP_TO_BOTTOM]=function(a,b){return a.x-b.x||a.y-b.y},m.mergeBoxes=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<a.length;d++)if(b!==d){var e=a[d];c.extend(e)&&(b>d&&b--,a.splice(d--,1))}return a},m.prototype.pack=function(a){for(var b=this.spaces,c=b.length,d=0;c>d;d++){var e=b[d];if(e.fit(a))return this.placeInSpace(a,e),!0}return!1},m.prototype.placeInSpace=function(a,b){a.x=b.x,a.y=b.y,this.placed(a)},m.prototype.placed=function(a){for(var b=[],c=this.spaces,d=c.length,e=0;d>e;e++){var f=c[e],g=f.getMaximalFreeBoxes(a);g?b.push.apply(b,g):b.push(f)}this.spaces=b,this.removeRedundantSpaces()},m.prototype.removeRedundantSpaces=function(){m.mergeBoxes(this.spaces),this.spaces.sort(this.sorter)},m.prototype.addSpace=function(a){this.spaces.push(a),this.removeRedundantSpaces()},m.prototype.destroy=function(){if(this.spaces)for(;this.spaces.length;)this.spaces.pop().destroy()},ab.Network=new b,ab.Network.Url={REGEXP:new RegExp("^{}?{}?{}?{}?{}?{}?$".format("(?:([a-z0-9]+\\:?)?\\/\\/)","([^\\/\\:]+)","(?:\\:([0-9]+))","([^\\?]+)","(?:(\\?[^\\#]+))","(?:(#.*))"),"i"),parse:function(a){a=String(a);var b=this.REGEXP.exec(a)||[],c=String(b[1]||"").toLowerCase(),d=b[2]||"",e=b[3]||"",f=b[4]||"",g=b[5]||"",h=b[6]||"",i=e?d+":"+e:d;return{protocol:c,host:i,hostname:d,port:e,pathname:f,search:g,hash:h,origin:c+"//"+i,href:c+"//"+i+f+g+h}},toQuery:function(a){if(!a||"object"!=typeof a)throw new i("Engine.Network.Url::toQuery(): passed data is not an Object");var b="";for(var c in a)b+=c+"="+a[c]+"&";return b.slice(0,-1)},fromQuery:function(a){a=String(a);var b={};if(""===a)return b;a=a.split("&");for(var c=0,d=a.length;d>c;c++){var e=a[c].split("=");b[e[0]||""]=e[1]||""}return b}},ab.Network.Resource=n,n.JSON="json",n.TEXT="text",n.DATA="data",n.AUTO="auto",n.METHODS=[n.GET="get",n.POST="post",n.PUT="put",n.DELETE="delete"],n.LOAD="load",n.ERROR="error",n.PROGRESS="progress",n.ABORT="abort",n.prototype=Object.create(b.prototype),n.prototype.constructor=n,n.prototype.src="",n.prototype.headers=null,n.prototype.method=n.GET,n.prototype.type=n.AUTO,n.prototype.data=null,n.prototype.autoload=!0,n.prototype["on"+n.LOAD]=function(a){this.response=a,this.pending=!1,this.complete=!0},n.prototype["on"+n.ERROR]=function(){this.response=null,this.pending=!1,this.complete=!1},n.prototype.load=function(){return this.pending||!this.src?!1:(this.pending=!0,this.complete=!1,this.response=null,!0)},n.prototype.abort=function(){return this.pending?(this.pending=!1,this.complete=!1,this.response=null,!0):!1},ab.Network.Resource.Error={},ab.Network.Resource.Error.Request=o,o.prototype=Object.create(d.prototype),o.prototype.constructor=o,o.prototype.type="networkResourceRequest",o.prototype.status=0,o.prototype.data=null,ab.Network.Resource.Error.Parse=p,p.prototype=Object.create(d.prototype),p.prototype.constructor=p,p.prototype.type="networkResourceParse",ab.Network.Resource.Error.Send=q,q.prototype=Object.create(d.prototype),q.prototype.constructor=q,q.prototype.type="networkResourceSend",ab.Network.Socket=r,r.OPEN="open",r.MESSAGE="message",r.CLOSE="close",r.prototype=Object.create(b.prototype),r.prototype.constructor=r,r.prototype.src="",r.prototype.connect=function(){return this},r.prototype.send=function(){return this},r.prototype.close=function(){return this},ab.Asset=s,s.INITIALIZED="initialized",s.LOADING="loading",s.READY="ready",s.ERROR="error",s.prototype=Object.create(b.prototype),Object.addProperty(s.prototype,"status",Object.ENUMERABLE,function(){return this._status},function(a){switch(a){case s.INITIALIZED:case s.LOADING:this._status=a;break;case s.ERROR:case s.READY:Object.addProperty(this,"status",Object.CONFIGURABLE|Object.ENUMERABLE,a),delete this._status,this.trigger(a);break;default:throw new TypeError("Engine.Asset: invalid status. `{}` given.".format(a))}}),s.prototype.load=function(){return this.status=s.LOADING,this},s.prototype.unload=function(){return this._status=s.INITIALIZED,delete this.status,this},s.prototype.destroy=function(){throw new ab.Error("`Asset` can't be destroyed")},s.prototype.on=function(a,c){return b.prototype.on.call(this,a,c),(a===s.READY||a===s.ERROR)&&this.status===a&&c.call(this),this},ab.Color=t,t.HASH3=/^#?([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,t.HASH6=/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,t.RGBA=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*([0-9\\.]+)\)$/,t.RGB=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/,t.HSL=/^hsl\((\d+)(?:deg)?,\s*(\d+)%?,\s*(\d+)%?\)$/,t.WHITESPACE=/\s+/g,t.cache={},t.Name={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},t.fromHSL=function(a,b,c,d){if(a=+a||0,b=+b||0,c=+c||0,a=a%360/360,b/=100,c/=100,d=d||[0,0,0],0===b)d[0]=d[1]=d[2]=255*c;else{var e=.5>c?c*(1+b):c+b-c*b,f=2*c-e;d[0]=255*t.fromHSL.hue(f,e,a+1/3),d[1]=255*t.fromHSL.hue(f,e,a),d[2]=255*t.fromHSL.hue(f,e,a-1/3)}return d},t.fromHSL.hue=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},t.toIndex=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"},t.prototype=Object.create(s.prototype),t.prototype.r=0,t.prototype.g=0,t.prototype.b=0,t.prototype.a=1,t.prototype.index="",t.prototype.toString=function(){return this.index},ab.Gradient=u,u.cache={},u.toIndex=function(a,b,c,d){return a+"|"+b+"|"+c+"|"+JSON.stringify(d)},u.LINEAR="linear",u.RADIAL="radial",u.TYPES=[u.LINEAR,u.RADIAL],u.prototype=Object.create(s.prototype),u.prototype.toString=function(){return this.index},ab.Image=v,v.cache={},v.prototype=Object.create(s.prototype),Object.addProperty(v.prototype,"width",Object.ENUMERABLE|Object.WRITABLE,0),Object.addProperty(v.prototype,"height",Object.ENUMERABLE|Object.WRITABLE,0),v.prototype.src="",v.prototype.toString=function(){return this.src},s.Loader=z,z.PROGRESS="progress",z.READY="ready",z.COMPLETE="complete",z.ERROR="error",z.prototype=Object.create(b.prototype),Object.addProperty(z.prototype,"pending",Object.ENUMERABLE,function(){return!!this.loading.length},null),Object.addProperty(z.prototype,"amount",Object.ENUMERABLE,function(){return this.assets.length},null),Object.addProperty(z.prototype,"loaded",Object.ENUMERABLE,function(){return this.assets.length-this.loading.length-this._errors},null),Object.addProperty(z.prototype,"progress",Object.ENUMERABLE,function(){return(this.assets.length-this.loading.length)/this.amount||0},null),z.prototype._errors=0,z.prototype.loading=null,z.prototype.assets=null,z.prototype.add=function(a){return this.assets.push(a),(a.status===s.INITIALIZED||a.status===s.LOADING)&&a.on(s.READY,this._onAssetReady).on(s.ERROR,this._onAssetError),this},z.prototype.remove=function(a){return this.assets.remove(a),a.off(s.READY,this._onAssetReady).off(s.ERROR,this._onAssetError),this},z.prototype.load=function(){for(var a=this.assets,b=0,c=a.length;c>b;b++){var d=a[b];switch(d.status){case s.INITIALIZED:case s.LOADING:this.loading.push(d)}}if(0!==this.progress&&this.trigger(z.PROGRESS,0),this._refresh(),!this.pending)return this;for(var b=0,c=a.length;c>b;b++){var d=a[b];d.status===s.INITIALIZED&&d.load()}return this},z.prototype._refresh=function(){this.trigger(z.PROGRESS,this.progress),this.loading.length||(this.trigger(z.COMPLETE,{readyCount:this.amount-this._errors,errorCount:this._errors}),this._errors||this.trigger(z.READY),this.assets.clear(),this._errors=0)},z.prototype._onAssetReady=function(a){return function(){var b=a.pending;a.loading.remove(this),b&&a._refresh()}},z.prototype._onAssetError=function(a){return function(b){var c=a.pending;a.loading.remove(this),a._errors++,c&&(a.trigger(z.ERROR,b),a._refresh())}},s.Group=A,A.prototype=Object.create(b.prototype),A.prototype.loader=null;var fb=s.Manager=Object.merge(new b,{_assets:{},_assetsGroups:{},_groupsAssets:{"":{}},groups:{"":new A},_getGroup:function(a){var b=fb.groups[a];return b},getById:function(a){return fb._assets[a]},createGroup:function(a){var b=new A;return fb.groups[a]=b,fb._groupsAssets[a]={},b},register:function(a,b,c){if(Object.isObject(a)){for(var d in a)fb.register(d,a[d],b);return fb}void 0===c&&(c=""),fb._assets[a]=b,fb._assetsGroups[a]=c,fb._groupsAssets[c][a]=!0;var e=fb._getGroup(c);return e.loader.add(b),fb},unregister:function(a){var b=fb._assets[a],c=fb._assetsGroups[a];delete fb._assets[a],delete fb._assetsGroups[a],delete fb._groupsAssets[c][a];var d=fb._getGroup(c);return d.loader.remove(b),fb},load:function(a){void 0===a&&(a="");var b=fb._getGroup(a);return b.loader.load(),fb},unload:function(a){void 0===a&&(a="");var b=fb._getGroup(a),c=b.loader,d=fb._groupsAssets[a];for(var e in d){var f=fb._assets[e];f.unload(),c.remove(f)}return fb}});Object.freeze(fb),fb.groups[""].on(z.PROGRESS,fb.trigger.bind(fb,z.PROGRESS)).on(z.READY,fb.trigger.bind(fb,z.READY)).on(z.COMPLETE,fb.trigger.bind(fb,z.COMPLETE)).on(z.ERROR,fb.trigger.bind(fb,z.ERROR)),ab.Font=B,B.cache={},B.prototype=Object.create(s.prototype),Object.addProperty(B.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,B),B.prototype.src="",ab.Node=C,C.elements={},C.getElementById=function(a){return this.elements[a]||null
},C.register=function(a,b){return a&&(this.elements[a]=b),C},C.unregister=function(a,b){return a&&this.elements[a]===b&&delete this.elements[a],C},C.LEFT="left",C.RIGHT="right",C.TOP="top",C.BOTTOM="bottom",C.CENTER="center",C.prototype=Object.create(b.prototype),C.prototype.constructor=C,C.prototype.parent=null,C.prototype.x=0,C.prototype.y=0,Object.addProperty(C.prototype,"scale",function(){if(this.scaleX===this.scaleY)return this.scaleX;throw new e("Engine.Node::scale: scaleX and scaleY are different")},function(a){this.scaleX=a,this.scaleY=a}),C.prototype.scaleX=1,C.prototype.scaleY=1,C.prototype.rotation=0,C.prototype.width=0,C.prototype.height=0,C.prototype.opacity=1,C.prototype.clip=!1,Object.defineProperty(C.prototype,"originX",{enumerable:!0,get:function(){switch(this._originX){case C.LEFT:return-this.width/2;case C.CENTER:return 0;case C.RIGHT:return this.width/2;default:return this._originX}},set:function(a){this._originX=a}}),C.prototype._originX=C.CENTER,Object.defineProperty(C.prototype,"originY",{enumerable:!0,get:function(){switch(this._originY){case C.TOP:return-this.height/2;case C.CENTER:return 0;case C.BOTTOM:return this.height/2;default:return this._originY}},set:function(a){this._originY=a}}),C.prototype._originY=C.CENTER,C.prototype.transform=void 0,C.prototype.zIndex=0,Object.defineProperty(C.prototype,"root",{enumerable:!0,get:function(){for(var a=this;a.parent;)a=a.parent;return a}}),Object.defineProperty(C.prototype,"next",{enumerable:!0,get:function(){var a=this.parent;if(a){var b=a.children;return b[b.indexOf(this)+1]||null}return null}}),Object.defineProperty(C.prototype,"prev",{enumerable:!0,get:function(){var a=this.parent;if(a){var b=a.children;return b[b.indexOf(this)-1]||null}return null}}),Object.defineProperty(C.prototype,"index",{enumerable:!0,get:function(){return this.parent?this.parent.children.indexOf(this):0}}),Object.defineProperty(C.prototype,"id",{enumerable:!0,set:function(a){C.unregister(this.id,this),this._id=a,C.register(a,this)},get:function(){return this._id||""}}),Object.defineProperty(C.prototype,"name",{enumerable:!0,set:function(a){var b=this.parent,c=this.name;b&&c&&b[c]===this&&delete b[c],this._name=a,b&&a&&!b.hasOwnProperty(a)&&(b[a]=this)},get:function(){return this._name||""}}),C.prototype.getPosition=function(a){return a=a||Math.Vector2d.create(),Math.Vector2d.call(a,this.x,this.y),a},C.prototype.setPosition=function(a){return this.x=a.x,this.y=a.y,a},C.prototype.getOrigin=function(a){return a=a||Math.Vector2d.create(),Math.Vector2d.call(a,this.originX,this.originY),a},C.prototype.setOrigin=function(a){return this.originX=a.x,this.originY=a.y,a},C.prototype.getGlobalMatrix=function(){for(var a=this,b=Math.Matrix33(1,0,0,0,1,0,0,0,1);a;){var c=a.transform;if(c)b.multiply(c);else{var d=a.originX,e=a.originY,f=a.rotation,g=a.scaleX,h=a.scaleY,i=a.x,j=a.y;b.translate(-d,-e).rotate(f).scale(g,h).translate(d+i,e+j)}a=a.parent}return b},C.prototype.getLocalMatrix=function(){if(this.transform)return this.transform.clone();var a=this,b=Math.Matrix33(1,0,0,0,1,0,0,0,1),c=a.originX,d=a.originY,e=a.rotation,f=a.scaleX,g=a.scaleY,h=a.x,i=a.y;return b.translate(-c,-d).rotate(e).scale(f,g).translate(c+h,d+i),b},C.prototype.appendChild=function(a,b){var c=this.children;return b=void 0===b?c.length:b,a.parent===this?this:(a.parent&&a.parent.removeChild(a),c.splice(b,0,a),a.parent=this,a.name&&!this.hasOwnProperty(a.name)&&(this[a.name]=a),this)},C.prototype.removeChild=function(a){return a.parent!==this?this:(this.children.remove(a),a.parent=null,this[a.name]===a&&delete this[a.name],this)},C.prototype.destroy=function(){return C.unregister(this.id,this),this.parent&&this.parent.removeChild(this),this.destroyChildren(),Array.free(this.children),b.prototype.destroy.call(this),this},C.prototype.destroyChildren=function(){for(var a=this.children,b=a.length;b-->0;)a[b].destroy();return this},C.prototype.captureByBoundingBox=function(a,b){return l.overlap(0,0,this.width,this.height,a,b,1,1)},C.prototype.captureByShape=C.prototype.captureByBoundingBox,C.prototype.captureByPixel=function(){return!1},C.prototype.getLocalBoundingBox=function(a){return a=a||l.create(),l.call(a,0,0,this.width,this.height),a},C.prototype.getGlobalBoundingBox=function(a){a=this.getLocalBoundingBox(a);var b=this.getGlobalMatrix(),c=C.toBoundingBox(a.x,a.y,a.x+a.w,a.y+a.h,b,a);return b.destroy(),c},C.toBoundingBox=function(a,b,c,d,e,f){var g=Math.Vector2d(0,0),h=0,i=0,j=0,k=0;return f=f||l.create(),g.x=a,g.y=b,g.multiply(e),h=i=g.x,j=k=g.y,g.x=c,g.y=b,g.multiply(e),h=h<g.x?h:g.x,i=i>g.x?i:g.x,j=j<g.y?j:g.y,k=k>g.y?k:g.y,g.x=a,g.y=d,g.multiply(e),h=h<g.x?h:g.x,i=i>g.x?i:g.x,j=j<g.y?j:g.y,k=k>g.y?k:g.y,g.x=c,g.y=d,g.multiply(e),h=h<g.x?h:g.x,i=i>g.x?i:g.x,j=j<g.y?j:g.y,k=k>g.y?k:g.y,l.call(f,h,j,i-h,k-j),Math.Vector2d.free(g),f},ab.Scene=ab.Node.Scene=D,D.prototype=Object.create(C.prototype),D.prototype.constructor=D,Object.addProperty(D.prototype,"color",Object.ENUMERABLE,function(){return this._color},function(a){"string"==typeof a&&(a=fb.getById(a)||t(a)),this._color=a||null}),D.prototype.search=function(a,b,c){return c=c||[],D.searchRecursive(this,a,b,c)},D.searchRecursive=function(a,b,c,d){for(var e=a.children,f=0,g=e.length;g>f;f++){var h=e[f],i=h.getGlobalBoundingBox();!i.overlap(b)||c&&!c(h)||d.push(h),l.free(i)}return d},D.prototype.captureByBoundingBox=function(){return null},D.prototype.captureByShape=function(){return null},D.prototype.captureByPixel=function(){return null},ab.Shape=E,E.prototype=Object.create(C.prototype),E.prototype.constructor=E,Object.addProperty(E.prototype,"color",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._color},function(a){"string"==typeof a&&(a=fb.getById(a)||t(a)),this._color=a||null}),Object.addProperty(E.prototype,"image",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._image},function(a){"string"==typeof a&&(a=fb.getById(a)||v(a)),a&&a.status===s.INITIALIZED&&a.load(),this._image=a||null}),Object.addProperty(E.prototype,"gradient",Object.ENUMERABLE,function(){return this._gradient},function(a){if("string"==typeof a){var b=a;if(a=fb.getById(b),!a)throw new i('Gradient "{}" not found in Engine.Asset.Manager'.format(b))}this._gradient=a||null}),Object.addProperty(E.prototype,"stroke",Object.ENUMERABLE,function(){return this._stroke},function(a){"string"==typeof a&&(a=fb.getById(a)||t(a)),this._stroke=a||null}),ab.Rectangle=ab.Shape.Rectangle=F,F.prototype=Object.create(E.prototype),F.prototype.constructor=F,F.prototype.getLocalBoundingBox=function(a){a=a||l.create();var b=this.width,c=this.height;return l.call(a,-b/2,-c/2,b,c),a},F.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=l.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return l.free(c),d},F.prototype.captureByShape=F.prototype.captureByBoundingBox,ab.Polygon=ab.Shape.Polygon=G,G.prototype=Object.create(E.prototype),G.prototype.constructor=G,G.isPointInside=function(a,b,c){var d=a.points;if(d.length<3)return!1;var e=0,f=d.last(),g=d.first();G.isCrossing(b,c,f[0],f[1],g[0],g[1])&&e++;for(var h=d.length,i=1;h>i;i++)f=d[i-1],g=d[i],G.isCrossing(b,c,f[0],f[1],g[0],g[1])&&e++;return!!(e%2)},G.isCrossing=function(a,b,c,d,e,f){var g=(f-d)/(e-c),h=d-g*c,i=(b-h)/g;return a>i&&i>=Math.min(c,e)&&i<=Math.max(c,e)},G.prototype.points=null,G.prototype.getLocalBoundingBox=function(a){a=a||l.create();var b=0,c=0,d=0,e=0,f=this.points;if(f){var g=f[0];b=g[0],d=g[1],c=g[0],e=g[1];for(var h=1,i=f.length;i>h;h++){var g=f[h],j=g[0],k=g[1];b=b>j?j:b,d=d>k?k:d,c=j>c?j:c,e=k>e?k:e}}return l.call(a,b,d,c-b,e-d),a},G.prototype.captureByShape=function(a,b){return G.isPointInside(this,a,b)},G.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=l.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return l.free(c),d},ab.Oval=ab.Shape.Oval=H,H.prototype=Object.create(E.prototype),H.prototype.constructor=H,Object.defineProperty(H.prototype,"radiusX",{set:function(a){this.width=2*a},get:function(){return this.width/2}}),Object.defineProperty(H.prototype,"radiusY",{set:function(a){this.height=2*a},get:function(){return this.height/2}}),Object.defineProperty(H.prototype,"radius",{set:function(a){var b=2*a;this.width=b,this.height=b}}),H.prototype.getLocalBoundingBox=function(a){a=a||l.create();var b=this.radiusX,c=this.radiusY;return l.call(a,-b,-c,2*b,2*c),a},H.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=l.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return l.free(c),d},H.prototype.captureByShape=function(a,b){var c=this.radiusX,d=this.radiusY;return Math.pow(a,2)/Math.pow(c,2)+Math.pow(b,2)/Math.pow(d,2)<=1},ab.Text=ab.Shape.Text=I,I.prototype=Object.create(E.prototype),I.prototype.constructor=I,I.AUTO=void 0,I.ALIGN=[I.LEFT="left",I.RIGHT="right",I.CENTER="center",I.JUSTIFY="justify",I.PRE="pre"],I.COLOR="black",I.READY="ready",Object.addProperty(I.prototype,"_font",Object.WRITABLE,null),Object.addProperty(I.prototype,"font",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._font},function(a){"string"==typeof a&&(a=fb.getById(a)||B(a)),a&&a.status===s.INITIALIZED&&a.load(),this._font=a||null}),I.prototype.fontSize=20,Object.addProperty(I.prototype,"_textColor",Object.WRITABLE,"black"),Object.addProperty(I.prototype,"textColor",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._textColor},function(a){"string"==typeof a&&(a=fb.getById(a)||t(a)),this._textColor=a||null}),Object.addProperty(I.prototype,"_textStroke",Object.WRITABLE,"black"),Object.addProperty(I.prototype,"textStroke",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._textStroke},function(a){"string"==typeof a&&(a=fb.getById(a)||t(a)),this._textStroke=a||null}),Object.addProperty(I.prototype,"_textStrokeWidth",Object.WRITABLE,0),Object.addProperty(I.prototype,"textStrokeWidth",Object.ENUMERABLE|Object.CONFIGURABLE,function(){return this._textStrokeWidth},function(a){this._textStrokeWidth=a}),I.prototype.text="",I.prototype.spacing=0,I.prototype.lineHeight=I.AUTO,I.prototype.textAlign=I.LEFT,I.prototype.paddingLeft=0,I.prototype.paddingRight=0,I.prototype.paddingTop=0,I.prototype.paddingBottom=0,Object.addProperty(I.prototype,"padding",null,function(a){this.paddingLeft=a,this.paddingRight=a,this.paddingTop=a,this.paddingBottom=a}),ab.Sprite=J,J.prototype=Object.create(E.prototype),J.prototype.constructor=J,J.prototype.ix=0,J.prototype.iy=0,Object.addProperty(J.prototype,"frames",function(){var a=this.image,b=this.width;return a&&a.status===s.READY&&b?a.width/b:0},null),Object.addProperty(J.prototype,"rows",function(){var a=this.image,b=this.height;return a&&a.status===s.READY&&b?a.height/b:0},null),J.prototype.getLocalBoundingBox=function(a){a=a||l.create();var b=this.width,c=this.height;return l.call(a,-b/2,-c/2,b,c),a},J.prototype.captureByBoundingBox=function(a,b){var c=this.getLocalBoundingBox(),d=l.overlap(c.x,c.y,c.w,c.h,a,b,1,1);return l.free(c),d},J.prototype.captureByShape=J.prototype.captureByBoundingBox,ab.Bitmap=K,K.prototype=Object.create(C.prototype),K.prototype.constructor=K,K.prototype.getPixel=function(a,b){return ab.Renderer.Bitmap.getPixel(this,a,b)},K.prototype.setPixel=function(a,b,c){return c=c instanceof t?c:t(c),ab.Renderer.Bitmap.setPixel(this,a,b,c),c},K.prototype.clear=function(){return ab.Renderer.Bitmap.clear(this),this},K.prototype.drawNode=function(a,b,c){return ab.Renderer.Bitmap.drawNode(this,a,b,c),this},K.prototype.getLocalBoundingBox=F.prototype.getLocalBoundingBox,K.prototype.captureByBoundingBox=F.prototype.captureByBoundingBox,K.prototype.captureByShape=F.prototype.captureByBoundingBox,ab.Viewport=L,L.stack=[],L.prototype=Object.create(b.prototype),L.prototype.constructor=L,L.prototype.id="",L.prototype.width=0,L.prototype.height=0,Object.defineProperty(L.prototype,"fill",{configurable:!0,get:function(){return this._fill},set:function(a){this._fill=a,a&&kb&&(this.width=kb.getMaxWidth(),this.height=kb.getMaxHeight())}}),Object.addProperty(L.prototype,"_fill",Object.WRITABLE,!0),L.prototype.addCamera=function(a){return a.parent===this?!1:(a.parent&&a.parent.removeCamera(a),this.cameras.add(a),a.parent=this,!0)},L.prototype.removeCamera=function(a){return a.parent!==this?!1:(this.cameras.remove(a),a.parent=null,!0)},L.prototype.getCameraByPixel=function(a,b,c){var d=null;if("number"!=typeof a||"number"!=typeof b)return d;c=Array.isArray(c)?c:null;for(var e=l(a,b,1,1),f=l(0,0,0,0),g=this.cameras,h=g.length;h--;){var i=g[h];if((!c||!c.has(i))&&(f.reset(i.left,i.top,i.width,i.height),e.overlap(f))){d=i;break}}return e.destroy(),f.destroy(),d},L.prototype.destroy=function(){L.stack.remove(this);for(var a=this.cameras,c=a.length;c-->0;)this.removeCamera(a[c]);b.prototype.destroy.call(this)},ab.Camera=M,M.prototype=Object.create(b.prototype),M.prototype.constructor=M,M.prototype.volume=1,M.prototype.lookingAt=null,M.prototype.x=0,M.prototype.y=0,M.prototype.zoom=1,M.prototype.parent=null,M.isPercent=function(a){return"string"==typeof a&&"%"===a[a.length-1]},M.percentToInt=function(a){return+a.slice(0,-1)},Object.defineProperty(M.prototype,"left",{configurable:!0,get:function(){var a=this._left;if(!M.isPercent(a))return a;var b=this.parent;return b?M.percentToInt(a)/100*b.width:0},set:function(a){this._left=a}}),Object.defineProperty(M.prototype,"_left",{enumerable:!1,writable:!0,value:"0%"}),Object.defineProperty(M.prototype,"top",{configurable:!0,get:function(){var a=this._top;if(!M.isPercent(a))return a;var b=this.parent;return b?M.percentToInt(a)/100*b.height:0},set:function(a){this._top=a}}),Object.defineProperty(M.prototype,"_top",{enumerable:!1,writable:!0,value:"0%"}),Object.defineProperty(M.prototype,"width",{configurable:!0,get:function(){var a=this._width;if(!M.isPercent(a))return a;var b=this.parent;return b?M.percentToInt(a)/100*b.width:0},set:function(a){this._width=a}}),Object.defineProperty(M.prototype,"_width",{enumerable:!1,writable:!0,value:"100%"}),Object.defineProperty(M.prototype,"height",{configurable:!0,get:function(){var a=this._height;if(!M.isPercent(a))return a;var b=this.parent;return b?M.percentToInt(a)/100*b.height:0},set:function(a){this._height=a}}),Object.defineProperty(M.prototype,"_height",{enumerable:!1,writable:!0,value:"100%"}),M.prototype.projectX=function(a){return(a-this.x)*this.zoom+this.width/2},M.prototype.projectY=function(a){return(a-this.y)*this.zoom+this.height/2},M.prototype.toSceneX=function(a){return a-=this.width/2,a/this.zoom+this.x},M.prototype.toSceneY=function(a){return a-=this.height/2,a/this.zoom+this.y},M.prototype.getView=function(a){a=a||l.create();var b=this.width/this.zoom,c=this.height/this.zoom,d=this.x-b/2,e=this.y-c/2;return l.call(a,d,e,b,c),a},ab.Renderer=new b,ab.Renderer.Bitmap={setPixel:function(){throw new j("Engine.Renderer.Bitmap.setPixel is not implemented.")},getPixel:function(){throw new j("Engine.Renderer.Bitmap.getPixel is not implemented.")},clear:function(){throw new j("Engine.Renderer.Bitmap.clear is not implemented.")},drawNode:function(){throw new j("Engine.Renderer.Bitmap.drawNode is not implemented.")}};var gb=ab.Renderer;gb.createContext=function(){var a=document.createElement("canvas").getContext("2d");return a.canvas.width=0,a.canvas.height=0,a},gb.ctx=gb.createContext(),gb.ID=0,gb.renderViewport=function(a){var b=a.ctx,c=a._dom;(a.width!==a._cachedWidth||a.height!==a._cachedHeight)&&(a._cachedWidth=a.width,a._cachedHeight=a.height,c.width=a.width,c.height=a.height),b.clearRect(0,0,a.width,a.height);for(var d=a.cameras,e=0,f=d.length;f>e;e++)gb.renderCamera(b,d[e])},gb.renderCamera=function(a,b){var c=b.lookingAt;if(!c)return this;{var d=b.left,e=b.top,f=b.x,g=b.y,h=b.width,i=b.height,j=b.zoom;a.canvas}return a.save(),a.translate(d,e),a.beginPath(),a.rect(0,0,h,i),a.closePath(),a.clip(),c.color&&(a.fillStyle=c.color.index,a.fillRect(0,0,h,i)),a.save(),a.scale(j,j),a.translate(-f+h/2/j,-g+i/2/j),gb.renderNode(a,c),a.restore(),a.restore(),this},gb.renderNode=function(a,b){a.save(),b.render(a),b.clip&&b.addMask(a),b._sort&&(b._renderStack.sort(C._renderSort),b._sort=!1);for(var c=0,d=b._renderStack,e=d.length;e>c;c++)gb.renderNode(a,d[c]);return a.restore(),this},gb.renderDirty=function(a,b,c,d,e){var f=255*Math.random()|0,g=255*Math.random()|0,h=255*Math.random()|0,i=.2;return a.fillStyle="rgba("+f+","+g+","+h+","+i+")",a.fillRect(b,c,d,e),this},gb.reflow=function(){gb.ID=0;var a=L.stack;gb.trigger("reflow");for(var b=0,c=a.length;c>b;b++)gb.renderViewport(a[b]);gb.trigger("reflowed"),gb.start()},gb.stop=function(){this.ID&&(ib(this.ID),this.ID=0)},gb.start=function(){this.ID=this.ID||hb(gb.reflow)};var hb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,17)},ib=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return clearTimeout(a)};gb.requestAnimationFrame=function(a){return hb(a)},gb.cancelAnimationFrame=function(a){return ib(a)},gb.Image=new b,gb.Image.cache={},gb.Image.LOAD="load",gb.Image.ERROR="error",gb.Image.get=function(a,b,c){var d=this.cache[a];return d||(d=new window.Image,d.setAttribute("src",a),this.set(a,d)),this.isImageReady(d)?b&&b.call(d):this.isImageFault(d)?c&&c.call(this):(d.addEventListener("load",b),d.addEventListener("error",c)),d},gb.Image._onLoad=function(){gb.Image.validate(this),gb.Image.trigger(gb.Image.LOAD,this)},gb.Image._onError=function(){gb.Image.validate(this),gb.Image.trigger(gb.Image.ERROR,this)},gb.Image.validate=function(a){a.width&&a.height?(a.ready=!0,a.fault=!1):"complete"in a&&!a.complete||(a.ready=!1,a.fault=!0)},gb.Image.set=function(a,b){return this.cache[a]=b,b.ready=!1,b.fault=!1,b.addEventListener("load",this._onLoad),b.addEventListener("error",this._onError),this.validate(b),this.isImageReady(b)?this.trigger(this.LOAD,b):this.isImageFault(b)&&this.trigger(this.ERROR,b),b},gb.Image.isReady=function(a){return this.isImageReady(this.cache[a])},gb.Image.isImageReady=function(a){return!(!a||!a.ready)},gb.Image.isFault=function(a){return this.isImageFault(this.cache[a])},gb.Image.isImageFault=function(a){return!(!a||!a.fault)},gb.Pattern={},gb.Pattern.cache={},gb.Pattern.REPEAT="repeat",gb.Pattern.get=function(a){var b=this.cache;return b[a]=b[a]||this.create(a,this.REPEAT)},gb.Pattern.create=function(a,b){return gb.ctx.createPattern(gb.Image.get(a),b||this.REPEAT)},gb.Gradient={},gb.Gradient.cache={},gb.Gradient.get=function(a,b,c,d){var e=u.toIndex(a,b,c,d);return this.cache[e]=this.cache[e]||this.create(a,b,c,d)},gb.Gradient.getByIndex=function(a){return this.cache[a]||null},gb.Gradient.create=function(a,b,c,d){var e=null;if("linear"===a)e=gb.ctx.createLinearGradient(b[0],b[1],c[0],c[1]);else{if("radial"!==a)return null;e=gb.ctx.createRadialGradient(b[0],b[1],b[2],c[0],c[1],c[2])}for(var f in d)e.addColorStop(f,d[f]);return e};var jb=gb.Text={pageWidth:256,pageHeight:256,pageGlyphPadding:2};jb.Cache={},jb.get=function(a){return jb.Cache[a]||null},jb.set=function(a,b){jb.Cache[a]=b},jb.unset=function(a){delete jb.Cache[a]},jb.load=function(a,b,c){var d=jb.get(a);return d?b&&b(d):opentype.load(a,function(d,e){return d?c&&c(d):(jb.set(a,e),b&&b(e))}),this},jb.unload=function(a){jb.unset(a)},jb.AngelCode={fromOpenType:function(b,c){c=c||{};var d=c.fontSize,e=c.pageWidth,f=c.pageHeight,g=c.filter,h=c.ctx||gb.createContext(),i=c.fill,j=c.stroke,k=c.strokeWidth||0,n=c.padding||k,o=d/b.unitsPerEm,p={info:{face:b.familyName,size:d,bold:0,italic:0,charset:"",unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[1,1],outline:0},common:{lineHeight:d,base:d,scaleW:e,scaleH:f,pages:0,packed:0,alphaChnl:0,redChnl:3,greenChnl:3,blueChnl:3},page:{},"char":{},kerning:{}},o=d/b.unitsPerEm;for(var q in b.kerningPairs){var r=Math.round(b.kerningPairs[q]*o);r&&(p.kerning[q]=r)}for(var s=g?b.glyphs.filter(g):b.glyphs,t=[m.factory(e,f)],u=[],v=[u],w=0;w<s.length;w++){var x=s[w],y=(x.xMax-x.xMin)*o+2*n,z=(x.yMax-x.yMin)*o+2*n,A=l.create();l.call(A,0,0,y,z),A.glyph=x;for(var B=0;B<t.length;B++){var C=t[B],u=v[B];if(C.pack(A)){u.push(A),p.char[x.unicode||x.name]={chnl:0,id:x.unicode,page:B,x:A.x,y:A.y,width:A.w,height:A.h,xadvance:x.advanceWidth*o,xoffset:-x.leftSideBearing*o,yoffset:d-x.yMax*o+n};break}if(B===t.length-1){if(C.width<A.w||C.height<A.h)throw new ReferenceError("Page size ("+e+"x"+f+') is too small for a glyph "'+x.name+'" ('+y+"x"+z+")");t.push(m.factory(e,f)),v.push([])}}}h=h||gb.createContext(),h.canvas.width=e,h.canvas.height=f,p.common.pages=v.length;for(var w=0;w<v.length;w++){var u=v[w];h.canvas.width=e;for(var B=0;B<u.length;B++){var A=u[B],x=A.glyph,D=-x.leftSideBearing*o+n,E=x.yMax*o+n;h.save(),h.strokeStyle=j,h.lineWidth=k,h.fillStyle=i,x.draw(h,A.x+D,A.y+E,d),h.restore()}var F=p.page[w]=new a.Image;F.src=h.canvas.toDataURL()}for(;t.length;)t.pop().destroy();return p},render:function(a,b,c,d,e,f,g){{var h=c.page,i=c.common;c.chars,c.kerning}g=g||0,f=void 0===f?i.lineHeight:f,e=e||I.LEFT;var j=0,k=d,l=1/0;if(e===I.PRE)var b=String(b),m=[b];else var b=String(b).trim().replace(jb.WORD_REGEX,jb.normalize),m=b.match(jb.WORD_REGEX)||[];for(var n=0,o=0,p=d,q=0,r=[],s=null,t=0;t<m.length;t++)switch(s=s||[],!0){case m[t]===jb.LN:n=0,o+=f,r.add(s),s=null;break;default:var u=new jb.Word(m[t],c,f,d,g),v=u.x,w=u.y,x=u.w,y=u.h;if(t>0&&n+v+x>k&&(r.add(s),s=[],n=0,o+=f),!s.length&&jb.WHITESPACE_REGEX.test(u.text))continue;u.ox=n,u.oy=o,s.push(u),q=Math.max(j,Math.min(Math.max(q,o+w+y),l)),n+=v+x,r.add(s)}e!==I.PRE&&jb.align(r,e,p),a.canvas.width=p,a.canvas.height=q;for(var z=0,A=r.length;A>z;z++)for(var s=r[z],B=0,C=s.length;C>B;B++)for(var u=s[B],D=u.ox,E=u.oy,F=0,G=u.length;G>F;F++){var H=u[F],J=h[H.page],K=D+H.dx,L=E+H.dy,M=H.sx,N=H.sy,O=H.sw,P=H.sh;O&&P&&J&&a.drawImage(J,M,N,O,P,K,L,O,P)}}},jb.LN="\n",jb.WORD_REGEX=/(\n|\s+|\S+)/g,jb.WHITESPACE_REGEX=/^\s+$/,jb.SPACE=" ",jb.SPACE_CODE=" ".charCodeAt(0),jb.normalize=function(a){return a===jb.LN?jb.LN:jb.WHITESPACE_REGEX.test(a)?jb.SPACE:a},jb.align=function(a,b,c){for(var d=0;d<a.length;d++){var e=this.trim(a[d]);if(e.length)switch(b){case I.RIGHT:for(var f=e.last(),g=c,h=g-(f.ox+f.x+f.w),i=0;i<e.length;i++)e[i].ox+=h;break;case I.CENTER:for(var f=e.last(),g=c,h=(g-(f.ox+f.x+f.w))/2,i=0;i<e.length;i++)e[i].ox+=h;break;case I.JUSTIFY:if(d===a.length-1)break;for(var f=e.last(),g=c,h=g-(f.ox+f.x+f.w),i=1;i<e.length;i++)e[i].ox+=parseInt(h*(i/(e.length-1)));break;case I.LEFT:}}},jb.trim=function(a){return a.length?(jb.WHITESPACE_REGEX.test(a.first().text)&&a.shift(),a.length?(jb.WHITESPACE_REGEX.test(a.last().text)&&a.pop(),a):a):a},jb.Word=function(a,b,c,d,e){this.ox=0,this.oy=0,this.length=0,this.text=a;var f=b.char,g=b.kerning,h=0,i=0,j=0,k=0,l=0,m=0,n=0;a=a.split("");for(var o=0,p=a.length;p>o;o++)switch(!0){case a[o]===jb.LN:l=0,m+=c,h=Math.min(l,h),i=Math.min(m,i),j=Math.max(j,l),k=Math.max(k,m+c);break;default:var q=a[o].charCodeAt(0),r=f[q]||f[jb.SPACE_CODE],s=r.x,t=r.y,u=r.width,v=r.height,w=r.xoffset,x=r.yoffset,y=r.xadvance,z=r.page,A=g&&g[[n,q]]||0;l+w+u>d?(l=w,m+=c):l+=w,h=Math.min(l,h),i=Math.min(m,i),j=Math.max(j,l+u),k=Math.max(k,m+x+v),Array.prototype.push.call(this,new jb.Character(l,m+x,s,t,u,v,z)),l+=y,l+=A,l+=e,n=q}this.x=h,this.y=i,this.w=j-h,this.h=k-i},jb.Character=function(a,b,c,d,e,f,g){this.dx=a,this.dy=b,this.sx=c,this.sy=d,this.sw=e,this.sh=f,this.page=g},gb.fillRect=function(a,b,c,d,e,f,g,h,i){return f&&(a.fillStyle=f.index,a.fillRect(b,c,d,e)),g&&(a.fillStyle=this.Gradient.getByIndex(g.index)||this.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(b,c,d,e)),h&&h._dom&&a.drawImage(h._dom,b,c,d,e),i&&(a.strokeStyle=i.index,a.strokeRect(b,c,d,e)),this},gb.maskRect=function(a,b,c,d,e){a.beginPath(),a.rect(b,c,d,e),a.closePath(),a.clip()},gb.fillSprite=function(a,b,c,d,e,f,g,h,i,j,k){return h&&(a.fillStyle=h.index,a.fillRect(b,c,d,e)),i&&(a.fillStyle=this.Gradient.getByIndex(i.index)||this.Gradient.get(i.type,i.from,i.to,i.stop),a.fillRect(b,c,d,e)),j&&j._dom&&a.drawImage(j._dom,f*d,g*e,d,e,b,c,d,e),k&&(a.strokeStyle=k.index,a.strokeRect(b,c,d,e)),this},gb.KAPPA=.5522848,gb.fillOval=function(a,b,c,d,e,f,g,h,i){a.save();var j=b-d,k=c-e,l=2*d,m=2*e,n=e/d;return a.beginPath(),a.scale(1,n),a.arc(b,c,d,0,2*Math.PI),a.closePath(),a.save(),a.clip(),a.scale(1,1/n),f&&(a.fillStyle=f.index,a.fillRect(j,k,l,m)),g&&(a.fillStyle=this.Gradient.getByIndex(g.index)||this.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(j,k,l,m)),h&&h._dom&&a.drawImage(h._dom,j,k,l,m),a.restore(),i&&(a.strokeStyle=i.index,a.stroke()),a.restore(),this},gb.maskOval=function(a,b,c,d,e){var f=e/d;a.beginPath(),a.scale(1,f),a.arc(b,c,d,0,2*Math.PI),a.closePath(),a.clip(),a.scale(1,1/f)},gb.fillPolygon=function(a,b,c,d,e,f){if(!b||b.length<2)return this;a.save(),a.beginPath();var g=b[0],h=g[0],i=g[1],j=h,k=h,l=i,m=i,n=0,o=0;a.moveTo(h,i);for(var p=1,q=b.length;q>p;p++)g=b[p],h=g[0],i=g[1],j=j>h?h:j,l=l>i?i:l,k=h>k?h:k,m=i>m?i:m,a.lineTo(h,i);return g=b[0],a.lineTo(g[0],g[1]),a.closePath(),a.save(),a.clip(),h=j,i=l,n=k-j,o=m-l,c&&(a.fillStyle=c.index,a.fillRect(h,i,n,o)),d&&(a.fillStyle=this.Gradient.getByIndex(d.index)||this.Gradient.get(d.type,d.from,d.to,d.stop),a.fillRect(h,i,n,o)),e&&e._dom&&a.drawImage(e._dom,h,i,n,o),a.restore(),f&&(a.strokeStyle=f.index,a.stroke()),a.restore(),this},gb.maskPolygon=function(a,b){if(!b||b.length<2)return this;a.beginPath();var c=b[0],d=c[0],e=c[1],f=d,g=d,h=e,i=e;a.moveTo(d,e);for(var j=1,k=b.length;k>j;j++)c=b[j],d=c[0],e=c[1],f=f>d?d:f,h=h>e?e:h,g=d>g?d:g,i=e>i?e:i,a.lineTo(d,e);return c=b[0],a.lineTo(c[0],c[1]),a.closePath(),a.clip(),this},gb.Bitmap.setPixel=function(a,b,c,d){var e=this._getImageData(a),f=4*(c*a.width+b),g=e.data;return g[f++]=d.r,g[f++]=d.g,g[f++]=d.b,g[f]=255*d.a,a._dirty=!0,d},gb.Bitmap.getPixel=function(a,b,c){var d=this._getImageData(a),e=4*(c*a.width+b),f=d.data;return t(f[e++],f[e++],f[e++],f[e]/255)},gb.Bitmap.clear=function(a){var b=a._cache;b.width=this.width,b.height=this.height,a._imageData=null},gb.Bitmap._getImageData=function(a){var b=a.width,c=a.height,d=a._cacheCtx,e=a._imageData||d.getImageData(0,0,b,c);return(a.width!==e.width||a.height!==e.height)&&this._resize(a,e.width,e.height,b,c),a._imageData=e},gb.Bitmap._resize=function(a,b,c,d,e){var f=a._cacheCtx,g=f.canvas,h=b&&c?f.getImageData(0,0,b,c):null;g.width=d,g.height=e,h&&f.putImageData(h,0,0),a._imageData=f.getImageData(0,0,d,e)},gb.Bitmap.drawNode=function(a,b,c,d){var e=a._cacheCtx,f=e.canvas,g=f.width,h=f.height;(g!==a.width||h!==a.height)&&this._resize(a,g,h,a.width,a.height),e.save(),e.translate(b,c),gb.renderNode(e,d),e.restore(),a._imageData=e.getImageData(0,0,a.width,a.height)},Object.addProperty(L.prototype,"_cachedWidth",Object.WRITABLE,0),Object.addProperty(L.prototype,"_cachedHeight",Object.WRITABLE,0),Object.defineProperty(L.prototype,"_dom",{get:function(){var a=document.getElementById(this.id)||document.createElement("canvas");return Object.addProperty(this,"_dom",a),a}}),Object.defineProperty(L.prototype,"ctx",{get:function(){var a=this._dom,b=a.getContext("2d");return Object.addProperty(this,"ctx",b),b}}),window.addEventListener("resize",function(){for(var a=L.stack,b=0,c=a.length;c>b;b++){var d=a[b];d.fill&&(d.width=kb.getMaxWidth(),d.height=kb.getMaxHeight())}});var kb={getMaxWidth:function(){return innerWidth},getMaxHeight:function(){return innerHeight}};C.prototype.render=function(a){var b=this.transform;if(a.globalAlpha*=this.opacity,b)return a.transform(b.m11,b.m12,b.m21,b.m22,b.m31,b.m32);var c=this.originX,d=this.originY,e=this.rotation,e=this.rotation,f=this.scaleX,g=this.scaleY,h=this.x,i=this.y;a.translate(h+c,i+d),a.rotate(-e),a.scale(f,g),a.translate(-c,-d)},C.prototype.addMask=function(a){gb.maskRect(a,0,0,this.width,this.height)},Object.addProperty(C.prototype,"_sort",Object.WRITABLE,!1),C._renderSort=function(a,b){return a._zIndex-b._zIndex||a.index-b.index},Object.addProperty(C.prototype,"_zIndex",Object.WRITABLE,0),Object.defineProperty(C.prototype,"zIndex",{set:function(a){this._zIndex=a,this._parent&&(this._parent._sort=!0)},get:function(){return this._zIndex}}),Object.defineProperty(C.prototype,"_renderStack",{get:function(){var a=[];return Object.addProperty(this,"_renderStack",Object.CONFIGURABLE|Object.ENUMERABLE|Object.WRITABLE,a),a}}),Object.addProperty(C.prototype,"_parent",Object.WRITABLE,null),Object.defineProperty(C.prototype,"parent",{set:function(a){var b=this._parent;b&&b._renderStack.remove(this),this._parent=a,a&&(a._renderStack.add(this),a._sort=!0)},get:function(){return this._parent}}),D.prototype.captureByBoundingBox=function(a,b,c){var d=Math.Matrix.I(3),e=D._captureByBoundingBox(this,a,b,c,d);return Math.Matrix33.free(d),e},D.prototype.captureByShape=function(a,b,c){var d=Math.Matrix.I(3),e=D._captureByShape(this,a,b,c,d);return Math.Matrix33.free(d),e},D.prototype.captureByPixel=function(a,b,c){var d=gb.ctx;d.canvas.width=1,d.canvas.height=1,d.save(),d.setTransform(1,0,0,1,-a,-b);var e=D._captureByPixel(d,this,c);return d.restore(),e},D._captureByBoundingBox=function(a,b,c,d,e){for(var f=a._renderStack,g=f.length;g--;){var h=f[g],i=h.getLocalMatrix().multiply(e),j=i.clone().inverse(),k=Math.Vector2d(b,c).multiply(j),l=D._captureByBoundingBox(h,b,c,d,i);if(l||d&&!d(h)||!h.captureByBoundingBox(k.x,k.y)||(l=h),Math.Matrix33.free(i),Math.Matrix33.free(j),Math.Vector2d.free(k),l)return l}return null},D._captureByShape=function(a,b,c,d,e){for(var f=a._renderStack,g=f.length;g--;){var h=f[g],i=h.getLocalMatrix().multiply(e),j=i.clone().inverse(),k=Math.Vector2d(b,c).multiply(j),l=D._captureByShape(h,b,c,d,i);if(l||d&&!d(h)||!h.captureByShape(k.x,k.y)||(l=h),Math.Matrix33.free(i),Math.Matrix33.free(j),Math.Vector2d.free(k),l)return l}return null},D._captureByPixel=function(a,b,c){for(var d=b._renderStack,e=d.length;e--;){var f=d[e];a.save(),f.render(a);var g=D._captureByPixel(a,f);if(g||c&&!c(f)||!a.getImageData(0,0,1,1).data[3]||(g=f),a.restore(),g)return g}return null},Object.addProperty(K.prototype,"_cache",function(){var a=this._cacheCtx.canvas;return Object.addProperty(this,"_cache",Object.WRITABLE,a),a},null),Object.addProperty(K.prototype,"_cacheCtx",function(){var a=gb.createContext();return Object.addProperty(this,"_cacheCtx",Object.WRITABLE,a),a},null),K.prototype._dirty=!1,K.prototype._imageData=null,K.prototype.render=function(a){C.prototype.render.call(this,a);var b=this.width,c=this.height,d=this._cache;if(this._dirty){var e=this._cacheCtx;d.width=b,d.height=c,e.putImageData(this._imageData,0,0),this._dirty=!1}a.drawImage(d,-b/2,-c/2)},K.prototype.addMask=function(a){var b=this.width,c=this.height;gb.maskRect(a,-b/2,-c/2,b,c)},F.prototype.render=function(a){C.prototype.render.call(this,a);var b=this.width,c=this.height,d=-b/2,e=-c/2;gb.fillRect(a,d,e,b,c,this.color,this.gradient,this.image,this.stroke)},F.prototype.addMask=function(a){var b=this.width,c=this.height;gb.maskRect(a,-b/2,-c/2,b,c)},G.prototype.render=function(a){C.prototype.render.call(this,a),gb.fillPolygon(a,this.points,this.color,this.gradient,this.image,this.stroke)},G.prototype.addMask=function(a){gb.maskPolygon(a,this.points)},H.prototype.render=function(a){C.prototype.render.call(this,a);var b=this.radiusX,c=this.radiusY;gb.fillOval(a,0,0,b,c,this.color,this.gradient,this.image,this.stroke)},H.prototype.addMask=function(a){gb.maskOval(a,0,0,this.radiusX,this.radiusY)},I.prototype.render=function(a){if(C.prototype.render.call(this,a),!this._isDirty||this.renderBuffer()){var b=0,c=0,d=this.width,e=this.height,f=this.color;f&&(a.fillStyle=f.index,a.fillRect(b,c,d,e));var g=this.gradient;g&&(a.fillStyle=gb.Gradient.getByIndex(g.index)||gb.Gradient.get(g.type,g.from,g.to,g.stop),a.fillRect(b,c,d,e));var h=this.image;h&&h.status===s.READY&&a.drawImage(h._dom,b,c,d,e),a.drawImage(this._buffer.canvas,this.paddingLeft,this.paddingTop);var i=this.stroke;i&&(a.strokeStyle=i.index,a.strokeRect(b,c,d,e))}},I.prototype.addMask=function(a){var b=this.width,c=this.height;
gb.maskRect(a,0,0,b,c)},I.prototype.renderBuffer=function(){var a=this.font;if(!this._isDirty||!a||a.status!==s.READY)return!1;var b=this._buffer,c=(b.canvas,this.text),d=a.src,e=jb.get(d),f=this.textColor?this.textColor.index:null,g=this.textStroke?this.textStroke.index:null,h=this.textStrokeWidth?this.textStrokeWidth:0,i=jb.AngelCode.fromOpenType(e,{fontSize:this.fontSize,pageWidth:jb.pageWidth,pageHeight:jb.pageHeight,fill:f,stroke:g,strokeWidth:h,padding:jb.pageGlyphPadding,filter:function(a){for(var b=0;b<c.length;b++)if(e.charToGlyph(c[b])===a)return!0;return!1}}),j=this.width-this.paddingLeft-this.paddingRight,k=this.textAlign,l=this.lineHeight,m=this.spacing;return jb.AngelCode.render(b,c,i,j,k,l,m),this.height=b.canvas.height+this.paddingTop+this.paddingBottom,this._isDirty=!1,!0},I.prototype._isDirty=!1,Object.addProperty(I.prototype,"_buffer",function(){var a=gb.createContext();return Object.addProperty(this,"_buffer",Object.WRITABLE,a),a},null),["textColor","font"].forEach(function(a){var b=Object.getOwnPropertyDescriptor(I.prototype,a),c=b.get,d=b.set;Object.addProperty(I.prototype,a,Object.ENUMERABLE,c,function(a){d.call(this,a),this._isDirty=!0})}),["width","height","fontSize","text","spacing","lineHeight","textAlign","paddingLeft","paddingRight","paddingTop","paddingBottom"].forEach(function(a){var b="_"+a;Object.addProperty(I.prototype,b,Object.WRITABLE,I.prototype[a]),Object.addProperty(I.prototype,a,Object.ENUMERABLE,function(){return this[b]},function(a){this[b]=a,this._isDirty=!0})}),J.prototype.render=function(a){C.prototype.render.call(this,a);var b=this.width,c=this.height,d=-b/2,e=-c/2,f=this.ix,g=this.iy;gb.fillSprite(a,d,e,b,c,f,g,this.color,this.gradient,this.image,this.stroke)},J.prototype.addMask=function(a){var b=this.width,c=this.height;gb.maskRect(a,-b/2,-c/2,b,c)},v.prototype.load=function(){s.prototype.load.call(this);var a=this;return gb.Image.get(this.src,function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,this),a.width=this.width,a.height=this.height,a.status=s.READY},function(){Object.addProperty(a,"_dom",Object.CONFIGURABLE|Object.WRITABLE,null),a.width=0,a.height=0,a.status=s.ERROR}),this},v.prototype.unload=function(){return this.status!==s.READY?this:(s.prototype.unload.call(this),delete this._dom,this.width=0,this.height=0,this)},B.prototype.load=function(){if(this.status!==s.INITIALIZED)return this;var a=this;return gb.Text.load(this.src,function(){a.status=s.READY},function(){a.status=s.ERROR}),this},B.prototype.unload=function(){gb.Text.unload(this.src),this.status=s.INITIALIZED},gb.start(),function(a,b,c,d,e,f){function g(b){var f=this.self,g=this;if(!f.pending)return!1;if(g instanceof c&&g.readyState!==l)return!1;var h=parseInt(g.status)||200;try{var i=a.parse(f,g)}catch(b){var j=b}switch(!0){case m.test(h):if(j)return f.trigger(a.ERROR,new e(j.message));f.trigger(a.LOAD,i);break;case n.test(h):f.trigger(a.ERROR,new d(h,i))}}function h(b){var c=this.self,d=b?b.position||b.loaded:1,e=b?b.totalSize||b.total:1;c.trigger(a.PROGRESS,d,e)}function i(b){var c=this.self;c.trigger(a.ERROR,b)}function j(){var b=this.self;b.trigger(a.ABORT)}var k=a.XHR="_xhr",l=4,m=/^[23]\d+$/,n=/^[45]\d+$/;a.property(k,null),a.decorate("load",function(){if(!this._super())return!1;var c=this[k]=a.transport(this);c.self=this,c.onload=g,c.onreadystatechange=g,c.onerror=i,c.onprogress=h,c.onabort=j;var d,e=this.method,l=this.src;switch(e){case a.GET:case a.DELETE:var m=l.indexOf("?"),n=l.indexOf("#");m=~m?m+1:l.length,n=~n?n:l.length,d=b.fromQuery(l.slice(m,n)),this.data&&Object.merge(d,this.data),d=b.toQuery(d),"?"!==Array.prototype.last.call(l.slice(0,m))&&(d="?"+d),l=l.slice(0,m)+d+l.slice(n),d=null;break;case a.POST:case a.PUT:if(d=this.data,!d)break;try{d=JSON.stringify(d)}catch(o){return this.trigger(a.ERROR,new f(o.message))}}return c.open(e,l,!0),a.prepare(this,c),c.send(d),!0}),a.decorate("abort",function(){return this._super()?(this[k]&&this[k].abort(),!0):!1})}.call(this,ab.Network.Resource,ab.Network.Url,a.XMLHttpRequest||ab.NOP,ab.Network.Resource.Error.Request,ab.Network.Resource.Error.Parse,ab.Network.Resource.Error.Send),function(a,b,c,d){var e="Internet Explorer"===c.navigator.browser.name,f=parseInt(c.navigator.browser.version),g=b.parse(d);a.transport=function(a){var c=b.parse(a.src);return e&&10>f&&c.host&&c.host!==g.host?new XDomainRequest:new XMLHttpRequest}}(ab.Network.Resource,ab.Network.Url,ab.Device,a.location),function(a,b){var c="application/x-www-form-urlencoded",d="application/json",e={};e[a.TEXT]="text",e[a.JSON]="json",e[a.DATA]="arraybuffer",e[a.AUTO]="",a.prepare=function(f,g){if(g instanceof b){var h=f.headers;if(g.setRequestHeader){if(h)for(var i in h)g.setRequestHeader(i,h[i]);var j=f.method!==a.POST&&f.method!==a.PUT||!f.data||"object"!=typeof f.data?c:d;g.setRequestHeader("Content-Type",j+"; charset=UTF-8")}g.responseType=e[f.type]||e[a.AUTO]}}}(ab.Network.Resource,a.XMLHttpRequest||ab.NOP),function(a,b,c,d){function e(a){return i&&a.response instanceof i?new Uint8Array(a.response):h&&a instanceof XMLHttpRequest?new VBArray(a.responseBody).toArray():a.responseText.toByteArray()}function f(a){var b=a.response||a.responseText;return"object"==typeof b?b:JSON.parse(b)}function g(a){return a.responseText}var h="Internet Explorer"===b.navigator.browser.name,i=c.ArrayBuffer,j="Content-type",k=/text/,l=/json/;a.parse=function(b,c){switch(b.type){case a.DATA:return e(c);case a.JSON:return f(c);case a.TEXT:return g(c);case a.AUTO:var h=String(c instanceof d?c.contentType:c.getResponseHeader(j));return k.test(h)?g(c):l.test(h)?f(c):e(c)}}}(ab.Network.Resource,ab.Device,a,a.XDomainRequest||ab.NOP),function(a){function b(){this._opened=!0,this.trigger(a.OPEN)}function c(b){this.trigger(a.MESSAGE,b.data)}function d(){this._opened&&(this._opened=!1,this.trigger(a.CLOSE),this._sock&&(this._sock.onopen=void 0,this._sock.onmessage=void 0,this._sock.onclose=void 0,this._sock=void 0))}a.property({_sock:null,_opened:!1}),a.decorate({connect:function(a){return this._sock?this:(this._sock=new SockJS(this.src,null,a),this._sock.onopen=b.bind(this),this._sock.onmessage=c.bind(this),this._sock.onclose=d.bind(this),this)},send:function(a){return this._sock&&this._sock.send(a),this},close:function(){return this._sock?(this._sock.close(),this):this}})}(ab.Network.Socket),ab.I18n=function(a,b,c){var d=null,e={},f={tr:function(){var a=d?d.tr:f.Translator.prototype.tr;return a.apply(null,arguments)},changeLang:function(a){var b=null!==a?f.getTranslator(a):null;return f.setDefaultTranslator(b)},setDefaultTranslator:function(b){if(null===b)return d=null;if(!(b instanceof f.Translator))throw new a.Type;if(!f.getTranslator(b.code))throw new a.Reference("Engine.I18n.setDefaultTranslator: specified "+b.code+" language translator doesn't exist; Create it using `Engine.I18n.translatorFactory()` method.");d=b},translatorFactory:function(){c.call(arguments,null);var a=new(b.apply(f.Translator,arguments)),d=f.getTranslator(a.code);return d?(Object.merge(d,a),d):(f.registerTranslator(a),a)},getTranslator:function(a){return a+="",e[a]},getDefaultTranslator:function(){return d},registerTranslator:function(b){if(!(b instanceof f.Translator))throw new a.Type;if(f.getTranslator(b.code))throw new a.Reference;e[b.code]=b,d||f.setDefaultTranslator(b)},unregisterTranslator:function(b){if(!(b instanceof f.Translator))throw new a.Type;if(!f.getTranslator(b.code))throw new a.Reference;e[b.code]=null,d===b&&f.setDefaultTranslator(null)}};return f}(ab.Error,Function.prototype.bind,Array.prototype.unshift),ab.I18n.Translator=function(a,c,d,e,f){function g(a,d,e){var f;if(Object.isObject(a)&&(f=a,a=f.code,d=f.rules,e=f.strings),b.call(this,f),this.code=a?a:this.code,this.rules=d||this.rules,this.strings=e||this.strings,this.defaultContext=f&&"defaultContext"in f?f.defaultContext:this.defaultContext,!i(this.code))throw new c.Type("Engine.I18n.Translator: language code is invalid");if(d=this.rules,this.rules=null,!this.setRules(d))throw new c.Type("Engine.I18n.Translator: specified `rules` has to be an array of functions");if(e=this.strings,this.strings=null,!this.setStrings(e))throw new c.Type("Engine.I18n.Translator: `strings` has to be an object");this.tr=this.tr.bind(this)}function h(a){return"function"==typeof a&&"boolean"==typeof a(0)}function i(a){return j.test(a+"")}Z.extend(g,b),g.DEFAULT_CONTEXT="";var j=/^[a-z]{2}-[A-Z]{2}$/;return g.property({code:"",rules:null,strings:null,defaultContext:g.DEFAULT_CONTEXT}),g.parseRulesFromJSON=function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: specified `rules` can't be parsed from JSON")}if(!d(a)||!a.every(f))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: array of strings expected");for(var e=0,g=a.length;g>e;e++){var h=a[e],i=new Function("n","return "+h+";");try{i(0)}catch(b){throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: "+e+" element of `rules` ("+h+") can't be parsed into function")}if("boolean"!=typeof i(0))throw new c.Type("Engine.I18n.Translator.parseRulesFromJSON: element index "+e+" of `rules` ("+h+") doesn't return boolean value");a[e]=i}return a},g.method({setRules:function(a){return this.rules!==a&&d(a)&&a.every(e)&&a.every(h)?(this.rules=a,!0):!1},setStrings:function(a){return this.strings===a||"object"!=typeof a||d(a)?!1:(this.strings=a,!0)},tr:function(){function a(a,b){if(a.length)for(var c=0,d=a.length;d>c;c++)if(a[c](b))return c}return function(b,e,f,h){var i=Object(this);if("undefined"==typeof b)throw new c.Type("Engine.I18n.Translator::tr: Nothing to translate");if(null!=e&&"string"!=typeof e)throw new c.Type("Engine.I18n.Translator::tr: disambiguation is not a string");if(null!=f&&("number"!=typeof f||!isFinite(f)))throw new c.Type("Engine.I18n.Translator::tr: count is not a proper number");if(null!=h&&"object"!=typeof h)throw new c.Type("Engine.I18n.Translator::tr: format is not an object");b+="",e=e||i.defaultContext||g.DEFAULT_CONTEXT,f=f||0,h=h||null;var j=i.strings&&i.strings[b];return j&&("object"!=typeof j||d(j)||(j=j[e]),b="string"==typeof j?j:d(j)&&i.rules&&j[a(i.rules,f)]||b),b=b.replace("{n}",f),h?b.format(h):b}}()}),g}(ab.I18n,ab.Error,Array.isArray,Function.isFunction,String.isString);var lb=ab.Input=new b;lb.KEY_DOWN="keydown",lb.KEY_UP="keyup",lb.Keyboard=Object.merge(Object.create({CTRL_MODIFIER:1,ALT_MODIFIER:2,SHIFT_MODIFIER:4}),{key:"",text:"",modifiers:0}),Object.seal(lb.Keyboard),lb.MOUSE_DOWN="mousedown",lb.MOUSE_MOVE="mousemove",lb.MOUSE_UP="mouseup",lb.Mouse=Object.merge(Object.create({LEFT_BUTTON:0,MIDDLE_BUTTON:1,RIGHT_BUTTON:2,getPosition:function(a){return void 0===a&&(a=Math.Vector2d()),a[0]=this.x,a[1]=this.y,a}}),{viewport:null,x:0,y:0,dx:0,dy:0,button:0}),Object.seal(lb.Mouse),D.MOUSE_DOWN="mousedown",D.MOUSE_MOVE="mousemove",D.MOUSE_UP="mouseup",function(){function a(a){return function(c){var d=c.viewport.getCameraByPixel(c.x,c.y);if(d){var e=d.lookingAt;if(e){var f=d.toSceneX(c.x-d.left),g=d.toSceneY(c.y-d.top);b.x=f,b.y=g,e.trigger(a,b)}}}}var b=Object.create(lb.Mouse);b.x=b.y=0,Object.seal(b),lb.on(lb.MOUSE_DOWN,a(D.MOUSE_DOWN)).on(lb.MOUSE_MOVE,a(D.MOUSE_MOVE)).on(lb.MOUSE_UP,a(D.MOUSE_UP))}(),lb.WHEEL="wheel",lb.Wheel={deltaX:0,deltaY:0},Object.seal(lb.Wheel);var mb,nb=lb.Pointer=new b;nb.viewport=null,nb.LOCK="lock",nb.UNLOCK="unlock",Object.defineProperty(nb,"isLocked",{enumerable:!0,get:function(){return!!nb.viewport}}),nb.lock=function(a,b,c){return nb.viewport===a?b&&b():mb?mb.lock(a,function(){nb.viewport=a,b&&b()},c):c&&c(new Error.NotImplemented),nb},nb.unlock=function(a,b){return nb.isLocked?(mb?mb.unlock(a,b):b&&b(new Error.NotImplemented),nb):(a&&a(),lb.Pointer)},nb.toggle=function(a,b,c){return nb.viewport?nb.unlock(b,c):nb.lock(a,b,c)},ab.ready(function(){mb&&(mb.onLock=nb.trigger.bind(nb,nb.LOCK),mb.onUnlock=function(){nb.viewport=null,nb.trigger(nb.UNLOCK)})}),function(a,b,c){function d(a){return 0|(a.keyCode||a.which||a.key&&a.key.toUpperCase().charCodeAt()||0)}function e(a){return a&&(a["char"]||c(a.charCode))}function f(f,h,j){var k=d(h);if(k)return b.key=g[k]||c(k),b.text=f===a.KEY_DOWN&&e(j)||"",b.modifiers=0|(h.ctrlKey&&b.CTRL_MODIFIER)|((h.altKey||h.altGraphKey)&&b.ALT_MODIFIER)|(h.shiftKey&&b.SHIFT_MODIFIER),a.trigger(f,b),i}var g={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",17:"CTRL",18:"ALT",19:"PAUSE",20:"CAPS_LOCK",27:"ESC",32:"SPACE",33:"PAGE_UP",34:"PAGE_DOWN",35:"END",36:"HOME",37:"ARROW_LEFT",38:"ARROW_UP",39:"ARROW_RIGHT",40:"ARROW_DOWN",45:"INSERT",46:"DELETE",91:"SUPER_LEFT",92:"SUPER_RIGHT",93:"SELECT",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUM_LOCK",145:"SCROLL_LOCK"},h=document.documentElement,i=null,j=null,k={},l=[8,9];h.addEventListener("keydown",function(b){var c=d(b);l.has(c)&&b.target===document.body&&b.preventDefault(),j=null,!k[c]&&setTimeout(function(){k[c]=f(a.KEY_DOWN,b,j)},0),i=b}),h.addEventListener("keyup",function(b){f(a.KEY_UP,b,j),i=0,j=null,k[d(b)]=null}),h.addEventListener("keypress",function(a){j=a})}(ab.Input,ab.Input.Keyboard,String.fromCharCode),function(a,b,c,d){function e(b,d,e){var f=c.x,g=c.y;c.viewport=b,c.x=e[o]-b._dom.offsetLeft,c.y=e[p]-b._dom.offsetTop,c.dx=c.x-f,c.dy=c.y-g,c.button=e.button,a.trigger(d,c)}function f(a,c,d){if(r!==d){var a=a instanceof b?a:null;e(a,c,d),r=d}}function g(a,b,c){s.x=c[o],s.y=c[p],t.x=a._dom.offsetLeft,t.y=a._dom.offsetTop,t.w=a._dom.offsetWidth,t.h=a._dom.offsetHeight;var a=s.overlap(t)?a:null;e(a,b,c)}function h(a,c,d){if(a instanceof b){document.activeElement.blur();var e=d.touches.item(0)||d.changedTouches.item(0);g(a,c,e)}}function i(b,c,d,e){var g="touch"===d,i=g?h:f;e+="EventListener",c[e](g?"touchstart":"mousedown",i.bind(null,b,a.MOUSE_DOWN)),c[e](g?"touchend":"mouseup",i.bind(null,b,a.MOUSE_UP)),c[e](g?"touchmove":"mousemove",i.bind(null,b,a.MOUSE_MOVE))}function j(a){i(a,a._dom,"mouse","add")}function k(a){i(a,a._dom,"mouse","remove")}function l(a){if(!n)throw"Touch events are not supported";i(a,a._dom,"touch","add"),a._dom.addEventListener("touchmove",function(a){a.preventDefault()})}function m(){v.forEach(u?k:j),u=!u}var n="undefined"!=typeof window.ontouchstart,o="pageX",p="pageY",q=document.documentElement,r=null,s=d(0,0,1,1),t=d(0,0,0,0),u=!n,v=[];if(b.decorate("initialize",function(a){this._super(a),v.push(this),n&&l(this),u&&j(this)}),n){var w=0,x=1e3;q.addEventListener("touchstart",function(){u&&m()}),q.addEventListener("touchend",function(a){w=a.timeStamp}),q.addEventListener("mousemove",function(a){!u&&a.timeStamp-w>x&&m()})}}(ab.Input,ab.Viewport,ab.Input.Mouse,ab.Box),function(a){function b(b){var c=void 0!==b.wheelDeltaX?b.wheelDeltaX:0,d=void 0!==b.wheelDeltaY?b.wheelDeltaY:b.wheelDelta||-b.detail;a.deltaX=Math.max(-1,Math.min(1,c)),a.deltaY=Math.max(-1,Math.min(1,d)),lb.trigger(lb.WHEEL,a),b.preventDefault()}document.addEventListener("mousewheel",b,!1),window.addEventListener("DOMMouseScroll",b,!1)}(lb.Wheel),mb=function(){function a(a){for(var c=b[d];j.length;){var e=j.shift(),f=j.shift(),g=j.shift();!e&&!c||e&&c===e._dom?f&&f():g&&g(new ab.Error(i))}"change"===a&&(c?mb.onLock():mb.onUnlock())}var b=window.document,c=b.documentElement,d="pointerLockElement"in b&&"pointerLockElement"||"webkitPointerLockElement"in b&&"webkitPointerLockElement"||"mozPointerLockElement"in b&&"mozPointerLockElement",e="onpointerlockchange"in b&&"pointerlockchange"||"onwebkitpointerlockchange"in b&&"webkitpointerlockchange"||"onmozpointerlockchange"in b&&"mozpointerlockchange",f="onpointerlockerror"in b&&"pointerlockerror"||"onwebkitpointerlockerror"in b&&"webkitpointerlockerror"||"onmozpointerlockerror"in b&&"mozpointerlockerror",g=c.requestPointerLock||c.webkitRequestPointerLock||c.mozRequestPointerLock,h=b.exitPointerLock||b.webkitExitPointerLock||b.mozExitPointerLock;if(d&&e&&f&&g&&h){var i="Pointer can't be locked due to client restrictions; Remember to lock pointer in `mousedown` or `keydown` events",j=[];return b.addEventListener(e,a.bind(null,"change")),b.addEventListener(f,a.bind(null,"error")),ab.ready(function(){b[d]&&mb.unlock()}),{onLock:ab.NOP,onUnlock:ab.NOP,lock:function(a,b,c){return j.push(a,b,c),g.call(a._dom),this},unlock:function(a,c){return j.push(null,a,c),h.call(b),this}}}}();var ob;ab.Sound=N,N.cache={},N.prototype=Object.create(s.prototype),Object.addProperty(N.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,N),N.prototype.src="",Object.addProperty(N.prototype,"duration",Object.ENUMERABLE,0),N.prototype.load=function(){var a=s.prototype.load.call(this);if(ob){var b=this;ob.load(this.src,function(a){Object.addProperty(b,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,a),b.status=s.READY},function(){b.status=s.ERROR})}return a},N.prototype.unload=function(){var a=s.prototype.unload.call(this);return ob&&(ob.unload(this.src),Object.addProperty(this,"duration",Object.CONFIGURABLE|Object.ENUMERABLE,0)),a},N.prototype.toString=function(){return this.src},Object.freeze(N.prototype),ab.ready(function(){});var pb=!ob&&function(){function a(){for(var a=new window.Audio,b=["probably","maybe"],c={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"'},d=0,e=b.length;e>d;d++){var f;for(f in c)if(c.hasOwnProperty(f)){var g=c[f],h=a.canPlayType(g);if(h===b[d])return{ext:f,mime:g}}}return null}function b(a){return/\/?\.(\w+)$/.test(a)?a:"{}.{}".format(a,c.ext)}if("undefined"!=typeof window.Audio){var c=a();if(c)return{format:c,normalizeSrc:b}}}();pb&&!ob&&function(){function a(){var b=a.create();return b._source=null,b._gain=null,b._src="",b._loop=!1,b._volume=1,b._startTime=0,b._offset=0,b.onEnd=null,b.hasOwnProperty("_onSourceEnd")||(b._onSourceEnd=b._onSourceEnd.bind(b)),b}var b=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(b){var c={},d=new b;ob={load:function(a,b,e){var f=pb.normalizeSrc(a);new ab.Network.Resource({src:f,type:"data",on:{load:function(g){d.decodeAudioData(g.buffer,function(d){c[a]=d,b(Math.ceil(1e3*d.duration))},function(){e(new ab.Error("Sound file {} can't be decoded".format(f)))})},error:e}})},unload:function(a){c[a]=null},createAmbientSound:function(){return a()}},a.prototype={constructor:a,_source:null,_gain:null,_src:"",_loop:!1,_volume:1,_startTime:0,_offset:0,_endTimer:null,onEnd:null,_onSourceEnd:function(){!this._loop&&this._source&&this.onEnd&&this.onEnd()},setSound:function(a){this._src=a},play:function(){var a=this._source=d.createBufferSource(),b=d.destination,e=this._gain=a.gain;if(!e){var f=d[d.createGain?"createGain":"createGainNode"]();f.connect(d.destination),b=f,this._gain=e=f.gain}a.buffer=c[this._src],a.connect(b),a.loop=this._loop,e.setValueAtTime(this._volume,0),a[a.start?"start":"noteOn"](0,this._offset),this._startTime=d.currentTime,a.hasOwnProperty("onended")?a.onended=this._onSourceEnd:(this._endTimer||(this._endTimer=new ab.Timer({type:ab.Timer.VSYNC,duration:1/0,on:{step:this._onSourceEnd}})),this._endTimer.stop(),this._endTimer.delay=1e3*(a.buffer.duration-this._offset),this._endTimer.play())},pause:function(){this.stop(),this._offset=d.currentTime-this._startTime},stop:function(){this._endTimer&&this._endTimer.stop(),this._offset=0,this._source[this._source.stop?"stop":"noteOff"](0),this._source=null},seek:function(a){var b=this._onEnd;this._onEnd=null,this.stop(),this._offset=a/1e3,this.play(),this._onEnd=b},fadeTo:function(a,b,c){!this.fadeTimer&&c&&(this.fadeTimer=new ab.Timer({type:ab.Timer.VSYNC})),this.fadeTimer&&this.fadeTimer.playing&&this.fadeTimer.stop(),c&&(this.fadeTimer.delay=this.fadeTimer.duration=b,this.fadeTimer.once(ab.Timer.STOP,c),this.fadeTimer.play());var e=d.currentTime+b/1e3;this._gain.cancelScheduledValues(0),this._gain.setValueAtTime(this._volume,d.currentTime+.1),this._gain.linearRampToValueAtTime(a,e),this._volume=a},setLoop:function(a){this._loop=a,this._source&&(this._source.loop=a)},setVolume:function(a){this._volume=a,this._gain&&this._gain.setValueAtTime(a,0)},destroy:function(){a.free(this)}}}}(),pb&&!ob&&function(){function a(){var b=a.create();return b._audio=null,b.onEnd=null,b._fadeValueFrom=b._fadeValueTo=0,b._fadeTimer=null,b.hasOwnProperty("_onAudioEnd")||(b._onAudioEnd=b._onAudioEnd.bind(b)),b.hasOwnProperty("_onFadeTimerStep")||(b._onFadeTimerStep=b._onFadeTimerStep.bind(b)),b}if(window.HTMLAudioElement){var b={};ob={load:function(a,c,d){var e=b[a]=new Audio;e.src=pb.normalizeSrc(a),e.addEventListener("canplaythrough",function(){c(Math.ceil(1e3*e.duration))}),e.addEventListener("error",function(){d(new ab.Error("Sound file {} can't be loaded".format(e.src)))})},unload:function(a){b[a]=null},createAmbientSound:function(){return a()}},a.prototype={constructor:a,_audio:null,onEnd:null,_fadeValueFrom:0,_fadeValueTo:0,_fadeTimer:null,_onAudioEnd:function(){this.onEnd&&this.onEnd()},_onFadeTimerStep:function(){this.setVolume(this.fadeTimer.progress/this.fadeTimer.duration*(this._fadeValueTo-this._fadeValueFrom)+this._fadeValueFrom)},setSound:function(a){this._audio=b[a].cloneNode(),this._audio.addEventListener("ended",this._onAudioEnd)},play:function(){this._audio.play()},pause:function(){this._audio.pause()},stop:function(){this._audio.pause(),this._audio.currentTime=0},seek:function(a){this._audio.currentTime=a/1e3},fadeTo:function(a,b,c){this._fadeTimer||(this._fadeTimer=new ab.Timer({type:ab.Timer.VSYNC,on:{step:this._onFadeTimerStep}})),this._fadeTimer.playing&&this._fadeTimer.stop(),this._fadeValueFrom=this._audio.volume,this._fadeValueTo=a,this._fadeTimer.duration=b,c&&this._fadeTimer.once(ab.Timer.STOP,c),this._fadeTimer.play()},setLoop:function(a){this._audio.loop=a},setVolume:function(a){this._audio.volume=a},destroy:function(){this._audio=null,this._fadeTimer&&this._fadeTimer.playing&&this._fadeTimer.stop(),a.free(this)}}}}(),Object.addProperty(ab,"_SoundNode",Object.CONFIGURABLE|Object.WRITABLE,O),O.prototype=Object.create(C.prototype),Object.addProperty(O.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,O),Object.addProperty(O.prototype,"sound",Object.ENUMERABLE,null),O.prototype.autoplay=!1,O.prototype.autodestroy=!1,Object.addProperty(O.prototype,"_playing",Object.WRITABLE,!1),Object.defineProperty(O.prototype,"playing",{enumerable:!0,get:function(){return this._playing}}),Object.addProperty(O.prototype,"_loop",Object.WRITABLE,!1),Object.defineProperty(O.prototype,"loop",{enumerable:!0,get:function(){return this._loop},set:function(a){this._loop!==a&&(this._impl&&this._impl.setLoop(a),this._loop=a)}}),Object.addProperty(O.prototype,"_volume",Object.WRITABLE,1),Object.defineProperty(O.prototype,"volume",{enumerable:!0,get:function(){return this._volume},set:function(a){this._impl&&this._impl.setVolume(a),this._volume=a}}),O.prototype.onSoundReady=function(){this.autoplay&&this.play(),Object.addProperty(this,"autoplay",Object.CONFIGURABLE|Object.ENUMERABLE,this.autoplay)},O.prototype.onEnd=function(){this._playing=!1,this.autodestroy&&this.destroy()},O.prototype.play=function(){return this._impl&&(this._impl.play(this),this._playing=!0),this},O.prototype.pause=function(){return this._impl&&this._impl.pause(this),this._playing=!1,this},O.prototype.stop=function(){return this._impl&&this._impl.stop(this),this._playing=!1,this.autodestroy&&this.destroy(),this},O.prototype.seek=function(a){return this._impl&&this._impl.seek(a),this},O.prototype.fadeTo=function(a,b,c){return this._impl&&this._impl.fadeTo(a,b,c),this},O.prototype.destroy=function(){return this.playing&&this.stop(),this.sound.status!==s.READY&&this.sound.off(s.READY,this.onSoundReady),this._impl&&this._impl.destroy(),C.prototype.destroy.call(this)},Object.seal(O.prototype),ab.AmbientSound=P,P.prototype=Object.create(O.prototype),Object.addProperty(P.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,P),ab.Particles=function(){function a(a){b.call(this,a)}return Z.extend(a,b),a}(),ab.Particles=function(a){function b(b){a.call(this,b),this.amount=b&&"amount"in b?b.amount:this.amount,this.iterations=b&&"iterations"in b?b.iterations:this.iterations,this.emitDelay=b&&"emitDelay"in b?b.emitDelay:this.emitDelay,this.timer.duration=this.emitDelay}function c(a){for(var b=0,c=e.length;c>b;b++){var d=e[b];if(d.amount===a)return b===e.length-1?e.pop():e[b]=e.pop(),d}}Z.extend(b,a),b.BEFORE_EMIT="beforeemit",b.EMIT="emit",b.BEFORE_CREATE_PARTICLE="beforecreateparticle",b.CREATE_PARTICLE="createparticle";var d={emitter:null,i:0};b.property({amount:10,iterations:1/0,emitDelay:1e3,emitters:null});var e=[],f=5;return b.method({onstep:function(){this._super(),!this.emitters.length&&this.timer.count>=this.iterations&&this.stop()},onplay:function(){this._super(),this.emitters=[],this.emit()},onstop:function(){this._super(),this.emitters=b.prototype.emitters},onloop:function(){this._super(),this.timer.count<this.iterations&&this.emit()},onemitterdestroyed:function(a){e.push(a),e.length>f&&e.shift()},emit:function(){if(this.timer.playing){this.trigger(b.BEFORE_EMIT);var a=this.amount,e=c(a)||{amount:a};this.emitters.push(e),this.trigger(b.EMIT,e);for(var f=0,g=a;g>f;f++)this.trigger(b.BEFORE_CREATE_PARTICLE,f),d.emitter=e,d.i=f,this.trigger(b.CREATE_PARTICLE,d)}}}),b}(ab.Particles,ab.now),ab.Particles=function(a,b){function c(b){var c=function(a,b,c,d){var e=d[c]-b;d[c]=0>e?0:e};c.shortcutArguments=["timeleft"],this.funcs.push(c),a.call(this,b),this.lifetime=b&&"lifetime"in b?b.lifetime:this.lifetime}return Z.extend(c,a),c.EMITTER_DESTROYED="emitterdestroyed",c.property({lifetime:5e3}),c.method({onemit:function(a){this._super(a),a.lifetime=a.lifetime||new $("uint",this.lifetime,this.amount),a.timeleft=a.timeleft||new $("uint",this.lifetime,this.amount)},oncreateparticle:function(a){this._super(a),a.emitter.lifetime[a.i]=a.emitter.timeleft[a.i]=b(0,this.lifetime)},onstep:function(){if(this._super(),this.timer.playing)a:for(var a=0,b=this.emitters,d=b.length;d>a;a++){for(var e=0,f=b[a].timeleft,g=f.length;g>e;e++)if(f[e])continue a;var h=b[a];a===b.length-1?b.pop():b[a]=b.pop(),this.trigger(c.EMITTER_DESTROYED,h),a--,d--}}}),c}(ab.Particles,Math.max),ab.Particles=function(a){function b(b){a.call(this,b),this.redrawDelay=b&&"redrawDelay"in b?b.redrawDelay:this.redrawDelay,this.parent=b&&"parent"in b?b.parent:this.parent,this.x=b&&"x"in b?b.x:this.x,this.y=b&&"y"in b?b.y:this.y,this.width=b&&"width"in b?b.width:this.width,this.height=b&&"height"in b?b.height:this.height,this.timer.delay=this.redrawDelay}return Z.extend(b,a),b.property({geometry:null,redrawDelay:1,parent:null,x:0,y:0,width:1,height:1}),b.method({onplay:function(){this._super(),this.geometry=new ab.Particles.Geometry({emitters:this.emitters,parent:this.parent,x:this.x,y:this.y,width:this.width,height:this.height})},onstop:function(){this._super(),this.geometry.destroy()}}),b}(ab.Particles),ab.Particles=function(a){function b(b){a.call(this,b);var c=b&&"color"in b?b.color:this.color,d=b&&"image"in b?b.image:this.image,e=b&&"gradient"in b?b.gradient:this.gradient;this.color=c?c instanceof t?c:t(c):null,this.image=d?d instanceof v?d:v(d):null,this.gradient=e instanceof u?e:null,this.image&&this.image.status===s.INITIALIZED&&this.image.load(),this.particleWidth=b&&"particleWidth"in b?b.particleWidth:this.particleWidth,this.particleHeight=b&&"particleHeight"in b?b.particleHeight:this.particleHeight}Z.extend(b,a),b.property({image:null,gradient:null,color:null,particleWidth:10,particleHeight:10});return b.method({onemit:function(a){this._super(a);var b=this.amount;a.shape=a.shape||{image:new Array(b),color:new Array(b),gradient:new Array(b),width:new $("int",255,b),height:new $("int",255,b)}},oncreateparticle:function(a){this._super(a),this.color&&(this.color=this.color instanceof t?this.color:t(this.color)),this.image&&(this.image=this.image instanceof v?this.image:v(this.image)),this.gradient=this.gradient instanceof u?this.gradient:null;var b=a.emitter.shape,c=a.i;b.color[c]=this.color,b.image[c]=this.image,b.gradient[c]=this.gradient,b.width[c]=this.particleWidth,b.height[c]=this.particleHeight}}),b}(ab.Particles),ab.Particles=function(a,b,c){function d(b){var c=b&&"dx"in b?b.dx:this.dx,d=b&&"dy"in b?b.dy:this.dy;if(c!==!1&&d!==!1){var e=function(a,b,c,d,e){d&&e&&(c*=2,d[c]+=e[c]*b/1e3,d[c+1]+=e[c+1]*b/1e3)};e.shortcutArguments=["position","move"],this.funcs.push(e)}a.call(this,b),this.dx=b&&"dx"in b?b.dx:this.dx,this.dy=b&&"dy"in b?b.dy:this.dy,this.originX=b&&"originX"in b?b.originX:this.width/2,this.originY=b&&"originY"in b?b.originY:this.height/2}return Z.extend(d,a),d.property({originX:null,originY:null,dx:100,dy:100}),d.method({onemit:function(a){this._super(a);var c=b(this.width,this.height);a.position=a.position||new $("float",c,2*this.amount),a.move=a.move||new $("int",c,2*this.amount)},oncreateparticle:function(a){this._super(a);var b=a.emitter,c=a.i;c*=2,b.position[c]=this.originX,b.move[c]=this.dx,c++,b.position[c]=this.originY,b.move[c]=this.dy},verifyPosition:function(a,b,d,e){return"undefined"==typeof d&&(d=this.dx),"undefined"==typeof e&&(e=this.dy),c(d)+(a+1)/2>this.width/2?!1:c(e)+(b+1)/2>this.height/2?!1:!0}}),d}(ab.Particles,Math.max,Math.abs),ab.Particles=function(a){function b(b){var c=b&&"opacity"in b?b.opacity:this.opacity;if(c!==!1){var d=function(a,b,c,d,e){d&&(d[c]*=1-b/e[c])};d.shortcutArguments=["opacity","timeleft"],this.funcs.push(d)}a.call(this,b),this.opacity=b&&"opacity"in b?b.opacity:this.opacity}return Z.extend(b,a),b.property({opacity:1}),b.method({onemit:function(a){return this._super(a),this.opacity===!1?void(a.opacity&&(a.opacity=null)):void(a.opacity=a.opacity||new $("float",1,this.amount))},oncreateparticle:function(a){this._super(a),this.opacity!==!1&&(a.emitter.opacity[a.i]="number"==typeof this.opacity?this.opacity:b.prototype.opacity)}}),b}(ab.Particles),ab.Particles=function(a,b){function c(b){var c=Math.PI,d=b&&"rotate"in b?b.rotate:this.rotate;if(d!==!1){var e=function(a,b,d,e,f){e&&(e[d]+=f[d]*b/1e3,e[d]%=2*c)};e.shortcutArguments=["rotation","rotate"],this.funcs.push(e)}a.call(this,b),this.rotate=b&&"rotate"in b?b.rotate:this.rotate}return Z.extend(c,a),c.property({rotate:0}),c.method({onemit:function(a){return this._super(a),this.rotate===!1?(a.rotate&&(a.rotate=null),void(a.rotation&&(a.rotation=null))):(a.rotate=a.rotate||new $("float",2*b,this.amount),void(a.rotation=a.rotation||new $("float",2*b,this.amount)))},oncreateparticle:function(a){this._super(a),a.emitter.rotate&&(a.emitter.rotate[a.i]=this.rotate,a.emitter.rotation[a.i]=0)}}),c}(ab.Particles,Math.PI),ab.Particles=function(a,b){function c(c){function d(a,b,c){b.on(c,function(b){a.trigger(c,b)})}var e=this.timer=new b({type:b.VSYNC,loop:!0});d(this,e,b.PLAY),d(this,e,b.PAUSE),d(this,e,b.STOP),d(this,e,b.STEP),d(this,e,b.LOOP),this.reset=e.reset.bind(e),this.play=e.play.bind(e),this.pause=e.pause.bind(e),this.stop=e.stop.bind(e),a.call(this,c)}return Z.extend(c,a),c.STEP="step",c.LOOP="loop",c.PLAY="play",c.STOP="stop",c.property({timer:null,autoplay:!0,oninitialize:function(){this.autoplay&&setTimeout(this.timer.play.bind(this.timer),0)},reset:null,play:null,pause:null,stop:null}),c}(ab.Particles,ab.Timer),ab.Particles=function(a,b,c){function d(d){this.funcs=[],a.call(this,d),d&&c(d.funcs)&&b.apply(this.funcs,d.funcs)}return Z.extend(d,a),d.property({funcs:null}),d.method({onstep:function(){var a=arguments,b=this.funcs,c=b.length;if(this._super(),this.timer.playing){a[1]=this.timer.stepprogress;for(var d=0,e=this.emitters,f=e.length;f>d;d++)for(var g=a[0]=e[d],h=0;c>h;h++){var i=b[h],j=i.shortcutArguments;if(a.length=3,j){a.length=j.length+3;for(var k=0,l=j.length;l>k;k++)a[k+3]=g[j[k]]}for(var m=g.timeleft,n=0,o=m.length;o>n;n++)m[n]&&(a[2]=n,i.apply(null,a))}}}}),d}(ab.Particles,Array.prototype.push,Array.isArray),ab.Particles.Geometry=function(a){function b(b){a.call(this,b),this.emitters=b&&"emitters"in b?b.emitters:this.emitters}return Z.extend(b,a),b.property({emitters:null}),b}(ab.Node),ab.Particles.Geometry.prototype.render=function(a){var b=this.emitters;if(b&&b.length){C.prototype.render.call(this,a);
for(var c=0,d=b.length;d>c;c++){var e=b[c],f=e.shape,g=f.color,h=f.gradient,i=f.image,j=f.width,k=f.height,l=e.opacity,m=e.rotation,n=e.position,o=e.timeleft;a.globalAlpha=1;for(var p=0,q=o.length,r=0;q>p;r=2*++p)if(o[p]){var s=j[p],t=k[p];if(s&&t){l&&(a.globalAlpha=l[p]);var u=0|n[r],v=0|n[r+1],w=m[p];a.save(),a.translate(u,v),w&&a.rotate(w),gb.fillRect(a,-s/2,-t/2,s,t,g[p],h[p],i[p]),a.restore()}}}}},ab.Path=function(){var a=new b;return a.Metric={},a.METRIC="euclidean",a.distance=function(b,c,d,e,f){var g=a.Metric[f]||a.Metric[a.METRIC]||null;return g?g.distance(b,c,d,e):0},a}(),function(a){var b=Math.sqrt,c=Math.pow,d=Math.abs;a.Metric.euclidean={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1],[1,1,Math.SQRT2],[-1,-1,Math.SQRT2],[-1,1,Math.SQRT2],[1,-1,Math.SQRT2]],distance:function(a,d,e,f){return b(c(a-e,2)+c(d-f,2))}},a.Metric.manhattan={directions:[[1,0,1],[0,1,1],[-1,0,1],[0,-1,1]],distance:function(a,b,c,e){return d(a-c)+d(b-e)}}}(ab.Path),function(a){function b(a,b){return b.g+b.h-a.g-a.h||b.h-a.h}function c(a,b){b="function"==typeof b?b:f;for(var c=[];a;)c.unshift(b(a)),a=a.parent;return c}function d(a,b,c,d,e,f){this.x=a,this.y=b,this.g=c,this.h=d,this.parent=e,this.cost=f}function e(a,b){return a+","+b}function f(a){return[a.x,a.y]}a.MAX=500,a.INVALID=-1,a.search=function(f,g,h,i,j,k,l){if(f===h&&g===i)return[];var m=a.Metric[a.METRIC]||null;if(!m)throw new ab.Error.Type('Engine.Path.search: no "'+a.METRIC+'" metric found');if("function"!=typeof j)throw new ab.Error.Type('Engine.Path.search: validation method is not a function. "'+typeof j+'" passed instead.');l=arguments.length<7?this:l;for(var n=m.directions,o=n.length,p=m.distance,q=Math.max(0,parseFloat(a.MAX)||0),r=a.INVALID,s=0,t=p.call(null,f,g,h,i),u=[new d(f,g,s,t,null,0)],v={},w={},x=u.last();u.length&&q-->0;){var y=u.pop(),z=y.x,A=y.y;if(x.h>y.h&&(x=y),z===h&&A===i)return c(y,k);v[y]=y;for(var B=0;o>B;B++){var C=n[B],D=C[0],E=C[1],F=C[2],G=z+D,H=A+E;if(!v[e(G,H)]&&!w[e(G,H)]){var I=j.call(l,G,H,D,E);if(w[e(G,H)]=!0,Number(I)!==r){var s=y.g+I*F,t=p.call(null,G,H,h,i);u.push(new d(G,H,s,t,y,I))}}}u.sort(b)}return c(x,k)},d.prototype.toString=function(){return e(this.x,this.y)}}(ab.Path);var qb=64,rb=40,sb=Math.Matrix33(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,rb/qb),tb=ab.Isometry={project:function(a,b,c,d){var e=qb*(a-b)/2,f=rb*(a/2+b/2-c);return d?(d.x=e,d.y=f):(d=Math.Vector2d.create(),Math.Vector2d.call(d,e,f)),d},coords:function(a,b,c){var d=a/qb+b/rb,e=a/-qb+b/rb;return c?(c.x=d,c.y=e):(c=Math.Vector2d.create(),Math.Vector2d.call(c,d,e)),c},getVisibleArea:function(a,b){b=b||ab.Box.create();var c=Math.Vector2d(0,0);tb.coords(a.x,a.y,c);var d=c.x,e=d,f=c.y,g=f;return tb.coords(a.x,a.y+a.h,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,tb.coords(a.x+a.w,a.y,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,tb.coords(a.x+a.w,a.y+a.h,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Math.Vector2d.free(c),l.call(b,d,f,e-d,g-f)},isAreaVisible:function(a,b){var c=Math.Vector2d(0,0);tb.project(x,y,0,c);var d=c.x,e=d,f=c.y,g=f;return tb.project(x,y+h,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,tb.project(x+w,y,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,tb.project(x+w,y+h,0,c),d=c.x<d?c.x:d,f=c.y<f?c.y:f,e=c.x>e?c.x:e,g=c.y>g?c.y:g,Math.Vector2d.free(c),l.overlap(d,f,e-d,g-f,b.x,b.y,b.w,b.h)}};Object.defineProperty(tb,"UNIT",{get:function(){return qb/Math.SQRT2}}),Object.defineProperty(tb,"TILE_WIDTH",{get:function(){return qb},set:function(a){qb=a,sb.set(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,rb/qb)}}),Object.defineProperty(tb,"TILE_HEIGHT",{get:function(){return rb},set:function(a){rb=a,sb.set(1,0,0,0,1,0,0,0,1).rotate(Math.deg2rad(-45)).scale(1,rb/qb)}}),Object.defineProperty(tb,"TRANSFORM",{get:function(){return sb}}),ab.Isometry.Node=Q,Q.prototype=Object.create(C.prototype),Q.prototype.constructor=Q,Q.prototype._isoX=0,Q.prototype._isoY=0,Q.prototype._isoZ=0,Q.prototype._isoW=0,Q.prototype._isoH=0,Object.defineProperty(Q.prototype,"isoX",{enumerable:!0,configurable:!0,get:function(){return this._isoX},set:function(a){this._isoX=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,tb.project(this._isoX,this._isoY,this._isoZ,this)}}),Object.defineProperty(Q.prototype,"isoY",{enumerable:!0,configurable:!0,get:function(){return this._isoY},set:function(a){this._isoY=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,tb.project(this._isoX,this._isoY,this._isoZ,this)}}),Object.defineProperty(Q.prototype,"isoZ",{enumerable:!0,configurable:!0,get:function(){return this._isoZ},set:function(a){this._isoZ=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ,tb.project(this._isoX,this._isoY,this._isoZ,this)}}),Object.defineProperty(Q.prototype,"isoW",{enumerable:!0,configurable:!0,get:function(){return this._isoW},set:function(a){this._isoW=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ}}),Object.defineProperty(Q.prototype,"isoH",{enumerable:!0,configurable:!0,get:function(){return this._isoH},set:function(a){this._isoH=a,this.zIndex=this._isoX+this._isoY+this._isoW/2+this.isoH/2+this._isoZ}});var ub=ab.Storage=new b;ub.TYPES=[ub.STRING=1,ub.OBJECT=2],ub._set=function(a,b,c,d,e){e(new ab.Error.NotImplemented)},ub._get=function(a,b,c){c(new ab.Error.NotImplemented)},ub._remove=function(a,b,c){c(new ab.Error.NotImplemented)},ub._clear=function(a,b){b(new ab.Error.NotImplemented)},ub.set=function(a,b,c,d){c=c||ab.NOP,d=d||ab.NOP;var e="string"==typeof b?ub.TEXT:ub.OBJECT;return ub._set(a,b,e,c,d),ub},ub.get=function(a,b,c){return b=b||ab.NOP,c=c||ab.NOP,ub._get(a,b,c),ub},ub.remove=function(a,b,c){return b=b||ab.NOP,c=c||ab.NOP,ub._remove(a,b,c),ub},ub.clear=function(a,b){return a=a||ab.NOP,b=b||ab.NOP,ub._clear(a,b),ub},function(a,b){function c(a){a()}function d(a){a(new b)}function e(a,b,c,d){n.open(l,function(e){var f=e.put(b,a);f.onerror=d,f.onsuccess=c},d)}function f(a,b,c){n.open(m,function(d){var e=d.get(a);e.onerror=c,e.onsuccess=function(a){var d=a.target.result;return"undefined"==typeof d?c():void b(d)}},c)}function g(a,b,c){n.open(l,function(d){var e=d.delete(a);e.onerror=c,e.onsuccess=b},c)}function h(a,b){n.open(l,function(c){var d=c.clear();d.onerror=b,d.onsuccess=a},b)}if(!a._implemented){var i=this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.msIndexedDB,j=this.IDBTransaction||this.webkitIDBTransaction,k=this.IDBFactory;if(i){a._implemented="html-indexeddb";var l=j.READ_WRITE||"readwrite",m=j.READ_ONLY||"readonly",n={NEW_API:!(!k||!k.prototype.deleteDatabase),DB_NAME:"SGP_Storage",DB_VERSION:1,STORE_NAME:"SGP",idb:null,open:function(a,b,c){if(this.idb)return this.transaction(a,b,c);var d=this.NEW_API?i.open(this.DB_NAME,this.DB_VERSION):i.open(this.DB_NAME);d.onupgradeneeded=function(a){a.target.result.createObjectStore(n.STORE_NAME)},d.onerror=c,d.onsuccess=function(d){var e=n.idb=d.target.result;if(n.NEW_API||n.DB_VERSION===parseInt(e.version))return n.transaction(a,b,c);var f=e.setVersion(n.DB_VERSION);f.onerror=c,f.onsuccess=function(d){e.createObjectStore(n.STORE_NAME),d.target.transaction.onsuccess=n.transaction.bind(n,a,b,c)}}},transaction:function(a,b){if(!this.idb)throw new ReferenceError;a=a||l;var c=a===l?l:m,d=this.idb.transaction(n.STORE_NAME,c),e=d.objectStore(n.STORE_NAME);b(e)}};a._set=function(a,b,f,g,h){g=c.bind(null,g),h=d.bind(null,h),e(a,b,g,h)},a._get=function(a,b,c){c=d.bind(null,c),f(a,b,c)},a._remove=function(a,b,e){b=c.bind(null,b),e=d.bind(null,e),g(a,b,e)},a._clear=function(a,b){a=c.bind(null,a),b=d.bind(null,b),h(a,b)}}}}.call(this,ab.Storage,ab.Error),function(a,b,c){function d(a){a()}function e(a,b){a(b)}function f(b,d,e,g,h,i){var j=arguments;if(i=i||1,e===a.OBJECT&&"string"!=typeof d)try{d=JSON.stringify(d)}catch(l){return h(l)}var m=setTimeout(function(){return g=c,h=c,1===i?f(b,d,j[3],j[4],2):void j[4]()},700);g=function(){clearTimeout(m),j[3]()},h=function(){clearTimeout(m),j[4].apply(null,arguments)},k.open("readwrite",function(){k.executeSql("INSERT OR REPLACE INTO {} (key, value, type) VALUES (?,?,?)".format(escape(k.STORE_NAME)),[b,d,e],g,h)},h)}function g(b,c,d){k.open("readonly",function(){function e(b,e){if(!e.rows.length)return d();var f=e.rows.item(0),g=f.value;f.type===a.OBJECT&&(g=JSON.parse(g)),c(g)}k.executeSql("SELECT value, type FROM {} WHERE key=?".format(escape(k.STORE_NAME)),[b],e,d)},d)}function h(a,b,c){k.open("readwrite",function(){k.executeSql("DELETE FROM {} WHERE key=?".format(escape(k.STORE_NAME)),[a],b,c)},c)}function i(a,b){k.open("readwrite",function(){k.executeSql("DELETE FROM {}".format(escape(k.STORE_NAME)),null,a,b)},b)}if(!a._implemented){var j=this.openDatabase||this.openDatabaseSync;if(j){a._implemented="html-websql";var k={ASYNC_MODE:!!this.openDatabase,DB_NAME:"SGP_Storage",DB_VERSION:"2.0",STORE_NAME:"SGP",sqldb:null,tx:null,open:function(a,b,c){function d(){k.executeSql("DROP TABLE IF EXISTS {}".format(escape(k.STORE_NAME)),null,e,c)}function e(){k.transaction("readwrite",function(){k.executeSql("CREATE TABLE IF NOT EXISTS {} (key TEXT PRIMARY KEY, value TEXT, type INTEGER)".format(escape(k.STORE_NAME)),null,b,c)},c)}return this.sqldb?this.transaction(a,b,c):(this.sqldb=j(this.DB_NAME,"",this.DB_NAME,1048576),void(this.sqldb.version!==k.DB_VERSION?this.sqldb.changeVersion(this.sqldb.version,k.DB_VERSION,function(a){k.tx=a,d()},c):e()))},transaction:function(a,b){var c=this,d="readonly"===a?"readTransaction":"transaction";this.sqldb[d](function(a){c.tx=a,b()})},executeSql:function(a,b,c,d){if(b=b||[],this.ASYNC_MODE)this.tx.executeSql(a,b,c,d);else try{var e=this.tx.executeSql(a,b);c(this.tx,e)}catch(f){d(f)}}};a._set=function(a,b,c,g,h){g=d.bind(null,g),h=e.bind(null,h),f(a,b,c,g,h)},a._get=function(a,b,c){c=e.bind(null,c),g(a,b,c)},a._remove=function(a,b,c){b=d.bind(null,b),c=e.bind(null,c),h(a,b,c)},a._clear=function(a,b){a=d.bind(null,a),b=e.bind(null,b),i(a,b)}}}}.call(this,ab.Storage,ab.Error,ab.NOP),ab.Motion=function(a){function b(b){a.call(this,b),this.alpha=0,this.beta=0,this.gamma=0,this.acceleration={x:0,y:0,z:0,alpha:0,beta:0,gamma:0}}return b.ORIENTATION="orientation",b.MOTION="motion",Z.extend(b,a),b.property({alpha:0,beta:0,gamma:0,acceleration:{x:0,y:0,z:0,alpha:0,beta:0,gamma:0},isEnabled:!1}),b.method({enable:function(){return this.isEnabled?!1:(this.isEnabled=!0,!0)},disable:function(){return this.isEnabled?(this.isEnabled=!1,!0):!1},toggle:function(){this.isEnabled?this.disable():this.enable()},destroy:function(){this.disable(),a.prototype.destroy.call(this)},getScreenOrientation:function(a){void 0===a&&(a={});cb.screen.orientation;switch(ab.Device.screen.orientation){case 0:a.alpha=this.alpha,a.gamma=this.gamma,a.beta=this.beta;break;case 90:a.alpha=(this.alpha-90)%360,a.gamma=this.beta,a.beta=-this.gamma;break;case 180:a.alpha=(this.alpha-180)%360,a.gamma=-this.gamma,a.beta=-this.beta;break;case-90:a.alpha=(this.alpha+90)%360,a.gamma=-this.beta,a.beta=this.gamma}return a}}),b}(b),function(a){function b(b){for(var c=e(b.alpha),f=e(b.beta),g=e(b.gamma),h=0,i=d.length;i>h;h++){var j=d[h];(j.alpha!==c||j.beta!==f||j.gamma!==g)&&(j.alpha=c,j.beta=f,j.gamma=g,j.trigger(a.ORIENTATION,j))}}function c(b){for(var c=b.rotationRate,f=b.acceleration,g=e(c.alpha),h=e(c.beta),i=e(c.gamma),j=e(f.x),k=e(f.y),l=e(f.z),m=0,n=d.length;n>m;m++){var o=d[m],f=o.acceleration;(f.alpha!==g||f.beta!==h||f.gamma!==i||f.x!==j||f.y!==k||f.z!==l)&&(f.alpha=g,f.beta=h,f.gamma=i,f.x=j,f.y=k,f.z=l,o.trigger(a.MOTION,f))}}var d=[],e=Math.round;a.decorate({enable:function(){return this._super()?(d.add(this),1===d.length&&(window.addEventListener("deviceorientation",b),window.addEventListener("devicemotion",c)),!0):!1},disable:function(){return this._super()?(d.remove(this),d||(window.removeEventListener("deviceorientation",b),window.removeEventListener("devicemotion",c)),!0):!1}})}(ab.Motion);var vb;ab.Animation=R,R.START="start",R.END="end",R.prototype=Object.create(b.prototype),Object.addProperty(R.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,R),Object.addProperty(R.prototype,"_mutable",Object.CONFIGURABLE,!0),R.prototype.autoplay=!1,R.prototype.autodestroy=!1,R.prototype.duration=1e3,Object.addProperty(R.prototype,"_playing",Object.CONFIGURABLE,!1),Object.defineProperty(R.prototype,"playing",{configurable:!0,enumerable:!0,get:function(){return this._playing}}),Object.addProperty(R.prototype,"_paused",Object.CONFIGURABLE,!1),Object.defineProperty(R.prototype,"paused",{configurable:!0,enumerable:!0,get:function(){return this._paused}}),Object.addProperty(R.prototype,"_loop",Object.CONFIGURABLE|Object.WRITABLE,!1),Object.defineProperty(R.prototype,"loop",{configurable:!0,enumerable:!0,get:function(){return this._loop},set:function(a){this._loop=a,this._impl&&this._impl.setLoop(a)}}),R.prototype.reverse=!1,R.prototype.onEnd=function(){this._playing=!1,this._paused=!1,this.trigger(R.END),this.autodestroy&&this.destroy()},R.prototype.play=function(){this._playing=!0,this._paused=!1,this.trigger(R.START),this._impl&&this._impl.play()},R.prototype.pause=function(){this._playing=!1,this._paused=!0,this._impl&&this._impl.pause()},R.prototype.stop=function(){this.onEnd(),this._impl&&this._impl.stop()},R.prototype.destroy=function(){this.playing&&this.stop(),this._mutable=!1,b.prototype.destroy.call(this),this._impl&&this._impl.destroy()},Object.preventExtensions(R.prototype),ab.ready(function(){}),R.Group=S,S.setMutableDeep=function(a,b){if(a._mutable=b,a instanceof S)for(var c=a.animations,d=0,e=c.length;e>d;d++)S.setMutableDeep(c[d],b)},S.prototype=Object.create(R.prototype),Object.addProperty(S.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,S),S.prototype.animations=null,S.prototype.duration=0,Object.preventExtensions(S.prototype),ab.SequentialAnimation=R.Sequential=T,T.getTotalDuration=function(a){for(var b=0,c=a.animations,d=0,e=c.length;e>d;d++)b+=c[d].duration;return b},T.prototype=Object.create(S.prototype),Object.addProperty(T.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,T),Object.preventExtensions(T.prototype),ab.ParallelAnimation=R.Sequential=U,U.getMaxDuration=function(a){for(var b=0,c=a.animations,d=0,e=c.length;e>d;d++)b=Math.max(b,c[d].duration);return b},U.prototype=Object.create(S.prototype),Object.addProperty(U.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,U),Object.preventExtensions(U.prototype),ab.PropertyAnimation=R.Property=V,V.Easing={linear:1,inQuad:4,outQuad:5,inOutQuad:6,outInQuad:7,inCubic:8,outCubic:9,inOutCubic:10,outInCubic:11,inQuart:16,outQuart:17,inOutQuart:18,outInQuart:19,inQuint:32,outQuint:33,inOutQuint:34,outInQuint:35,inSine:64,outSine:65,inOutSine:66,outInSine:67,inExpo:128,outExpo:129,inOutExpo:130,outInExpo:131,inCirc:256,outCirc:257,inOutCirc:258,outInCirc:259,inElastic:512,outElastic:513,inOutElastic:514,outInElastic:515,inBack:1024,outBack:1025,inOutBack:1026,outInBack:1027,inBounce:2048,outBounce:2049,inOutBounce:2050,outInBounce:2051},V.prototype=Object.create(R.prototype),Object.addProperty(V.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,V),V.prototype.target=null,V.prototype.property="",V.prototype.updateProperty=!1,V.prototype.easing=V.Easing.linear,Object.preventExtensions(V.prototype),ab.NumberAnimation=V.Number=W,W.prototype=Object.create(V.prototype),Object.addProperty(W.prototype,"constructor",Object.CONFIGURABLE|Object.WRITABLE,W),W.prototype.from=0,W.prototype.to=0,Object.preventExtensions(W.prototype),C.prototype.animate=function(){var a={};return function(b,c,d,e){if(void 0===e&&(Object.isObject(d)?(e=d,d=void 0):Object.isObject(c)?(e=c,c=void 0):Object.isObject(b)&&(e=b,b=void 0)),a.autoplay=!0,a.autodestroy=!0,a.target=this,void 0!==b&&(a.property=b),void 0!==c&&(a.to=c),void 0!==d&&(a.duration=d),void 0!==e&&Object.merge(a,e),"number"!=typeof this[a.property])throw new ab.Error("Property `{}` in Node is not animatable".format(a.property));var f=W(a);return Object.clear(a),f}}(),vb=vb||function(){function a(){this._reversed=!1}return a.prototype={constructor:a,_reversed:!1,_stopped:!1,timer:null,reverse:!1,loop:!1,duration:0,initialize:function(a){this.duration=a.duration,this.reverse=a.reverse,this.setLoop(a.loop)},_update:function(){throw"Not implemented"},_reverse:function(){this._reversed=!this._reversed},_onStep:function(){this._update(Math.min(1,Math.max(0,this.timer.progress/this.timer.duration)))},_onLoop:function(){this.reverse&&this._reverse()},_onStop:function(){this._stopped||!this.reverse||this._reversed?(this._reversed&&this._reverse(),!this._stopped&&this.onEnd&&this.onEnd()):(this._reverse(),this.timer.play())},setLoop:function(a){this.loop=a,this.timer&&(this.timer.loop=a)},play:function(){this.timer=this.timer||new ab.Timer({type:ab.Timer.VSYNC,on:{step:this._onStep.bind(this),loop:this._onLoop.bind(this),stop:this._onStop.bind(this)}}),this.timer.duration=this.duration,this.timer.loop=this.loop,this.timer.play()},pause:function(){this.timer.pause()},stop:function(){this._stopped=!0,this.timer.stop(),this._stopped=!1}},a}(),vb&&function(){function a(){b.call(this)}var b=vb;b.PropertyAnimation=a,a.prototype=Object.merge(Object.create(b.prototype),{constructor:a,easing:null,initialize:function(c){b.prototype.initialize.call(this,c),this.easing=a.Easing[c.easing]}})}(),vb&&function(){function a(a,b,c){var d=.3;if(0===a)return b;if(1===a)return b+c;var e=d/(2*Math.PI)*Math.asin(1);return-(c*Math.pow(2,10*(a-1))*Math.sin(2*(a-1-e)*Math.PI/d))+b}function b(a,b,c){var d=.3;if(0===a)return 0;if(1===a)return 1;var e=d/(2*Math.PI)*Math.asin(1);return c*Math.pow(2,-10*a)*Math.sin(2*(a-e)*Math.PI/d)+c+b}function c(a,b){return 1/2.75>a?7.5625*b*a*a:2/2.75>a?(a-=1.5/2.75,b*(7.5625*a*a+.75)):2.5/2.75>a?(a-=2.25/2.75,b*(7.5625*a*a+.9375)):(a-=2.625/2.75,b*(7.5625*a*a+.984375))}var d=Object.clone(ab.PropertyAnimation.Easing);vb.PropertyAnimation.Easing=d,d[d.linear]=function(a){return a};var e=d[d.inQuad]=function(a){return a*a},f=d[d.outQuad]=function(a){return-a*(a-2)};d[d.inOutQuad]=function(a){return a*=2,1>a?a*a/2:(a--,-.5*(a*(a-2)-1))},d[d.outInQuad]=function(a){return.5>a?f(2*a)/2:e(2*a-1)/2+.5};var g=d[d.inCubic]=function(a){return a*a*a},h=d[d.outCubic]=function(a){return a--,a*a*a+1};d[d.inOutCubic]=function(a){return a*=2,1>a?.5*a*a*a:(a-=2,.5*(a*a*a+2))},d[d.outInCubic]=function(a){return.5>a?h(2*a)/2:g(2*a-1)/2+.5};var i=d[d.inQuart]=function(a){return a*a*a*a},j=d[d.outQuart]=function(a){return a--,-(a*a*a*a-1)};d[d.inOutQuart]=function(a){return a*=2,1>a?.5*a*a*a*a:(a-=2,-.5*(a*a*a*a-2))},d[d.outInQuart]=function(a){return.5>a?j(2*a)/2:i(2*a-1)/2+.5};var k=d[d.inQuint]=function(a){return a*a*a*a*a},l=d[d.outQuint]=function(a){return a-=1,a*a*a*a*a+1};d[d.inOutQuint]=function(a){return a*=2,1>a?.5*a*a*a*a*a:(a-=2,.5*(a*a*a*a*a+2))},d[d.outInQuint]=function(a){return.5>a?l(2*a)/2:k(2*a-1)/2+.5};var m=d[d.inSine]=function(a){return 1===a?1:-Math.cos(a*Math.PI/2)+1},n=d[d.outSine]=function(a){return Math.sin(a*Math.PI/2)};d[d.inOutSine]=function(a){return-.5*(Math.cos(Math.PI*a)-1)},d[d.outInSine]=function(a){return.5>a?n(2*a)/2:m(2*a-1)/2+.5};var o=d[d.inExpo]=function(a){return 0===a||1===a?a:Math.pow(2,10*(a-1))-.001},p=d[d.outExpo]=function(a){return 1===a?1:1.001*(-Math.pow(2,-10*a)+1)};d[d.inOutExpo]=function(a){return 0===a||1===a?a:(a*=2,1>a?.5*Math.pow(2,10*(a-1))-5e-4:.50025*(-Math.pow(2,-10*(a-1))+2))},d[d.outInExpo]=function(a){return.5>a?p(2*a)/2:o(2*a-1)/2+.5};var q=d[d.inCirc]=function(a){return-(Math.sqrt(1-a*a)-1)},r=d[d.outCirc]=function(a){return a--,Math.sqrt(1-a*a)};d[d.inOutCirc]=function(a){return a*=2,1>a?-.5*(Math.sqrt(1-a*a)-1):(a-=2,.5*(Math.sqrt(1-a*a)+1))},d[d.outInCirc]=function(a){return.5>a?r(2*a)/2:q(2*a-1)/2+.5},d[d.inElastic]=function(b){return a(b,0,1)},d[d.outElastic]=function(a){return b(a,0,1)},d[d.inOutElastic]=function(a){var b=.3*1.5;if(0===a)return 0;if(a*=2,2===a)return 1;var c=b/(2*Math.PI)*Math.asin(1);return 1>a?-.5*Math.pow(2,10*(a-1))*Math.sin(2*(a-1-c)*Math.PI/b):Math.pow(2,-10*(a-1))*Math.sin(2*(a-1-c)*Math.PI/b)*.5+1},d[d.outInElastic]=function(c){return.5>c?b(2*c,0,.5):a(2*c-1,.5,.5)};var s=1.70158;d[d.inBack]=function(a){return a*a*((s+1)*a-s)},d[d.outBack]=function(a){return a--,a*a*((s+1)*a+s)+1},d[d.inOutBack]=function(a){var b=s;return a*=2,1>a?(b*=1.525,.5*a*a*((b+1)*a-b)):(a-=2,b*=1.525,.5*(a*a*((b+1)*a+b)+2))},d[d.outInBack]=function(a){return.5>a?d[d.outBack](2*a,s)/2:d[d.inBack](2*a-1,s)/2+.5},d[d.inBounce]=function(a){return 1-d[d.outBounce](1-a)},d[d.outBounce]=function(a){return c(a,1)},d[d.inOutBounce]=function(a){return.5>a?d[d.inBounce](2*a)/2:1===a?1:d[d.outBounce](2*a-1)/2+.5},d[d.outInBounce]=function(a){return.5>a?c(2*a,.5):1-c(2-2*a,.5)}}(),vb&&function(){function a(){var b=a.create();return c.call(b),b}var b=vb,c=b.PropertyAnimation;b.createNumberAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,from:0,to:0,target:null,property:"",initialize:function(a){c.prototype.initialize.call(this,a),this.from=a.from,this.to=a.to,this.target=a.target,this.property=a.property},_reverse:function(){c.prototype._reverse.call(this);var a=this.to;this.to=this.from,this.from=a},_update:function(a){this.target[this.property]=this.easing(a)*(this.to-this.from)+this.from},destroy:function(){a.free(this)}})}(),vb&&function(){function a(){b.call(this),this._times=this._times||Array.create(),this._times.clear(),this._animations=this._animations||Array.create(),this._animations.clear()}var b=vb;b.AnimationsGroup=a,a.prototype=Object.merge(Object.create(b.prototype),{constructor:a,_times:null,_animations:null,initialize:function(a){b.prototype.initialize.call(this,a);for(var c=a.animations,d=0,e=c.length;e>d;d++)this._times.push(0),this._animations.push(c[d]._impl)},_reverse:function(){b.prototype._reverse.call(this);for(var a=this._times,c=this._animations,d=this.duration,e=0,f=a.length;f>e;e++)a[e]=d-c[e].duration-a[e],c[e]._reverse();a.reverse(),c.reverse()},_update:function(a){for(var b=a*this.duration,c=this._times,d=this._animations,e=0,f=c.length;f>e;e++){var g=c[e],h=d[e];if(!(g>b)){var a=(b-g)/h.duration;h._update(Math.min(1,a))}}}})}(),vb&&function(){function a(){var b=a.create();return c.call(b),b}var b=vb,c=b.AnimationsGroup;b.createParallelAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,destroy:function(){a.free(this)}})}(),vb&&function(){function a(){var b=a.create();return c.call(b),b}var b=vb,c=b.AnimationsGroup;b.createSequentialAnimation=function(){return a()},a.prototype=Object.merge(Object.create(c.prototype),{constructor:a,initialize:function(a){c.prototype.initialize.call(this,a);for(var b=a.animations,d=0,e=0,f=b.length;f>e;e++)this._times[e]=d,d+=b[e].duration},destroy:function(){a.free(this)}})}();var wb=ab.Sna={};return wb.BYTESPERPIXEL=4,wb.FRAMEDELAY=80,wb.DURATION="duration",wb.SOUND="sound",wb.TICK=1,ab.Sna.Resource=function(a){function b(b){this.sets=null,this.states=null,a.call(this,b)}var c={};return Z.extend(b,a),b.property({type:"data"}),b.method({getState:function(a){return this.states&&this.states.hasOwnProperty(a)?this.states[a]:null}}),b.load=function(a){return c.hasOwnProperty(a)?c[a]:c[a]=new b({src:a})},b}(ab.Network.Resource),ab.Sna.Animation=function(a,b,c,d,e){function f(a){var c=a&&a.loop?a.loop:null;this.begin=c?parseInt(c[0])||0:0,this.end=c?parseInt(c[1])||0:0,this.cycle=c?c[2]>=0?h:g:h,this.repeat=c?0===c[2]||-1===c[2]?1/0:e(c[2]):0,this.last=d(a&&a.length>=1?parseInt(a.length)-1||0:0,this.end),this.number=this.repeat,this.direction=1,this.frame=0,b.call(this,a)}var g=1,h=2,i="frame";return Z.extend(f,b),f.property({type:b.VSYNC,loop:!0,delay:a.FRAMEDELAY,duration:a.FRAMEDELAY,onloop:function(){var a=this.frame;switch(this.cycle){case h:a=a===this.end&&--this.number>0?this.begin:a+this.direction;break;case g:a===this.begin&&a+this.direction<this.begin?--this.number>0?(this.direction*=-1,a+=this.direction):(this.direction=1,a=this.end+this.direction):a===this.end&&a+this.direction>this.end?--this.number>0?(this.direction*=-1,a+=this.direction):(this.direction=1,a+=this.direction):a+=this.direction}return 0>a||a>this.last?this.stop():(this.frame=a,void this.trigger(i,this.frame))}}),f.method({setFrame:function(a){return a=parseInt(a)||0,this.frame===a?!1:(this.frame=a,this.trigger(i,a),!0)},setLoop:function(a){null===a?(this.begin=0,this.end=0,this.cycle=g,this.repeat=0,this.last=0,this.reset(),this.stop()):(this.begin=a?parseInt(a[0])||0:0,this.end=a?parseInt(a[1])||0:0,this.cycle=a?a[2]>=0?h:g:h,this.repeat=a?0===a[2]||-1===a[2]?1/0:e(a[2]):0,this.last=d(this.last,this.end),this.reset(),this.play())},reset:function(){this.direction=1,this.number=this.repeat,this.frame=0,this.trigger(i,this.frame),this._super()},play:function(){return this.repeat&&this._super()?(this.trigger(i,this.frame),!0):!1},stop:function(){return this._super()?(this.frame=0,this.trigger(i,this.frame),!0):!1}}),f}(ab.Sna,ab.Timer,Math.min,Math.max,Math.abs),X.prototype={buffer:null,index:0,current:function(){return this.index<0||this.index>=this.buffer.length?null:X.decodeFrame(this.buffer[this.index])},next:function(){if(this.index<0||this.index>=this.buffer.length)return null;var a=X.decodeNext(this.buffer[this.index]);return this.index=a,this.current()},rewind:function(){this.index=0}},X._bufferCache={},X.generateBuffer=function(a,b,c,d){if(0===c)var e=a+(b-a+1);else if(-1==c)var e=a+2*(b-a);else if(c>0)var e=a+(b-a+1)*c+(d-b-1);else if(0>c)var e=a+(b-a)*-c+1+(d-b-1);for(var f=$("int",256,e),g=0;a>g;g++)f[g]=X.encode(g,g+1);if(0===c){for(;b>g;g++)f[g]=X.encode(g,g+1);f[g]=X.encode(g,g+a-b)}else if(-1===c){for(var h=g,i=g;b>i;i++,g++)f[g]=X.encode(i,g+1);for(;i>a+1;i--,g++)f[g]=X.encode(i,g+1);f[g]=X.encode(i,h)}else if(c>0){for(var j=0;c>j;j++)for(var i=a;b>=i;i++,g++)f[g]=X.encode(i,g+1);for(var i=b+1;d>i;i++,g++)f[g]=X.encode(i,g+1)}else if(0>c){for(var j=0,k=1,i=a;j>c;j--,k*=-1){for(;i>=a&&b>=i;i+=k,g++)f[g]=X.encode(i,g+1);i=Math.max(a+1,i),i=Math.min(b-1,i)}for(var i=b+1;d>i;i++,g++)f[g]=X.encode(i,g+1)}return f},X.getBuffer=function(a,b,c,d){var e="{},{},{},{}".format(a,b,c,d);return X._bufferCache.hasOwnProperty(e)||(X._bufferCache[e]=X.generateBuffer(a,b,c,d)),X._bufferCache[e]},X.encode=function(a,b){return a=255&a,b=255&b,(b<<8)+a},X.decodeNext=function(a){return a>>8&255},X.decodeFrame=function(a){return 255&a},ab.Sna.Iterator=X,ab.Sna.Layer=Y,Y.prototype=Object.create(C.prototype),Object.addProperty(Y.prototype,"constructor",Y),Y.prototype.setFrame=function(a){if(a=+a||0,this.frame===a)return!1;this.frame=a;var b=this.frames[this.frame]||null;return b&&(this.x=b.x,this.y=b.y,this.width=b.w,this.height=b.h),!0},ab.Sna.Sound=function(){function a(b){var c=this instanceof a?this:a.create(),d=0,e=b&&"frames"in b?b.frames:"",f=Array.isArray(e)?e[d]||"":e,g=!Array.isArray(e);return c._sound=null,c.loop=g,c.frames=e,g&&c._playSound(f),C.call(c,b),c}return a.BASE="",a.prototype=Object.create(C.prototype),a.prototype.constructor=a,a.prototype._sound=null,a.prototype.loop=!1,a.prototype.frames=null,a.prototype._playSound=function(b){this._sound=P({sound:a.BASE+b,autoplay:!0,loop:this.loop})},a.prototype.setFrame=function(a){if(this.loop)return!0;var b=this.frames,c=b&&b[a]||null;return this._sound&&(this._sound.destroy(),this._sound=null),c?(this._playSound(c),!0):!1},a.prototype.destroy=function(){this._sound&&this._sound.destroy(),C.prototype.destroy.call(this)},a}(),ab.Sna.Node=function(a,b,c,d,e,f){function g(a){this.state=String(a&&"state"in a?a.state:this.state),this.src=String(a&&"src"in a?a.src:this.src),this.sound=Boolean(a&&"sound"in a?a.sound:this.sound),this.animation=new e,b.call(this,a);var c=this;this.animation.on("stop",function(){c.trigger("stop")}),this.animation.on("frame",function(a){c.trigger("frame",a)}),this.on("frame",h),this.on("load",i),this.on("error",j),this.onLoad=function(){c.trigger("load")},m(this,this.src)}function h(b){var e=c.load(this.src).getState(this.state);if(!e)return!1;this.animation.duration=this.animation.delay=a.FRAMEDELAY*o(self,e.duration,b)*this.tick*a.TICK;for(var g=this.children,h=g.length;h-->0;){var i=g[h];(i instanceof d||i instanceof f)&&i.setFrame(b)}}function i(){l(this),k(this,this.state)}function j(){}function k(b,e){var g=c.load(b.src).states;if(!g)return!1;var h=g.hasOwnProperty(e)?g[e]:null;if(!h)return!1;var i=h.layers||null;if(i)for(var j in i)b.appendChild(new d(i[j]));var k=h.sound||null;return b.sound&&k&&b.appendChild(f({frames:k,width:h.width,height:h.height})),b.animation.setLoop(h.loop),b.width=h.width,b.height=h.height,b.trigger(a.READY),!0}function l(a){for(var b=a.children,c=b.length;c-->0;){var e=b[c];switch(!0){case e instanceof d:case e instanceof f:e.destroy()}}return a.animation.setLoop(null),!0}function m(a,b){var d=c.load(b);d.on("load",a.onLoad),d.complete&&k(a,a.state)}function n(a,b){c.load(b).off("load",a.onLoad)}function o(a,b,c){return"number"==typeof b?+b||1:null!==b&&null!==b[c]?+b[c]||1:1}return a.READY="ready",Z.extend(g,b),g.prototype=Object.create(b.prototype),Object.addProperty(g.prototype,"constructor",g),g.prototype.tick=1,g.prototype.state="",g.prototype.src="",g.prototype.opacity=1,g.prototype.sound=!0,Object.defineProperty(g.prototype,"states",{get:function(){return c.load(this.src).states}}),g.prototype.setLoop=function(a){this.animation.setLoop(a)},g.prototype.setState=function(a){return a=String(a),a===this.state?!1:(this.state=a,l(this),void k(this,a))},g.prototype.setSrc=function(a){return a=String(a),this.src===a?!1:(n(this,this.src),this.src=a,void m(this,a))},g}(ab.Sna,ab.Node,ab.Sna.Resource,ab.Sna.Layer,ab.Sna.Animation,ab.Sna.Sound,Math.min,Math.max),function(a,b){b.parseMeta=function(a){for(var c={sets:[],states:{}},d=0,e=c.states,f=(c.sets,0);f<a.length;f++){for(var g=a[f],h=g[2],i=g[3],j={name:g[0],loop:g[1],layers:{},duration:1,sound:null,width:h[0],height:h[1]},k=0;k<i.length;k++){var l=i[k],m=l[0];switch(m){case b.DURATION:j.duration=l[1];break;case b.SOUND:j.sound=l[1];break;default:for(var n=l[1],o=j.layers[m]={frames:[],width:h[0],height:h[1]},p=0;p<n.length;p++){for(var q=n[p],r=q[0],s=q[1],t=q[2];r<o.length;)o.push(u);var u={x:s[0],y:s[1],w:s[2],h:s[3],offset:d,diff:t};o.frames.push(u);for(var v=0;v<t.length;v++){var w=t[v];d+=w[2]*w[3]*b.BYTESPERPIXEL}}j.layers[m]=o,c.sets.push(o)}}e[j.name]=j}return c},b.parseSets=function(a,c,d){for(var e=gb.ctx,f=e.canvas,g=0;g<a.length;g++)for(var h=a[g],i=h.frames,j=e.createImageData(h.width,h.height),k=j.data,l=0;l<i.length;l++){for(var m=i[l],n=m.diff,o=0;o<n.length;o++)for(var p=n[o],q=p[0],r=p[1],s=p[2],t=p[3],u=0;t>u;u++)for(var v=b.BYTESPERPIXEL*((r+u)*h.width+q),w=0;s>w;w++)for(var x=0;x<b.BYTESPERPIXEL;x++)k[v++]^=c[d++];f.width=m.w,f.height=m.h,e.putImageData(j,-m.x,-m.y,m.x,m.y,m.w,m.h),m.canvas=new window.Image,m.canvas.src=f.toDataURL()}return a}}(ab.Renderer,ab.Sna),function(a,b,c,d){b.decorate("initialize",function(a){this._super(a),this.offset=0}),b.decorate("onload",function(b){this.offset=2+(b[0]<<8)+b[1];var c=b.subarray||b.slice,e=d.unpack(c.call(b,2,this.offset)),f=a.parseMeta(e);this.states=f.states,this.sets=f.sets,a.parseSets(this.sets,b,this.offset),this._super(null)})}(ab.Sna,ab.Sna.Resource,ab.Renderer,msgpack),Y.prototype.render=function(a){C.prototype.render.call(this,a);var b=this.frames[this.frame]||null,c=b&&b.canvas;c&&a.drawImage(c,0,0)},Y.prototype.captureUI=ab.Shape.prototype.captureUI,Y.override("setFrame",function(a){return function(b){a.call(this,b);var c=this.frames[this.frame]||null;c&&(this.x=c.x,this.y=c.y,this.width=c.w,this.height=c.h)}}),function(a){function b(){this.removeEventListener&&(this.removeEventListener("DOMContentLoaded",b),this.removeEventListener("load",b)),a.start()}this.addEventListener("DOMContentLoaded",b),this.addEventListener("load",b,!1)}.call(this,ab),ab}.call(this,global);
